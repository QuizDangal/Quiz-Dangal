import{e as re,u as ie,n as A,i as D,j as e,B as u,s as k,S as ne}from"./index-DqcaIE3D.js";import{f as oe,u as le,r as a,L as G}from"./router-D53U3OCX.js";import{L as x,I as h}from"./label-Cx2ZmqRW.js";import{E as ce,u as de}from"./icons-DXR8YHNI.js";import"./supabase-BMIB7Fuo.js";import"./react-DQQtrPfG.js";const C=()=>e.jsx(ne,{title:"Login / Sign Up – Quiz Dangal",description:"Sign in or create your free Quiz Dangal account. Play daily quizzes, earn coins, and compete on leaderboards.",canonical:"https://quizdangal.com/login/",robots:"noindex, nofollow",author:"Quiz Dangal"}),ve=()=>{var B,T;const{toast:r}=re(),M=ie(),c=oe(),d=le(),{signUp:O,signIn:Q,user:E}=M,[n,L]=a.useState(!0),[m,W]=a.useState(""),[p,$]=a.useState(""),[f,P]=a.useState(!1),[g,F]=a.useState(!1),[Y,z]=a.useState(!1),[H,v]=a.useState(!1),[w,J]=a.useState(""),[R,I]=a.useState(!1),[y,K]=a.useState(""),[b,V]=a.useState(!1),[i,j]=a.useState(null),[U,q]=a.useState(!1),X=((B=c.state)==null?void 0:B.from)||"/",N=(T=c.state)==null?void 0:T.message;a.useEffect(()=>{E&&d("/",{replace:!0})},[E,d]),a.useEffect(()=>{N&&r({title:"Login Required",description:N,variant:"destructive"})},[N,r]),a.useEffect(()=>{new URLSearchParams(c.search).get("reset")==="1"&&(r({title:"Password updated",description:"Please sign in with your new password."}),L(!1),d("/login",{replace:!0}))},[c.search,d,r]),a.useEffect(()=>{const s=new URLSearchParams(c.search).get("ref");if(s){const o=A(s);o&&D(o)}},[c.search]);const Z=async()=>{F(!0);try{const{error:t}=await k.auth.signInWithOAuth({provider:"google",options:{redirectTo:globalThis.location.origin}});if(t)throw t}catch(t){r({title:"Google Login Failed",description:t.message||"Please try again.",variant:"destructive"}),F(!1)}},_=(t,s)=>{const o=String(t||"").trim(),l=String(s||"").trim();return!o||!l?{ok:!1,cleanEmail:o,cleanPassword:l,toast:{title:"Missing credentials",description:"Please enter email and password.",variant:"destructive"}}:/.+@.+\..+/.test(o)?l.length<6?{ok:!1,cleanEmail:o,cleanPassword:l,toast:{title:"Weak password",description:"Password must be at least 6 characters.",variant:"destructive"}}:{ok:!0,cleanEmail:o,cleanPassword:l}:{ok:!1,cleanEmail:o,cleanPassword:l,toast:{title:"Invalid email",description:"Please enter a valid email address.",variant:"destructive"}}},ee=async()=>{const t=y?D(y):"",{error:s}=await O(m,p,{referralCode:t||void 0});if(s){r({title:"Sign Up Failed",description:s.message,variant:"destructive"});return}z(!0),r({title:"Confirmation email sent!",description:"Please check your inbox to verify your email."})},te=async()=>{const t=_(m,p);if(!t.ok)return r(t.toast),{didNavigate:!1};const{cleanEmail:s,cleanPassword:o}=t,{error:l}=await Q(s,o);if(l){const S=String(l.message||"").toLowerCase();return S.includes("confirm")||S.includes("not confirmed")?(j({type:"unconfirmed",message:"Your email is not confirmed. Please confirm your email or resend the confirmation link."}),r({title:"Email not confirmed",description:"We can resend the confirmation link to your inbox.",variant:"destructive"})):(j({type:"invalid",message:"Invalid credentials. Please check your email and password."}),r({title:"Sign In Failed",description:l.message,variant:"destructive"})),{didNavigate:!1}}return d(X,{replace:!0}),{didNavigate:!0}},se=async t=>{t.preventDefault(),P(!0),z(!1),j(null);try{n?await ee():await te()}finally{P(!1)}},ae=async()=>{const t=(m||"").trim();if(t){q(!0);try{const{error:s}=await k.auth.resend({type:"signup",email:t});if(s)throw s;r({title:"Confirmation sent",description:`Check your inbox (${t}) for the confirmation link.`})}catch(s){r({title:"Resend failed",description:s.message||"Please try again later.",variant:"destructive"})}finally{q(!1)}}};return Y?e.jsxs("div",{className:"min-h-[100dvh] flex items-center justify-center px-4 py-6 sm:py-8",style:{paddingTop:"max(1rem, env(safe-area-inset-top))",paddingBottom:"max(1rem, env(safe-area-inset-bottom))"},children:[e.jsx(C,{}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 sm:p-8 max-w-md w-full shadow-xl text-center text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-white text-shadow-sm mb-4",children:"Check your email"}),e.jsxs("p",{className:"text-slate-300",children:["We've sent a confirmation link to ",e.jsx("strong",{children:m}),". Please click the link to complete your registration."]})]})]}):H?e.jsxs("div",{className:"min-h-[100dvh] flex items-center justify-center px-4 py-6 sm:py-8",style:{paddingTop:"max(1rem, env(safe-area-inset-top))",paddingBottom:"max(1rem, env(safe-area-inset-bottom))"},children:[e.jsx(C,{}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 sm:p-8 max-w-md w-full shadow-xl text-center text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold text-white text-shadow-sm mb-4",children:"Forgot Password"}),e.jsx("p",{className:"text-slate-300 mb-4",children:"Enter your email to receive a password reset link."}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault(),I(!0);try{const{error:s}=await k.auth.resetPasswordForEmail(w,{redirectTo:`${globalThis.location.origin}/reset-password`});if(s)throw s;r({title:"Reset Email Sent!",description:`Check your inbox (${w}) for a password reset link.`}),v(!1)}catch(s){r({title:"Reset Failed",description:s.message||"Please try again.",variant:"destructive"})}I(!1)},className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"forgot-email",className:"text-sm font-medium text-white mb-1 block",children:"Email Address"}),e.jsx(h,{id:"forgot-email",type:"email",value:w,onChange:t=>J(t.target.value),placeholder:"you@example.com",required:!0,className:"mb-2 bg-white text-black placeholder-slate-500 border-slate-300"})]}),e.jsx(u,{type:"submit",disabled:R,className:"w-full",children:R?"Sending...":"Send Reset Link"}),e.jsx(u,{type:"button",variant:"white",className:"w-full rounded-lg focus:ring-2 focus:ring-indigo-500/40",onClick:()=>v(!1),children:"Back to Login"})]})]})]}):e.jsxs("div",{className:"min-h-[100dvh] flex items-center justify-center px-4 py-6 sm:py-8",style:{paddingTop:"max(1rem, env(safe-area-inset-top))",paddingBottom:"max(1rem, env(safe-area-inset-bottom))"},children:[e.jsx(C,{}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 sm:p-8 max-w-md w-full shadow-xl text-slate-100 flex flex-col",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsxs("picture",{children:[e.jsx("source",{type:"image/webp",srcSet:"/logo-96.webp 1x, /android-chrome-192x192.png 2x"}),e.jsx("source",{type:"image/png",srcSet:"/logo-96.png 1x, /android-chrome-192x192.png 2x"}),e.jsx("img",{src:"/logo-96.png",alt:"Quiz Dangal Logo",className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 rounded-full shadow-lg",loading:"eager",decoding:"async",width:"80",height:"80"})]}),e.jsx("h1",{className:"text-3xl font-bold text-white text-shadow mb-2",children:"Quiz Dangal"})]}),e.jsx("div",{className:"mb-2 text-left",children:e.jsx("span",{className:"text-accent-b text-sm font-semibold",children:n?"Create Account":"Sign In"})}),e.jsxs("form",{onSubmit:se,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",className:"text-slate-200",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:m,onChange:t=>W(t.target.value),placeholder:"Enter your email address",required:!0,className:"bg-white text-black placeholder-slate-500 border-slate-300"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password",className:"text-slate-200",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"password",type:b?"text":"password",value:p,onChange:t=>$(t.target.value),placeholder:"Enter your password",required:!0,autoComplete:n?"new-password":"current-password",className:"pr-10 bg-white text-black placeholder-slate-500 border-slate-300"}),e.jsx("button",{type:"button","aria-label":b?"Hide password":"Show password",onClick:()=>V(t=>!t),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-600 hover:text-slate-800",children:b?e.jsx(ce,{className:"h-4 w-4"}):e.jsx(de,{className:"h-4 w-4"})})]}),!n&&e.jsx("button",{type:"button",className:"text-xs text-accent-b hover:underline mt-1 float-right",onClick:()=>v(!0),children:"Forgot Password?"})]}),n&&e.jsxs("div",{children:[e.jsx(x,{htmlFor:"referral",className:"text-slate-200",children:"Referral Code (optional)"}),e.jsx(h,{id:"referral",type:"text",value:y,onChange:t=>K(A(t.target.value)),placeholder:"Enter referral code",className:"bg-white text-black placeholder-slate-500 border-slate-300 uppercase tracking-wide"})]}),e.jsx(u,{type:"submit",disabled:f||g,variant:"brand",className:"w-full font-semibold py-3 rounded-lg shadow-lg",children:f?"Processing...":n?"Sign Up":"Sign In"}),e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:(i==null?void 0:i.message)&&e.jsx("span",{children:i.message})}),!n&&(i==null?void 0:i.type)==="unconfirmed"&&e.jsxs("div",{className:"mt-2 text-center",role:"alert",children:[e.jsx("p",{className:"text-xs text-amber-200/90 mb-2",children:i.message}),e.jsx(u,{type:"button",onClick:ae,disabled:U,variant:"outline",size:"sm",className:"border-amber-400/40 text-amber-200",children:U?"Sending…":"Resend Confirmation Email"})]}),!n&&(i==null?void 0:i.type)==="invalid"&&e.jsx("div",{className:"mt-2 text-center",role:"alert",children:e.jsx("p",{className:"text-xs text-red-300/90",children:i.message})})]}),e.jsxs("div",{className:"relative my-4 sm:my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-700/60"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-slate-900/80 border border-slate-700/60 px-3 py-0.5 text-slate-300 rounded-full tracking-wide",children:"Or continue with"})})]}),e.jsx(u,{onClick:Z,disabled:f||g,variant:"white",className:"w-full font-semibold py-3 rounded-xl shadow-md focus:ring-2 focus:ring-indigo-500/40","aria-label":"Continue with Google",children:g?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-black"}):e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 18 18","aria-hidden":"true",focusable:"false",children:[e.jsx("path",{fill:"#EA4335",d:"M9 3.48c1.69 0 2.82.73 3.47 1.34l2.36-2.36C13.7 1.07 11.68 0 9 0 5.48 0 2.44 1.99.96 4.9l2.83 2.2C4.5 5.04 6.57 3.48 9 3.48z"}),e.jsx("path",{fill:"#4285F4",d:"M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.85 2.92l2.84 2.2c1.71-1.57 2.69-3.88 2.69-6.62z"}),e.jsx("path",{fill:"#FBBC05",d:"M3.79 10.59A5.52 5.52 0 0 1 3.48 9c0-.55.09-1.08.28-1.59L.96 5.2A9.01 9.01 0 0 0 0 9c0 1.45.35 2.82.96 4.02l2.83-2.43z"}),e.jsx("path",{fill:"#34A853",d:"M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.5-1.78.85-3.12.85-2.43 0-4.49-1.56-5.21-3.68L.96 13.02C2.44 16.01 5.48 18 9 18z"})]}),e.jsx("span",{className:"font-semibold",children:"Continue with Google"})]})}),e.jsxs("p",{className:"mt-3 text-center text-sm text-slate-300",children:[n?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{onClick:()=>L(!n),className:"font-semibold text-accent-b hover:opacity-90",children:n?"Sign In":"Sign Up"})]}),e.jsxs("p",{className:"mt-5 text-[11px] leading-snug text-white text-center",children:["By continuing, you agree to our"," ",e.jsx(G,{to:"/terms-conditions",className:"underline decoration-dotted underline-offset-2 text-accent-b hover:opacity-90",children:"Terms & Conditions"})," ","and"," ",e.jsx(G,{to:"/privacy-policy",className:"underline decoration-dotted underline-offset-2 text-accent-b hover:opacity-90",children:"Privacy Policy"}),"."]})]})]})};export{ve as default};
