import{e as We,u as Ye,k as Be,Q as de,s as v,A as Xe,M as Re,m as Ge,l as k,o as ze,d as Qe,q as Ie,r as Ze,j as e,S as ee,B as ve,c as Ke,t as et,f as qe,P as u}from"./index-CGSI3L4d.js";import{r as a,g as tt,f as it,u as st,R as nt}from"./router-D53U3OCX.js";import{c as rt,s as at}from"./smartJoinQuiz-4ZzZ0f0a.js";import{m as U,AnimatePresence as ot}from"./motion-lite-CITOPWQs.js";import{L as Ce,X as ke,h as ue,o as Ae,H as Le,V as lt,t as ct}from"./icons-DXR8YHNI.js";import"./supabase-BMIB7Fuo.js";import"./react-DQQtrPfG.js";function ae(){return typeof document=="undefined"?!1:document.visibilityState==="hidden"}function dt(s,x,w={}){const{slotId:l=null}=w,{toast:o}=We(),{user:f}=Ye(),{isSubscribed:m,subscribeToPush:_}=Be(),[c,z]=a.useState(null),[O,D]=a.useState([]),[te,p]=a.useState(0),[Q,W]=a.useState({}),[h,g]=a.useState("loading"),[V,F]=a.useState(null),[P,M]=a.useState(0),[b,le]=a.useState(null),[Y,me]=a.useState(!1),[fe,pe]=a.useState(!!l),$=a.useRef(!0),B=a.useRef(!1),A=a.useRef(null),X=a.useRef(de),G=a.useCallback(t=>{var n,d,j,R,re,J;const r=Number((j=(d=(n=t==null?void 0:t.participants_joined)!=null?n:t==null?void 0:t.joined_count)!=null?d:t==null?void 0:t.joined)!=null?j:0),i=Number((J=(re=(R=t==null?void 0:t.participants_pre)!=null?R:t==null?void 0:t.pre_joined_count)!=null?re:t==null?void 0:t.pre_joined)!=null?J:0);return{joined:Number.isFinite(r)?r:0,pre_joined:Number.isFinite(i)?i:0}},[]),E=a.useCallback(async()=>{if(!(!l||!v)&&!B.current){B.current=!0;try{const{data:t,error:r}=await v.from("quiz_slots_view").select("*").eq("id",l).maybeSingle();if(!r&&t){if(!$.current)return;le(t),me(t.status==="paused"),H(G(t))}}catch(t){}finally{B.current=!1,$.current&&pe(!1)}}},[l,G]);a.useEffect(()=>{if(!l)return;let t=null;const r=()=>{t&&(clearInterval(t),t=null)},i=()=>{t||(t=setInterval(()=>{ae()||E()},Ie))};E(),ae()||i();const n=()=>{if(ae()){r();return}E(),i()};return document.addEventListener("visibilitychange",n),()=>{r(),document.removeEventListener("visibilitychange",n)}},[E,l]);const[L,oe]=a.useState(!1),[I,H]=a.useState({joined:0,pre_joined:0}),[Z,T]=a.useState(!1),[S,C]=a.useState(null),N=a.useRef(null),y=a.useRef([]),q=a.useRef(null),ie=a.useRef(null),xe=a.useRef(!1),he=a.useRef(null);a.useEffect(()=>()=>{$.current=!1,N.current&&clearTimeout(N.current),q.current&&clearTimeout(q.current),A.current&&(clearTimeout(A.current),A.current=null),y.current=[];const t=l||s;t&&rt(t)},[s,l]);const ge=a.useRef(null),ce=a.useCallback(()=>{if(q.current||y.current.length===0)return;const t=y.current[0],r=Xe*Math.pow(2,(t.attempt||1)-1),i=Math.min(r,Ze);q.current=setTimeout(()=>{q.current=null,typeof ge.current=="function"&&ge.current()},i)},[]),K=a.useCallback(async()=>{if(y.current.length===0)return;y.current.length>Re&&(y.current=y.current.slice(-Re));const t=[...y.current];y.current=[];for(const r of t)if(!(!f||S==="completed"))try{const{error:i}=await v.from("user_answers").upsert({user_id:f.id,question_id:r.questionId,selected_option_id:r.optionId},{onConflict:"user_id,question_id"});if(i)throw i;$.current&&W(n=>({...n,[r.questionId]:r.optionId}))}catch(i){const n=(r.attempt||1)+1;n<=Ge?y.current.push({...r,attempt:n}):$.current&&o({title:"Answer not saved",description:"One answer failed to sync after multiple retries.",variant:"destructive"})}y.current.length>0&&ce()},[S,f,o,ce]);a.useEffect(()=>{ge.current=K},[K]),a.useEffect(()=>{const t=()=>K(),r=()=>{ae()||K()};return window.addEventListener("online",t),document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("online",t),document.removeEventListener("visibilitychange",r)}},[K]);const Ee=(I.joined||0)+(I.pre_joined||0),Oe=h==="active"?I.joined||0:Ee,se=a.useCallback(async(t=null,r=!1)=>{const i=t||(c==null?void 0:c.id)||s||l;if(i&&!(!r&&he.current===i)){he.current=i;try{const{data:n,error:d}=await v.from("questions").select("id, question_text, options ( id, option_text )").eq("quiz_id",i).order("id");if(d){k.error("Questions fetch error:",d),k.error("Failed to load questions",d.message),D([]);return}if(!n||n.length===0){k.warn("No questions found for quiz",i),D([]);return}D(n)}catch(n){k.error("Questions load exception:",n),D([])}}},[c==null?void 0:c.id,s,l]),ne=a.useCallback(async()=>{var t,r;if(l)return b?(H(G(b)),!0):(await E(),!0);if(!s)return H({joined:0,pre_joined:0}),!0;try{const{data:i,error:n}=await v.rpc("get_engagement_counts",{p_quiz_id:s});if(n)return k.warn("Engagement counts fetch failed:",n),H({joined:0,pre_joined:0}),!1;{const d=Array.isArray(i)?i[0]:i,j=Number((t=d==null?void 0:d.joined)!=null?t:0),R=Number((r=d==null?void 0:d.pre_joined)!=null?r:0);return H({joined:isNaN(j)?0:j,pre_joined:isNaN(R)?0:R}),!0}}catch(i){return!1}},[s,l,b,E,G]),Te=a.useCallback(async()=>{try{F(null);let t=null;if(l){const{data:n,error:d}=await v.from("quiz_slots_view").select("*").eq("id",l).maybeSingle();if(d||!n){const j="Quiz slot not found.";o({title:"Error",description:j,variant:"destructive"}),F(j),g("error");return}t={id:n.quiz_id||n.id,slotId:n.id,title:n.quiz_title,category:n.category,start_time:n.start_time,end_time:n.end_time,status:n.status,prizes:n.prizes,prize_type:"coins",questions:n.questions},le(n)}else{const{data:n,error:d}=await v.from("quizzes").select("*").eq("id",s).single();if(d||!n){const j="Quiz not found.";o({title:"Error",description:j,variant:"destructive"}),F(j),g("error");return}t=n}z(t);const r=(t==null?void 0:t.id)||s;let i=null;if(f&&f.id&&r){const n=await v.from("quiz_participants").select("status").eq("user_id",f.id).eq("quiz_id",r).maybeSingle(),d=n.data;!n.error&&d?(i=d,T(!0),C(d.status||null),i.status==="completed"&&g("completed")):(T(!1),C(null))}else T(!1),C(null);i&&i.status!=="completed"&&await se(t==null?void 0:t.id),await ne()}catch(t){k.error("Error fetching quiz data:",t);const r="Failed to load quiz. Please check your internet and try again.";o({title:"Error",description:r,variant:"destructive"}),F(r),g("error")}},[s,l,f,o,se,ne]);a.useEffect(()=>{xe.current=!1,he.current=null},[s,l]),a.useEffect(()=>{Te()},[Te]),a.useEffect(()=>{if(!c||h==="completed"||h==="error")return;const t=()=>{const i=new Date,n=b!=null&&b.start_time?new Date(b.start_time):c.start_time?new Date(c.start_time):null,d=b!=null&&b.end_time?new Date(b.end_time):c.end_time?new Date(c.end_time):null,j=n&&i<n,R=n&&d&&i>=n&&i<d;if(Y){g("waiting"),M(j&&n?Math.max(0,Math.round((n.getTime()-i.getTime())/1e3)):R&&d?Math.max(0,Math.round((d.getTime()-i.getTime())/1e3)):0);return}if(j){g("waiting"),M(Math.max(0,Math.round((n.getTime()-i.getTime())/1e3)));return}if(R){g("active"),M(Math.max(0,Math.round((d.getTime()-i.getTime())/1e3)));return}g("finished"),M(0)};t();const r=setInterval(t,1e3);return()=>clearInterval(r)},[c,h,b,Y]),a.useEffect(()=>{if(!c||!(h==="waiting"||h==="active"))return;const t=()=>{A.current&&(clearTimeout(A.current),A.current=null)};let r=!1;X.current=de;const i=d=>{t(),A.current=setTimeout(async()=>{if(A.current=null,r||!$.current)return;if(ae()){i(de);return}const j=await ne();X.current=j?de:Math.min(X.current*2,6e4),i(X.current)},d)};i(0);const n=()=>{if(ae()){t();return}i(0)};return document.addEventListener("visibilitychange",n),()=>{r=!0,t(),document.removeEventListener("visibilitychange",n)}},[c,h,ne]),a.useEffect(()=>{(async()=>{var i,n;if(!c||h!=="active"||!f||l&&Y)return;const r=l||s;if(!(xe.current===r&&Z))try{if(!Z||S==="pre_joined"){xe.current=r;let d=!1,j=null;for(let R=0;R<2&&!d;R++){const{error:re}=l?await v.rpc("join_slot",{p_slot_id:l}):await v.rpc("join_quiz",{p_quiz_id:s});if(!re){d=!0;break}j=re;const J=String(re.message||"").toLowerCase();if(J.includes("not active")||J.includes("not ready")){await new Promise(Ue=>setTimeout(Ue,1500));continue}if(J.includes("already")||J.includes("completed")){d=!0;break}if(J.includes("ended")||J.includes("has ended")){g("finished");break}break}if(d)T(!0),C("joined");else if(j){const{error:R}=l?await v.rpc("pre_join_slot",{p_slot_id:l}):await v.rpc("pre_join_quiz",{p_quiz_id:s});if(!R)T(!0),C("pre_joined");else throw T(!0),j}}O.length===0&&await se(c==null?void 0:c.id)}catch(d){if(!((i=d==null?void 0:d.message)!=null&&i.includes("already"))&&!((n=d==null?void 0:d.message)!=null&&n.includes("completed"))){const j=ze(d);k.error("Quiz join error:",j,d)}}})()},[c,h,f,Z,S,s,l,Y,se,O.length,o]),a.useEffect(()=>{if(N.current&&(clearTimeout(N.current),N.current=null),!c||!c.end_time||!(h==="finished"||h==="completed"))return;const t=()=>{(async()=>{try{await Qe(v,s)}catch(r){}x(`/results/${s}`)})()};try{const r=new Date(c.end_time).getTime(),i=Date.now(),n=Math.max(0,r-i);n===0?t():N.current=setTimeout(()=>{N.current=null,t()},n)}catch(r){k.error("Error calculating redirect time:",r),N.current=setTimeout(()=>{N.current=null,t()},5e3)}return()=>{N.current&&(clearTimeout(N.current),N.current=null)}},[c,s,h,x]);const Ve=a.useCallback(async()=>{var t,r;if(c){if(!f){o({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),x("/login");return}if(S!=="completed"){try{typeof Notification!="undefined"&&Notification.permission!=="granted"&&!m&&await _()}catch(i){}try{const i=await at({supabase:v,quiz:c,user:f});if(i.status==="error")throw i.error;i.status==="already"?(T(!0),C("joined"),o({title:"Already Joined",description:"Starting shortly."})):i.status==="joined"?(T(!0),C("joined"),o({title:"Joined!",description:"Starting now."})):i.status==="pre_joined"?(T(!0),C("joined"),o({title:"Joined!",description:"Quiz starts soon. Stay tuned!"})):i.status==="scheduled_retry"&&(T(!0),C("joined"),o({title:"Joined!",description:"Quiz starts soon. Stay tuned!"})),c.status==="active"&&(i.status==="joined"||i.status==="already")&&(await se(c==null?void 0:c.id),g("active")),ne()}catch(i){if(!((t=i==null?void 0:i.message)!=null&&t.includes("already"))&&!((r=i==null?void 0:i.message)!=null&&r.includes("completed"))){const n=ze(i);k.error("Join quiz error:",n,i),o({title:"Error",description:n||"Could not join quiz. Please try again.",variant:"destructive"})}}}}},[c,f,S,m,_,o,x,ne,se]),Fe=a.useCallback(async(t,r)=>{if(!(L||h!=="active"||S==="completed")&&f!=null&&f.id){W(i=>({...i,[t]:r}));try{const{error:i}=await v.from("user_answers").upsert({user_id:f.id,question_id:t,selected_option_id:r},{onConflict:"user_id,question_id"});if(i)throw i}catch(i){k.error("Error saving answer:",i),y.current.some(d=>d.questionId===t)||o({title:"Sync delayed",description:"Network issue. Will retry automatically.",variant:"destructive"}),y.current=y.current.filter(d=>d.questionId!==t),y.current.push({questionId:t,optionId:r,attempt:1}),ce()}}},[L,h,S,f==null?void 0:f.id,o,ce]),je=a.useCallback(async()=>{if(!L&&f!=null&&f.id){oe(!0);try{if(await K(),y.current.length>0){o({title:"Sync pending",description:"Some answers are still syncing. Please check internet and try again.",variant:"destructive"});return}const t=(c==null?void 0:c.id)||s,{error:r}=await v.from("quiz_participants").update({status:"completed"}).eq("user_id",f.id).eq("quiz_id",t);if(r)throw r;o({title:"Quiz Completed!",description:"Your answers have been submitted. Results will be announced soon!"}),g("completed");try{await Qe(v,t)}catch(i){}x(l?`/results/slot/${l}`:`/results/${s}`)}catch(t){k.error("Error submitting quiz:",t),o({title:"Submission Failed",description:"Could not submit your answers. Please try again.",variant:"destructive"})}finally{$.current&&oe(!1)}}},[L,f==null?void 0:f.id,c==null?void 0:c.id,s,l,o,x,K]);a.useEffect(()=>{ie.current=je},[je]);const be=a.useRef(null),ye=a.useRef(null);a.useEffect(()=>{ye.current=null,be.current=null},[s,l]),a.useEffect(()=>{const t=be.current;if(be.current=h,h!=="finished"||t==="finished")return;const r=l?`slot:${l}`:`quiz:${s}`;if(ye.current===r)return;Object.keys(Q||{}).length>0&&S==="joined"&&!L&&(ye.current=r,typeof ie.current=="function"&&ie.current())},[h,S,L,s,l,Q]);const He=a.useCallback(t=>{const r=Math.floor(t/60),i=t%60;return`${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},[]);return{quiz:c,questions:O,currentQuestionIndex:te,answers:Q,quizState:h,error:V,timeLeft:P,submitting:L,engagement:I,joined:Z,participantStatus:S,totalJoined:Ee,displayJoined:Oe,slotMeta:b,slotPaused:Y,slotLoading:fe,setCurrentQuestionIndex:p,handleJoinOrPrejoin:Ve,handleAnswerSelect:Fe,handleSubmit:je,formatTime:He}}const _e=({startTime:s,endTime:x})=>e.jsxs("div",{className:"mt-2 text-[10px] text-slate-400",children:[e.jsx("div",{className:"mb-1",children:s?et(s):"â€”"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"Start"}),e.jsx("div",{className:"text-slate-300",children:s?qe(s):"â€”"})]}),e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"End"}),e.jsx("div",{className:"text-slate-300",children:x?qe(x):"â€”"})]})]})]}),Se=({prizes:s=[],prizeType:x="coins"})=>{var m,_,c;const w=(m=s[0])!=null?m:0,l=(_=s[1])!=null?_:0,o=(c=s[2])!=null?c:0,f=z=>Ke(x,z,{fallback:0}).formatted;return e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-1.5 text-[10px]",children:[e.jsxs("span",{className:"px-2 py-1 rounded-md bg-amber-500/15 text-amber-300 border border-amber-600/30",children:["ðŸ¥‡ ",f(w)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-sky-500/15 text-sky-300 border border-sky-600/30",children:["ðŸ¥ˆ ",f(l)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-violet-500/15 text-violet-300 border border-violet-600/30",children:["ðŸ¥‰ ",f(o)]})]})},we=({quizId:s})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(ee,{title:"Quiz â€“ Loading | Quiz Dangal",description:"Loading quiz details.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${s||""}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"h-16 w-16 animate-spin text-indigo-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading quiz..."})]})]}),Ne=({message:s})=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center text-red-400",children:s||"An error occurred"})}),ut=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-400",children:"No questions available for this quiz."})})}),De=({quiz:s,title:x,isActive:w,timeLeft:l,displayJoined:o,prizes:f,prizeType:m,formatTime:_,onJoin:c,onClose:z})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center px-3 pt-16",children:[e.jsx(ee,{title:`${x} â€“ Lobby | Quiz Dangal`,description:"Join the quiz lobby.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:z,className:"absolute top-3 right-3 text-slate-500 hover:text-white transition",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center",children:e.jsx(ue,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:x}),e.jsx("p",{className:"text-[11px] text-slate-400 mb-2",children:w?"Quiz is live!":"Quiz starts in"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:_(l)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[11px] text-slate-400 mb-2",children:[e.jsx(Ae,{className:"h-3 w-3"}),o," joined"]}),e.jsx(Se,{prizes:f,prizeType:m}),e.jsx(_e,{startTime:s==null?void 0:s.start_time,endTime:s==null?void 0:s.end_time}),e.jsx("div",{className:"mt-4",children:e.jsx(ve,{onClick:c,className:`w-full h-10 text-sm font-bold ${w?"bg-gradient-to-r from-emerald-600 to-green-500":"bg-gradient-to-r from-indigo-600 to-violet-600"} hover:opacity-90`,children:w?"Join & Start":"Pre-Join"})})]})})})]}),Pe=({quiz:s,title:x,timeLeft:w,totalJoined:l,prizes:o,prizeType:f,formatTime:m,onClose:_})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(ee,{title:`${x} â€“ Waiting | Quiz Dangal`,description:"Waiting for the quiz to start.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx(U.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:_,className:"absolute top-2 right-2 text-slate-400 hover:text-slate-200 transition",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(ue,{className:"h-6 w-6 text-indigo-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1 line-clamp-2",children:x}),e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Quiz starts in:"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:m(w)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-400 mb-2",children:[e.jsx(Ae,{className:"h-3 w-3"}),l," joined"]}),e.jsx(Se,{prizes:o,prizeType:f}),e.jsx(_e,{startTime:s==null?void 0:s.start_time,endTime:s==null?void 0:s.end_time}),e.jsx("p",{className:"mt-2 text-[10px] text-slate-500",children:"Auto-starts when timer hits zero"})]})})})]}),Me=({title:s,onNavigateHome:x})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(ee,{title:`${s} â€“ Completed | Quiz Dangal`,description:"Quiz completed. Results will be published soon.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-green-500/40 to-teal-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(Le,{className:"h-6 w-6 text-emerald-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:"Quiz Submitted!"}),e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Thank you for participating!"}),e.jsx("p",{className:"text-sm text-slate-300 mb-3",children:"Results will be published soon."}),e.jsx("button",{onClick:x,className:"mt-3 w-full h-9 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-emerald-600 to-green-500 hover:opacity-90 transition",children:"Back to Home"})]})})})]}),$e=({title:s,onNavigateHome:x})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(ee,{title:`${s} â€“ Time's Up | Quiz Dangal`,description:"Quiz time ended.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/50 via-orange-500/40 to-red-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(ue,{className:"h-6 w-6 text-amber-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:"Time's Up!"}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"This quiz has ended. Try the next one!"}),e.jsx("button",{onClick:x,className:"w-full h-9 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-indigo-600 to-violet-600 hover:opacity-90 transition",children:"Browse Quizzes"})]})})})]}),Je=({title:s,quizId:x,questions:w,currentQuestionIndex:l,answers:o,timeLeft:f,submitting:m,quizState:_,participantStatus:c,formatTime:z,onAnswerSelect:O,onNext:D,onSubmit:te})=>{const p=w[l],Q=(l+1)/w.length*100,W=l===w.length-1,h=o[p==null?void 0:p.id]!==void 0,g=Object.keys(o).length,V=w.length,F=h&&_==="active"&&c!=="completed";return e.jsxs("div",{className:"min-h-screen px-3 pt-16 pb-6",children:[e.jsx(ee,{title:`${s} â€“ Play | Quiz Dangal`,description:"Answer questions and compete to win.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${x}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsxs("div",{className:"quiz-header-card",children:[e.jsx("div",{className:"quiz-header-glow"}),e.jsxs("div",{className:"quiz-header-content",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-sm font-bold text-white truncate",children:s}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-0.5",children:["Question ",l+1," of ",w.length]})]}),e.jsx("div",{className:"shrink-0 text-right",children:e.jsxs("div",{className:"quiz-timer",role:"timer","aria-live":"polite","aria-label":`Time remaining: ${z(f)}`,children:[e.jsx(ue,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsx("span",{children:z(f)})]})})]}),e.jsx("div",{className:"mt-3 w-full bg-slate-800/80 rounded-full h-2 overflow-hidden",role:"progressbar","aria-valuenow":Q,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Quiz progress: ${Math.round(Q)}%`,children:e.jsx(U.div,{className:"h-2 rounded-full bg-gradient-to-r from-cyan-400 via-indigo-500 to-fuchsia-500",initial:!1,animate:{width:`${Q}%`},transition:{duration:.4,ease:"easeOut"}})})]})]}),e.jsx(ot,{mode:"wait",children:e.jsxs(U.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.25,ease:"easeOut"},className:"quiz-question-card",children:[e.jsxs("div",{className:"quiz-question-badge",children:["Q",l+1]}),e.jsx("h2",{className:"text-base font-semibold text-center text-white mb-5 leading-relaxed px-2",children:p==null?void 0:p.question_text}),e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-label":`Options for question ${l+1}`,children:((p==null?void 0:p.options)||[]).map((P,M)=>{const b=o[p==null?void 0:p.id]===P.id;return e.jsxs(U.button,{onClick:()=>O(p.id,P.id),disabled:m||_!=="active"||c==="completed",whileTap:{scale:.98},className:`quiz-option ${b?"quiz-option-selected":""}`,role:"radio","aria-checked":b,"aria-label":`Option ${String.fromCharCode(65+M)}: ${P.option_text}`,children:[e.jsx("span",{className:`quiz-option-letter ${b?"quiz-option-letter-selected":""}`,"aria-hidden":"true",children:String.fromCharCode(65+M)}),e.jsx("span",{className:"flex-1 text-left",children:P.option_text}),b&&e.jsx(U.div,{initial:{scale:0},animate:{scale:1},className:"quiz-option-check","aria-hidden":"true",children:e.jsx(Le,{className:"w-4 h-4"})})]},P.id)})}),F&&e.jsx(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"mt-5",children:W?e.jsx(ve,{onClick:te,disabled:m,className:"quiz-submit-btn",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"mr-2 h-4 w-4"}),"Submit Quiz (",g,"/",V,")"]})}):e.jsxs(ve,{onClick:D,className:"quiz-next-btn",children:[e.jsx("span",{children:"Next Question"}),e.jsx(ct,{className:"ml-1 h-5 w-5"})]})})]},(p==null?void 0:p.id)||l)}),e.jsx("div",{className:"quiz-progress-indicator",children:e.jsxs("span",{children:[g," of ",V," answered"]})})]})]})};_e.propTypes={startTime:u.string,endTime:u.string};Se.propTypes={prizes:u.arrayOf(u.number),prizeType:u.string};we.propTypes={quizId:u.string};Ne.propTypes={message:u.string};De.propTypes={quiz:u.object,title:u.string.isRequired,isActive:u.bool,timeLeft:u.number,displayJoined:u.number,prizes:u.arrayOf(u.number),prizeType:u.string,formatTime:u.func.isRequired,onJoin:u.func.isRequired,onClose:u.func.isRequired};Pe.propTypes={quiz:u.object,title:u.string.isRequired,timeLeft:u.number,totalJoined:u.number,prizes:u.arrayOf(u.number),prizeType:u.string,formatTime:u.func.isRequired,onClose:u.func.isRequired};Me.propTypes={title:u.string.isRequired,onNavigateHome:u.func.isRequired};$e.propTypes={title:u.string.isRequired,onNavigateHome:u.func.isRequired};Je.propTypes={title:u.string.isRequired,quizId:u.string,questions:u.arrayOf(u.object).isRequired,currentQuestionIndex:u.number.isRequired,answers:u.object.isRequired,timeLeft:u.number,submitting:u.bool,quizState:u.string,participantStatus:u.string,formatTime:u.func.isRequired,onAnswerSelect:u.func.isRequired,onNext:u.func.isRequired,onSubmit:u.func.isRequired};const bt=()=>{const{id:s,slotId:x}=tt(),w=it(),l=st(),o=w.pathname.includes("/quiz/slot/"),f=o?x:s,[m,_]=a.useState(null),[c,z]=a.useState(o),[O,D]=a.useState(null),te=a.useCallback(async()=>{if(!(!o||!x)){if(!v){D("Supabase not configured"),z(!1);return}try{const{data:q,error:ie}=await v.from("quiz_slots_view").select("*").eq("id",x).maybeSingle();if(ie)throw ie;if(!q)throw new Error("Slot not found");_(q),z(!1)}catch(q){D(q.message||"Failed to load slot"),z(!1)}}},[o,x]);a.useEffect(()=>{o&&te()},[o,te]);const{quiz:p,questions:Q,currentQuestionIndex:W,answers:h,quizState:g,timeLeft:V,submitting:F,joined:P,participantStatus:M,error:b,totalJoined:le,displayJoined:Y,setCurrentQuestionIndex:me,handleJoinOrPrejoin:fe,handleAnswerSelect:pe,handleSubmit:$,formatTime:B}=dt(o?m==null?void 0:m.id:s,l,o?{slotId:x}:void 0),A=()=>{W<Q.length-1&&me(q=>q+1)},X=()=>{window.history.length>1?l(-1):l("/")},G=()=>l("/"),E=o?(m==null?void 0:m.quiz_title)||(p==null?void 0:p.title)||"Quiz":(p==null?void 0:p.title)||"Quiz",L=o?Array.isArray(m==null?void 0:m.prizes)?m.prizes:[]:Array.isArray(p==null?void 0:p.prizes)?p.prizes:[],oe=o?"coins":(p==null?void 0:p.prize_type)||"coins",I=o?m==null?void 0:m.start_time:p==null?void 0:p.start_time,H=o?m==null?void 0:m.end_time:p==null?void 0:p.end_time,Z=new Date,T=I?new Date(I):null,S=H?new Date(H):null,C=T&&S&&Z>=T&&Z<S,N=nt.useMemo(()=>o?{start_time:m==null?void 0:m.start_time,end_time:m==null?void 0:m.end_time}:p,[o,m==null?void 0:m.start_time,m==null?void 0:m.end_time,p]);if(o&&c)return e.jsx(we,{quizId:f});if(o&&O)return e.jsx(Ne,{message:O});if(g==="error")return e.jsx(Ne,{message:b||"Something went wrong. Please try again."});if(g==="loading"||!o&&!p||o&&!m)return e.jsx(we,{quizId:f});if(!P&&g!=="completed")return e.jsx(De,{quiz:N,title:E,isActive:C,timeLeft:V,displayJoined:Y,prizes:L,prizeType:oe,formatTime:B,onJoin:fe,onClose:X});if(g==="waiting")return e.jsx(Pe,{quiz:N,title:E,timeLeft:V,totalJoined:le,prizes:L,prizeType:oe,formatTime:B,onClose:X});const y=Object.keys(h).length>0;return g==="completed"||g==="finished"&&y?e.jsx(Me,{title:E,onNavigateHome:G}):g==="finished"&&!y?e.jsx($e,{title:E,onNavigateHome:G}):!Q||Q.length===0?e.jsx(ut,{}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:`${E} | Quiz Dangal`,description:"Play this quiz on Quiz Dangal and win rewards!",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx(Je,{title:E,quizId:f,questions:Q,currentQuestionIndex:W,answers:h,timeLeft:V,submitting:F,quizState:g,participantStatus:M,formatTime:B,onAnswerSelect:pe,onNext:A,onSubmit:$})]})};export{bt as default};
