import{_ as Rt}from"./supabase-07ebd5d8.js";import{e as Et,u as It,h as ct,s as I,b as Pt,g as Ce,n as qt,r as $t,i as Dt,c as Ut,j as e,B as me}from"./index-23ff8341.js";import{r as w}from"./react-63c462fe.js";import{m as Qt}from"./motion-lite-3d667e23.js";import{g as Bt}from"./avatar-d3e092dd.js";import{S as fe}from"./SEO-42b3c76e.js";import{c as Wt,b as Ht}from"./router-d6d570a4.js";import{T as mt,c as Ft,Y as Ot,O as Vt,Z as Yt,d as Gt}from"./icons-2bdec3f2.js";const is=()=>{const{id:X,slotId:ft}=Wt(),[ut,Qe]=w.useState(X),Q=ft||null,ue=Ht(),{toast:ae}=Et(),{user:c,userProfile:u,refreshUserProfile:Be}=It(),[n,ht]=w.useState(null),[k,Te]=w.useState([]),[o,We]=w.useState(null),[he,xe]=w.useState(!0),[ke,pe]=w.useState(""),[He,ge]=w.useState(!1),[xt,pt]=w.useState(!1),[O,be]=w.useState(null),[Fe,gt]=w.useState(!1),[Oe,Ae]=w.useState(null),[bt,Me]=w.useState(0),[V,wt]=w.useState([]),[Le,Ve]=w.useState(!1),vt={hidden:{opacity:0,y:12,scale:.97},show:s=>({opacity:1,y:0,scale:1,transition:{duration:.25,delay:s*.04,ease:[.25,.46,.45,.94]}})};w.useEffect(()=>{(async()=>{let a=!1;if(Q&&!X)try{const{data:i}=await I.from("quiz_slots_view").select("quiz_id").eq("id",Q).maybeSingle();!a&&(i!=null&&i.quiz_id)&&Qe(i.quiz_id)}catch(i){}else Qe(X);return()=>{a=!0}})()},[Q,X]);const v=ut,Ye=w.useRef(0),Z=w.useCallback(async()=>{var i;const s=Ye.current+=1,a=()=>Ye.current!==s;if(!ct||!I||!v){if(!v&&(Q||X))return;pe("Results are unavailable right now."),xe(!1);return}try{a()||pe("");const[t,y]=await Promise.all([I.from("quizzes").select("*").eq("id",v).single(),I.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle()]);if(t.error)throw t.error;const r=t.data;a()||ht(r||null);let p=Array.isArray((i=y.data)==null?void 0:i.leaderboard)?y.data.leaderboard:[];if(r!=null&&r.end_time){const _=new Date(r.end_time).getTime()-Date.now();a()||be(_>0?_:0)}const x=Array.isArray(p)?p.map((g,_)=>{var A;return{...g,rank:(A=g.rank)!=null?A:_+1}}):[];a()||(Te(x),xe(!1));try{const g=r!=null&&r.end_time?new Date(r.end_time).getTime():null,_=typeof g=="number"&&g<=Date.now();a()||ge(_&&x.length===0)}catch(g){a()||ge(!1)}const j=x.find(g=>(g.user_id||g.userId)===(c==null?void 0:c.id));a()||We(j||null);const N=c!=null&&c.id?I.from("quiz_participants").select("id").eq("user_id",c.id).or(Q?`slot_id.eq.${Q},quiz_id.eq.${v}`:`quiz_id.eq.${v}`).limit(1).maybeSingle():Promise.resolve({data:null}),R=(async()=>{try{return Q?await I.from("quiz_slots_view").select("*").eq("id",Q).maybeSingle():await I.rpc("get_engagement_counts",{p_quiz_id:v})}catch(g){return{data:null}}})();p.length===0&&(r!=null&&r.end_time)&&new Date(r.end_time).getTime()<=Date.now()&&Pt(I,v,{throttleMs:0}).then(async _=>{if(!_||a())return;const{data:A}=await I.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle();if(a())return;const $=Array.isArray(A==null?void 0:A.leaderboard)?A.leaderboard:[];$.length&&(Te($.map((z,S)=>{var C;return{...z,rank:(C=z.rank)!=null?C:S+1}})),ge(!1))}).catch(()=>{}),Promise.all([N,R]).then(([g,_])=>{var C,B,J,Ee,ve,je,ye,D,E;if(a())return;const A=!!g.data;pt(A);try{const d=Array.isArray(_.data)?_.data[0]:_.data;if(Q){const U=Number((J=(B=(C=d==null?void 0:d.participants_joined)!=null?C:d==null?void 0:d.joined_count)!=null?B:d==null?void 0:d.joined)!=null?J:0),P=Number((je=(ve=(Ee=d==null?void 0:d.participants_pre)!=null?Ee:d==null?void 0:d.pre_joined_count)!=null?ve:d==null?void 0:d.pre_joined)!=null?je:0),H=Number((ye=d==null?void 0:d.participants_total)!=null?ye:U+P);Me(Number.isFinite(H)?H:0)}else{const U=Number((D=d==null?void 0:d.joined)!=null?D:0),P=Number((E=d==null?void 0:d.pre_joined)!=null?E:0);Me(U+P)}}catch(d){Me(0)}const z=((r==null?void 0:r.category)||"").toLowerCase()!=="opinion"&&(A||x.length),S=x.slice(0,10).map(d=>d.user_id).filter(Boolean);Promise.all([z?I.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",v).order("id"):Promise.resolve({data:[]}),S.length?I.rpc("profiles_public_by_ids",{p_ids:S}):Promise.resolve({data:[]})]).then(async([d,U])=>{if(!a()){try{if(z&&Array.isArray(d.data)&&d.data.length){let P=new Map;if(c!=null&&c.id){const M=d.data.map(T=>T.id),{data:L}=await I.from("user_answers").select("question_id, selected_option_id").in("question_id",M).eq("user_id",c.id);Array.isArray(L)&&(P=new Map(L.map(T=>[T.question_id,T.selected_option_id])))}const H=d.data.map(M=>({id:M.id,question_text:M.question_text,options:(M.options||[]).map(L=>({id:L.id,option_text:L.option_text,is_correct:!!L.is_correct,isSelected:P.get(M.id)===L.id}))}));wt(H)}}catch(P){}try{if(Array.isArray(U.data)&&U.data.length){const P=new Map(U.data.map(M=>[M.id,M])),H=await Bt(U.data.map(M=>M.avatar_url).filter(Boolean));a()||Te(M=>M.map(L=>{const T=P.get(L.user_id);if(!T)return L;const re=T.avatar_url&&H.get(T.avatar_url)||"";return{...L,profiles:{username:T.username,full_name:T.full_name,avatar_url:re}}}))}}catch(P){}}}).catch(()=>{})}).catch(()=>{})}catch(t){console.error("Error fetching results:",t),ge(!1),pe((t==null?void 0:t.message)||"Failed to load results."),xe(!1)}},[v,X,Q,c==null?void 0:c.id]);w.useEffect(()=>{v&&Z()},[Z,v]);const Ge=()=>{xe(!0),pe(""),Z()},ne=(n==null?void 0:n.prize_type)||"coins",we=o!=null&&o.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[o.rank-1]?n.prizes[o.rank-1]:0,jt=Ce(ne,we,{fallback:0});w.useEffect(()=>{let s=!1;return(async()=>{try{if(k.length===0){Ae(null);return}const i=await Re();s||Ae(i)}catch(i){s||Ae(null)}})(),()=>{s=!0}},[k.length,v,o==null?void 0:o.rank,o==null?void 0:o.score,u==null?void 0:u.full_name,u==null?void 0:u.username,c==null?void 0:c.id,u==null?void 0:u.referral_code,we]),w.useEffect(()=>{try{if(!(c!=null&&c.id)||!Array.isArray(n==null?void 0:n.prizes)||!(o!=null&&o.rank))return;(n.prizes[o.rank-1]||0)>0&&Be(c)}catch(s){}},[c,o==null?void 0:o.rank,n==null?void 0:n.prizes,Be]);const Re=w.useCallback(async()=>{try{const i=document.createElement("canvas");i.width=1080,i.height=1920;const t=i.getContext("2d");t.textBaseline="top";const y="Inter, system-ui, -apple-system, Segoe UI, Roboto",r=(l,m)=>{t.font=`${l} ${m}px ${y}`},p=l=>t.measureText(l).width,x=(l,m,f,h,b)=>{let q=h;for(r(f,q);q>b&&p(l)>m;)q-=2,r(f,q);return q},j=(l,m,f,h)=>{r(f,h);const b=String(l).split(/\s+/),q=[];let W="";for(const te of b){const ze=W?W+" "+te:te;p(ze)<=m?W=ze:(W&&q.push(W),W=te)}return W&&q.push(W),q},N=(l,m,f,h,b,q,W,te,ze)=>{let G=q,ce=j(l,h,b,G);for(;(ce.length>te||ce.some(se=>p(se)>h))&&G>W;)G-=1,ce=j(l,h,b,G);r(b,G),t.fillStyle=ze;const lt=Math.round(G*1.25),ot=Math.min(te,ce.length);for(let se=0;se<ot;se++){const dt=ce[se],Lt=p(dt);t.fillText(dt,m-Lt/2,f+se*lt)}return{height:ot*lt,size:G}},R=(l,m)=>{let f=String(l);for(;f&&p(f)>m;)f=f.slice(0,-1);return f.length<String(l).length?f.slice(0,Math.max(0,f.length-1))+"â€¦":f},g=l=>new Promise((m,f)=>{const h=new Image;h.crossOrigin="anonymous",h.onload=()=>m(h),h.onerror=f,h.src=l}),_=(l,m,f,h,b)=>{t.beginPath(),t.moveTo(l+b,m),t.lineTo(l+f-b,m),t.quadraticCurveTo(l+f,m,l+f,m+b),t.lineTo(l+f,m+h-b),t.quadraticCurveTo(l+f,m+h,l+f-b,m+h),t.lineTo(l+b,m+h),t.quadraticCurveTo(l,m+h,l,m+h-b),t.lineTo(l,m+b),t.quadraticCurveTo(l,m,l+b,m),t.closePath()},A=t.createLinearGradient(0,0,1080,1920);A.addColorStop(0,"#150a36"),A.addColorStop(1,"#0f0926"),t.fillStyle=A,t.fillRect(0,0,1080,1920);const $=64,z=1080/2;let S=$+12;const C=140,B=S+C;t.save(),t.beginPath(),t.arc(z,B,C,0,Math.PI*2),t.closePath();const J=t.createLinearGradient(z-C,B-C,z+C,B+C);J.addColorStop(0,"#1cc5ff"),J.addColorStop(1,"#ef47ff"),t.fillStyle=J,t.fill();try{const m=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let f;try{f=await g(m)}catch(q){f=await g("/android-chrome-192x192.png")}const h=16,b=C*2-h;t.save(),t.beginPath(),t.arc(z,B,C-h/2,0,Math.PI*2),t.clip(),t.drawImage(f,Math.round(z-b/2),Math.round(B-b/2),Math.round(b),Math.round(b)),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.7)",t.beginPath(),t.arc(z,B,C-h/2,0,Math.PI*2),t.stroke()}catch(l){}t.restore(),S=B+C+18;const ve=`ðŸ… ${((u==null?void 0:u.full_name)||(u==null?void 0:u.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,je=N(ve,z,S,1080-$*2,"900",56,34,2,"#ffd54a");S+=je.height+16;const ye=N("âœ¨ Brains = Fame âœ¨",z,S,1080-$*2,"700",36,22,1,"rgba(255,255,255,0.9)");S+=ye.height+28;const D=$,E=1080-$*2,d=D+56,U=48,P=40,H=o!=null&&o.rank?`#${o.rank} Rank!`:"Results Live!",L=`ðŸ‘‘ Prize: ${Ce(ne,we,{fallback:0}).formatted}`,T=typeof(o==null?void 0:o.score)=="number"?`â˜‘ï¸ Score: ${o.score}`:"",re=x(H,E-100,"900",112,80),Ie=x(L,E-100,"900",48,32),Pe=T?x(T,E-100,"900",44,28):0,zt=Math.round(re*1)+24+Math.round(Ie*1.15)+12+(T?Math.round(Pe*1.15)+12:0),Xe=U+zt+P,ie=S,qe=t.createLinearGradient(D,ie,D+E,ie);qe.addColorStop(0,"rgba(34,211,238,0.9)"),qe.addColorStop(1,"rgba(236,72,153,0.9)"),t.save(),_(D,ie,E,Xe,36),t.fillStyle="rgba(15,23,42,0.72)",t.fill(),t.lineWidth=4,t.strokeStyle=qe,t.stroke(),t.restore();let K=ie+U;r("900",re),t.fillStyle="#ffffff",t.fillText(H,d,K),K+=Math.round(re*1)+24,r("900",Ie),t.fillStyle="#ffd54a",t.fillText(L,d,K),K+=Math.round(Ie*1.15)+12,T&&(r("900",Pe),t.fillStyle="rgba(168,255,230,0.95)",t.fillText(T,d,K),K+=Math.round(Pe*1.15)+12),S=ie+Xe+28;const Ze=230,Je=Math.max(120,1920-$-Ze-S),$e="âš¡ My Result is Live!",De=x($e,E-120,"900",48,26),Ct="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",Ne=26,Ke=Math.round(Ne*1.25);r("700",Ne);const et=j(Ct,E-120,"700",Ne).slice(0,2),Tt=et.length*Ke;let _e=28+Math.round(De)+12+Tt+28;_e>Je&&(_e=Je);const Se=S;_(D,Se,E,_e,28),t.fillStyle="rgba(8,11,30,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(56,189,248,0.5)",t.stroke(),r("900",De),t.fillStyle="#facc15";const kt=p($e);t.fillText($e,z-kt/2,Se+28),r("700",Ne),t.fillStyle="rgba(226,232,240,0.92)";let tt=Se+28+Math.round(De)+12;for(const l of et){const m=p(l);t.fillText(l,z-m/2,tt),tt+=Ke}S=Se+_e+24;const F=S,le=Math.max(Ze,Math.min(280,1920-$-F));_(D,F,E,le,24),t.fillStyle="rgba(12,10,36,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(79,70,229,0.45)",t.stroke();const At=u!=null&&u.referral_code?u.referral_code:c!=null&&c.id?c.id.replace(/-/g,"").slice(0,8).toUpperCase():"",oe=qt(At),Mt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(oe)}`;if(oe)try{const l=$t();(!l||l!==oe)&&Dt(oe)}catch(l){}const de=Math.min(220,le-72),st=de+32,at=de+40,Ue=D+E-st-36,nt=F+Math.max(24,Math.round((le-at)/2));_(Ue,nt,st,at,18),t.fillStyle="#ffffff",t.fill();try{const{default:l}=await Rt(()=>import("./browser-864b0b18.js").then(f=>f.b),[]),m=document.createElement("canvas");await l.toCanvas(m,Mt,{width:de,margin:1,color:{dark:"#000000",light:"#ffffff"}}),t.drawImage(m,Ue+16,nt+16,de,de)}catch(l){}const Y=D+36,ee=Ue-24-Y;t.fillStyle="rgba(255,255,255,0.96)",r("900",48),t.fillText(R("ðŸ§  Play & Win",ee),Y,F+36),t.fillStyle="rgba(203,213,225,0.98)",r("800",36),t.fillText(R("ðŸŒ www.quizdangal.com",ee),Y,F+36+54),r("900",44),t.fillStyle="rgba(255,255,255,0.96)";const rt="ðŸ”— Referral: ",it=p(rt);return t.fillText(R(rt,ee),Y,F+36+54+62),t.fillStyle="rgba(0,255,198,1)",t.fillText(R(oe,Math.max(0,ee-it-8)),Y+it,F+36+54+62),r("700",26),t.fillStyle="rgba(226,232,240,0.92)",t.fillText(R("Your turn to flex your brain ðŸ’¯",ee),Y,F+le-80),r("700",24),t.fillStyle="rgba(203,213,225,0.92)",t.fillText(R("#QuizDangal  #ChallengeAccepted  #PlayToWin",ee),Y,F+le-44),await new Promise(l=>i.toBlob(l,"image/jpeg",.92))}catch(s){try{const a=document.createElement("canvas");a.width=8,a.height=8;const i=a.getContext("2d"),t=i.createLinearGradient(0,0,8,8);return t.addColorStop(0,"#130531"),t.addColorStop(1,"#1e0b4b"),i.fillStyle=t,i.fillRect(0,0,8,8),await new Promise(r=>a.toBlob(r,"image/jpeg",.9))}catch(a){return null}}},[c==null?void 0:c.id,u==null?void 0:u.full_name,u==null?void 0:u.username,u==null?void 0:u.referral_code,o==null?void 0:o.rank,o==null?void 0:o.score,ne,we]);w.useEffect(()=>{if(!(n!=null&&n.end_time)||k.length>0){be(null);return}const s=new Date(n.end_time).getTime(),a=()=>{const t=s-Date.now();t>0?be(t):(be(0),Fe||(gt(!0),Z()))};a();const i=setInterval(a,1e3);return()=>clearInterval(i)},[n==null?void 0:n.end_time,k.length,Fe,Z]);const yt=(()=>{var s,a;try{const i=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},t=(a=(s={}.VITE_ENABLE_REALTIME)!=null?s:i.VITE_ENABLE_REALTIME)!=null?a:"1",y=String(t).toLowerCase();return y==="1"||y==="true"||y==="yes"}catch(i){return!1}})(),Nt=(()=>{try{if(!yt||!ct||!I||!v||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();Ut({enabled:k.length===0&&Nt,channelName:`quiz-results-${v}`,table:"quiz_results",filter:`quiz_id=eq.${v}`,onChange:Z,joinTimeoutMs:5e3});const _t=async()=>{try{let s=Oe;if(s||(s=await Re()),s&&navigator.canShare&&window.File){const a=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[a]})){await navigator.share({files:[a],title:"Quiz Dangal Result"}),ae({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="quiz-dangal-result.jpg",i.rel="noopener",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(a),1500),ae({title:"Poster saved",description:"Share the image from your gallery."});return}ae({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){ae({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},St=async()=>{try{let s=Oe;if(s||(s=await Re()),s&&navigator.canShare&&window.File){const j=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[j]})){await navigator.share({files:[j],title:"Quiz Dangal Result"});return}}if(s)try{const j=URL.createObjectURL(s),N=document.createElement("a");N.href=j,N.download="quiz-dangal-result.jpg",N.rel="noopener",document.body.appendChild(N),N.click(),document.body.removeChild(N),setTimeout(()=>URL.revokeObjectURL(j),1500)}catch(j){}const a=navigator.userAgent||"",i=/Android/i.test(a),t=/iPhone|iPad|iPod/i.test(a),y="whatsapp://send",r="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",p="https://wa.me/",x=j=>!!window.open(j,"_blank");if(i){if(x(y))return;window.location.href=r,setTimeout(()=>{document.hidden||(window.location.href=p)},700);return}if(t){window.location.href=y,setTimeout(()=>{document.hidden||(window.location.href=p)},700);return}x(p)}catch(s){ae({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};if(he)return e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24",children:[e.jsx(fe,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-slate-700/60 via-slate-600/50 to-slate-700/60 animate-pulse",children:e.jsx("div",{className:"rounded-xl bg-slate-900/95 p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 w-24 bg-slate-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-40 bg-slate-800 rounded"})]}),e.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-700"})]})})}),e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-slate-700/50 via-slate-600/40 to-slate-700/50 animate-pulse",children:e.jsx("div",{className:"rounded-xl bg-slate-900/95 p-3",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-14 bg-slate-800 rounded-lg"},s))})})}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3 animate-pulse",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-700 rounded mb-3"}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-slate-800/50",children:[e.jsx("div",{className:"w-7 h-7 rounded-md bg-slate-700"}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-700"}),e.jsx("div",{className:"flex-1 h-3 bg-slate-700 rounded"}),e.jsx("div",{className:"w-10 h-3 bg-slate-700 rounded"})]},s))})]})]})]});if(!he&&ke)return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(fe,{title:"Results â€“ Error | Quiz Dangal",description:ke||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),e.jsx("p",{className:"text-slate-300 mb-4",children:ke}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(me,{variant:"brand",onClick:Ge,children:"Retry"}),e.jsx(me,{variant:"white",onClick:()=>ue("/my-quizzes/"),children:"Back"})]})]})]});if(!he&&(O!=null?O:0)>0&&k.length===0){const s=p=>{const x=Math.max(0,Math.floor(p/1e3)),j=Math.floor(x/86400),N=Math.floor(x%86400/3600),R=Math.floor(x%3600/60),g=x%60;return{days:j,hours:N,minutes:R,seconds:g}},{days:a,hours:i,minutes:t,seconds:y}=s(O),r=(p,x)=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:p.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:x})]});return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(fe,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Results will be published soon."}),e.jsx("p",{className:"text-slate-300 mb-4",children:"Quiz ends in"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a>0&&r(a,"Days"),r(i,"Hours"),r(t,"Minutes"),r(y,"Seconds")]}),(n==null?void 0:n.end_time)&&e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Expected publish time: ",new Date(n.end_time).toLocaleString()]}),e.jsx(me,{variant:"brand",className:"w-full",onClick:()=>ue("/"),children:"Back to Home"})]})]})}return!he&&(O!=null?O:0)===0&&k.length===0&&(He||n!=null&&n.end_time)?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(fe,{title:"Results â€“ Finalizing | Quiz Dangal",description:"Finalizing quiz results.",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Finalizing resultsâ€¦"}),e.jsx("p",{className:"text-slate-300 mb-4",children:He?"Please wait a moment.":"Results are being prepared."}),e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-b"})}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(me,{variant:"brand",onClick:Ge,children:"Refresh"}),e.jsx(me,{variant:"white",onClick:()=>ue("/my-quizzes/"),children:"Back"})]})]})]}):e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(fe,{title:`${n!=null&&n.title?`${n.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:k.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(mt,{className:"w-5 h-5 text-amber-400"}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:n==null?void 0:n.title}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),e.jsxs("span",{children:[bt||(k==null?void 0:k.length)||0," participants"]})]})]}),(o==null?void 0:o.rank)&&e.jsxs("div",{className:"shrink-0 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:e.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",o.rank]})}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(n==null?void 0:n.prizes)&&n.prizes.length>0&&e.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:n.prizes.slice(0,5).map((s,a)=>{const i=Ce(ne,s,{fallback:0}),t=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":`#${a+1}`;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("span",{children:i.formatted})]},a)})})]})}),c&&(o||xt)&&e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold text-white",children:o?"Your Result":"You Participated"}),o&&e.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",k.length]})]}),((V==null?void 0:V.length)||0)>0&&e.jsxs("button",{type:"button",onClick:()=>Ve(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${Le?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":Le,children:[e.jsx(Ot,{className:"w-3 h-3"}),"Q&A"]})]}),o?e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),e.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",o.rank]})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),e.jsx("p",{className:"text-base font-bold text-emerald-400",children:o.score})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),e.jsx("p",{className:"text-base font-bold text-purple-400",children:jt.formatted})]})]}):e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),Le&&((V==null?void 0:V.length)||0)>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[e.jsx(Vt,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),e.jsx("button",{type:"button",onClick:()=>Ve(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),e.jsx("div",{className:"space-y-2",children:V.map((s,a)=>e.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[e.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[e.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",a+1,"."]}),s.question_text]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(i=>{const t=!!i.is_correct,y=!!i.isSelected,r=t?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":y?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return e.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${r}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsx("span",{children:"âœ“"}),y&&!t&&e.jsx("span",{children:"âœ—"}),e.jsx("span",{className:"truncate",children:i.option_text})]})},i.id)})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[e.jsx(mt,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),e.jsxs("div",{className:"space-y-1.5",children:[k.length===0&&e.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),k.map((s,a)=>{var x,j,N,R,g;const i=s.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[s.rank-1]?n.prizes[s.rank-1]:0,t=Ce(ne,i,{fallback:0}),y=s.user_id===(c==null?void 0:c.id),r=a<3,p=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":null;return e.jsxs(Qt.div,{custom:a,variants:vt,initial:"hidden",animate:"show",whileHover:{scale:1.01,transition:{duration:.15}},className:`flex items-center justify-between gap-2 p-2 rounded-lg border transition-colors duration-200 ${y?"bg-indigo-950/40 border-indigo-600/40":r?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${r?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:p||`#${s.rank||a+1}`}),e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(x=s.profiles)!=null&&x.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{children:(((j=s.profiles)==null?void 0:j.full_name)||((N=s.profiles)==null?void 0:N.username)||"U").charAt(0).toUpperCase()})}),e.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((R=s.profiles)==null?void 0:R.username)||((g=s.profiles)==null?void 0:g.full_name)||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),e.jsx("div",{className:"text-right min-w-[50px]",children:e.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:t.formatted})})]})]},`${s.id}-${a}`)})]})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:e.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>ue("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Back"]}),e.jsxs("button",{onClick:St,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),e.jsxs("button",{onClick:_t,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{is as default};
