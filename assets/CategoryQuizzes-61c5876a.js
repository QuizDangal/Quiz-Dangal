import{m as mt,i as Tt,u as Et,l as Lt,j as s,f as ut,b as Q,p as pt,e as C,o as kt,c as gt}from"./index-b52a2ac4.js";import{r as _}from"./react-63c462fe.js";import{m as Mt}from"./motion-lite-a13d6934.js";import{s as At}from"./smartJoinQuiz-5f6ad90c.js";import{S as $t}from"./SEO-901346bc.js";import{c as Ct,b as Pt,u as qt}from"./router-d6d570a4.js";import{b as Jt,c as Qt,M as xt,B as Ut,T as Ot,a as Bt}from"./icons-2bdec3f2.js";import"./supabase-24c2e735.js";function Ft(e){var u,D,g,p,j,c,y,N,v,w;if(!e)return null;const a=Number((g=(D=(u=e.participants_joined)!=null?u:e.joined_count)!=null?D:e.joined)!=null?g:0),m=Number((c=(j=(p=e.participants_pre)!=null?p:e.pre_joined_count)!=null?j:e.pre_joined)!=null?c:0),d=Number((y=e.participants_total)!=null?y:a+m);return{slotId:e.id||e.slot_id||e.slotid||e.slotID||e.slot_uuid||e.slot_uuid_id||e.slot_uuid_ref||e.quiz_slot_id||e.quiz_slot_uuid||e.slot_uuid_value||e.slot_ref||e.slot_reference||e.slot||null,quizId:e.quiz_id||e.quizid||e.quiz_uuid||e.quiz_uuid_id||e.quiz||null,category:e.category||null,title:e.quiz_title||e.title||e.slot_title||null,start_time:e.start_time||e.slot_start||e.starts_at||null,end_time:e.end_time||e.slot_end||e.ends_at||null,status:e.status||"scheduled",prizes:Array.isArray(e.prizes)?e.prizes:Array.isArray(e.quiz_prizes)?e.quiz_prizes:[],questions:Array.isArray(e.questions)?e.questions:[],prize_type:e.prize_type||e.quiz_prize_type||"coins",participants_joined:a,participants_pre:m,participants_total:d,questions_count:Number((w=(v=(N=e.questions_count)!=null?N:e.question_count)!=null?v:e.q_count)!=null?w:0),auto_enabled:typeof e.auto_enabled=="boolean"?e.auto_enabled:void 0,stop_override:!!e.stop_override}}async function Vt(e,a){if(!e)return{slots:[],mode:"none",auto:!0};let m=[],d=[],u=!0;try{const{data:c,error:y}=await e.from("quiz_slots_view").select("*").eq("category",a).order("start_time",{ascending:!0});!y&&c&&(m=c.map(Ft))}catch(c){mt.debug("quiz_slots_view error",c.message||c)}try{const{data:c,error:y}=await e.from("quizzes").select("id,title,start_time,end_time,status,prizes,prize_type,slot_id,questions(count)").eq("category",a).order("start_time",{ascending:!0});if(!y&&c){const N=Date.now(),v=(c||[]).filter(x=>!x.slot_id);let w={};if(v.length>0)try{const{data:x}=await e.rpc("get_engagement_counts_many",{p_quiz_ids:v.map(b=>b.id)});if(x)for(const b of x)w[b.quiz_id]=(b.pre_joined||0)+(b.joined||0)}catch(x){}d=v.map(x=>{var b,U;return{slotId:x.id,quizId:x.id,category:a,title:x.title,quiz_title:x.title,start_time:x.start_time,end_time:x.end_time,status:Wt(x,N),prizes:Array.isArray(x.prizes)?x.prizes:[],prize_type:x.prize_type||"coins",participants_joined:w[x.id]||0,participants_total:w[x.id]||0,questions_count:((U=(b=x.questions)==null?void 0:b[0])==null?void 0:U.count)||0,auto_enabled:!0,isLegacy:!0}})}}catch(c){mt.debug("Legacy quizzes fetch error",c.message||c)}try{const{data:c,error:y}=await e.from("category_runtime_overrides").select("category,auto_enabled:is_auto").eq("category",a).maybeSingle();!y&&c&&(u=!!c.auto_enabled)}catch(c){}const D=new Set(m.map(c=>c.quizId).filter(Boolean)),g=d.filter(c=>!D.has(c.quizId)),p=[...m,...g];p.sort((c,y)=>{const N=c.start_time?new Date(c.start_time).getTime():0,v=y.start_time?new Date(y.start_time).getTime():0;return N-v});const j=m.length>0?"slots":g.length>0?"legacy":"none";return{slots:p,mode:j,auto:u}}function Wt(e,a){const m=e.start_time?new Date(e.start_time).getTime():null,d=e.end_time?new Date(e.end_time).getTime():null;return m&&d&&a>=m&&a<d?"active":m&&a<m?"scheduled":d&&a>=d?"finished":"scheduled"}function Gt(e){const a=Date.now(),m=e.find(g=>{const p=g!=null&&g.start_time?new Date(g.start_time).getTime():null,j=g!=null&&g.end_time?new Date(g.end_time).getTime():null;return p&&j&&a>=p&&a<j}),d=e.filter(g=>{const p=g!=null&&g.start_time?new Date(g.start_time).getTime():null;return p?a<p:!1});d.sort((g,p)=>new Date(g.start_time).getTime()-new Date(p.start_time).getTime());const u=d[0]||null,D=d[1]||null;return{live:m,next:u,queued:D}}const P=new Map;let ht=0;function G(e){if(!(ht%200!==0&&P.size<100))for(const[a,m]of P.entries()){const d=(m.windowMs||8e3)*2;e-m.firstTs>d&&P.delete(a)}}function Rt(e,{max:a=5,windowMs:m=8e3}={}){ht+=1;const d=Date.now(),u=P.get(e);return u?d-u.firstTs>u.windowMs?(P.set(e,{count:1,firstTs:d,windowMs:m}),G(d),{allowed:!0,remaining:a-1}):u.count>=a?(G(d),{allowed:!1,remaining:0}):(u.count+=1,G(d),{allowed:!0,remaining:a-u.count}):(P.set(e,{count:1,firstTs:d,windowMs:m}),G(d),{allowed:!0,remaining:a-1})}function Ht(e=""){const a=String(e||"").toLowerCase();return a.includes("opinion")?{title:"Opinion Quizzes",emoji:"ðŸ’¬",Icon:xt,from:"from-indigo-600/30",to:"to-fuchsia-600/30",ring:"ring-fuchsia-500/30"}:a.includes("gk")?{title:"GK Quizzes",emoji:"ðŸ§ ",Icon:Ut,from:"from-emerald-600/30",to:"to-teal-600/30",ring:"ring-emerald-500/30"}:a.includes("sport")?{title:"Sports Quizzes",emoji:"ðŸ†",Icon:Ot,from:"from-orange-600/30",to:"to-red-600/30",ring:"ring-orange-500/30"}:a.includes("movie")?{title:"Movie Quizzes",emoji:"ðŸŽ¬",Icon:Bt,from:"from-violet-600/30",to:"to-indigo-600/30",ring:"ring-violet-500/30"}:{title:`${e} Quizzes`,emoji:"â­",Icon:xt,from:"from-sky-600/30",to:"to-indigo-600/30",ring:"ring-sky-500/30"}}const R=e=>e!=null&&e.start_time?new Date(e.start_time).getTime():null,_t=e=>e!=null&&e.end_time?new Date(e.end_time).getTime():null,ft=e=>{const a=R(e),m=_t(e);if(!a||!m)return!1;const d=Date.now();return d>=a&&d<m},Kt=e=>{const a=R(e);return a?Date.now()<a:!1},re=()=>{const{slug:e}=Ct(),a=Pt(),m=qt(),{toast:d}=Tt(),{user:u}=Et(),{isSubscribed:D,subscribeToPush:g}=Lt(),[p]=_.useState([]),[j,c]=_.useState(!0),[y,N]=_.useState(null),[v,w]=_.useState({}),[x,b]=_.useState({}),[U,nt]=_.useState(0),[I,yt]=_.useState([]),[T,H]=_.useState("detect"),[bt,zt]=_.useState(!0),jt=2e4,O=_.useCallback(async()=>{if(C)try{const{slots:t,mode:r,auto:i}=await Vt(C,e);yt(t),zt(i),H(r==="slots"||r==="legacy"?"slots":"legacy")}catch(t){H("legacy")}},[e]);_.useEffect(()=>{c(!0),O().finally(()=>{c(!1)})},[O,e]),_.useEffect(()=>{if(T==="none")return;const t=setInterval(()=>{O()},jt);return()=>clearInterval(t)},[T,O]),_.useEffect(()=>{const t=Date.now();if(!(p||[]).some(n=>{const l=n.start_time?new Date(n.start_time).getTime():0,o=n.end_time?new Date(n.end_time).getTime():0;return l&&t<l||l&&o&&t>=l&&t<o}))return;const i=setInterval(()=>nt(n=>(n+1)%1e6),1e3);return()=>clearInterval(i)},[p]),_.useEffect(()=>{if(T!=="slots")return;const t=Date.now();if(!(I||[]).some(n=>{const l=n.start_time?new Date(n.start_time).getTime():0,o=n.end_time?new Date(n.end_time).getTime():0;return l&&t<l||l&&o&&t>=l&&t<o}))return;const i=setInterval(()=>nt(n=>(n+1)%1e6),1e3);return()=>clearInterval(i)},[I,T]),_.useEffect(()=>{const t=async()=>{try{const r=(p||[]).map(o=>o.id);if(!r.length){w({});return}const{data:i,error:n}=await C.rpc("get_engagement_counts_many",{p_quiz_ids:r});if(n)throw n;const l={};for(const o of i||[]){const f=o.pre_joined||0,h=o.joined||0;l[o.quiz_id]=f+h}w(l)}catch(r){}};p&&p.length&&t()},[p]),_.useEffect(()=>{(async()=>{const r=(p||[]).map(o=>o.id).filter(Boolean),i=(I||[]).filter(o=>!o.isLegacy).map(o=>o.slotId).filter(Boolean),n=(I||[]).filter(o=>o.isLegacy).map(o=>o.quizId).filter(Boolean),l=[...new Set([...r,...n])];if(!u||!l.length&&!i.length){b({});return}try{const o={};if(l.length){const{data:f,error:h}=await C.from("quiz_participants").select("quiz_id,status").eq("user_id",u.id).in("quiz_id",l);if(!h&&f)for(const z of f)o[z.quiz_id]=z.status==="pre_joined"?"pre":"joined"}if(i.length){const{data:f,error:h}=await C.from("quiz_participants").select("slot_id,status").eq("user_id",u.id).in("slot_id",i);if(!h&&f)for(const z of f)o[z.slot_id]=z.status==="pre_joined"?"pre":"joined"}b(o)}catch(o){b({})}})()},[u,p,I]);const rt=async t=>{if(!u){d({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),a("/login");return}const r=t.slotId||t.id;try{const i=String((t==null?void 0:t.status)||"").trim().toLowerCase();if(i==="paused"||i==="stopped"||i==="skipped"||t!=null&&t.stop_override){d({title:"Paused",description:"This category is paused right now. Please try later.",variant:"destructive"});return}}catch(i){}N(r);try{typeof Notification!="undefined"&&Notification.permission!=="granted"&&!D&&Promise.resolve().then(()=>g()).catch(()=>{})}catch(i){}try{const i=await At({supabase:C,quiz:t,user:u});if(i.status==="error")throw i.error;i.status==="already"?(b(n=>({...n,[r]:"joined"})),d({title:"Already Joined",description:"You are in this quiz."})):i.status==="joined"?(b(l=>({...l,[r]:"joined"})),Rt(`join_${(u==null?void 0:u.id)||"anon"}`,{max:4,windowMs:8e3}).allowed?(d({title:"Joined!",description:"Taking you to the quiz."}),a(t.slotId&&!t.isLegacy?`/quiz/slot/${t.slotId}`:`/quiz/${t.id}`)):d({title:"Slow down",description:"Please wait a moment before trying again.",variant:"destructive"})):i.status==="pre_joined"?(b(n=>({...n,[r]:"pre"})),d({title:"Pre-joined!",description:"We will remind you before start."})):i.status==="scheduled_retry"&&(b(n=>({...n,[r]:"pre"})),d({title:"Pre-joined!",description:"Auto joining at start time."}))}catch(i){const n=kt(i);d({title:"Error",description:n||(i==null?void 0:i.message)||"Could not join quiz.",variant:"destructive"})}finally{N(null)}},at=p.filter(t=>{if(T==="slots")return!1;const r=Date.now(),i=t.start_time?new Date(t.start_time).getTime():0,n=t.end_time?new Date(t.end_time).getTime():0,l=i&&n&&r>=i&&r<n,o=i&&r<i;return l||o}),B=Ht(e),M=Date.now(),K=T==="slots",q=K?I:p||[],vt=K?q.filter(t=>ft(t)).length:q.reduce((t,r)=>{const i=r.start_time?new Date(r.start_time).getTime():0,n=r.end_time?new Date(r.end_time).getTime():0;return t+(i&&n&&M>=i&&M<n?1:0)},0),Nt=q.filter(t=>{const r=t.start_time?new Date(t.start_time).getTime():0;return!r||M>=r?!1:t.isLegacy?!0:r-M<=300*1e3}).length,Y=K?q.map(t=>R(t)).filter(t=>t&&t>M).sort((t,r)=>t-r)[0]||null:q.map(t=>t.start_time?new Date(t.start_time).getTime():null).filter(t=>t&&t>M).sort((t,r)=>t-r)[0]||null,{next:F}=Gt(I),wt=t=>{var lt,dt,ct;if(!t)return null;const r=Date.now(),i=R(t),n=_t(t),l=ft(t),o=t.status==="paused",f=t.status==="finished"||n&&r>=n,h=Kt(t),z=h&&i?Math.max(0,Math.floor((i-r)/1e3)):l&&n?Math.max(0,Math.floor((n-r)/1e3)):null,E=Array.isArray(t.prizes)?t.prizes:[],X=t.prize_type||"coins",Z=(lt=E[0])!=null?lt:0,tt=(dt=E[1])!=null?dt:0,et=(ct=E[2])!=null?ct:0,L=Dt=>gt(X,Dt,{fallback:0}).formatted,st=t.participants_total||t.participants_joined||0,V=t.questions_count||10,W=!bt&&!l&&!h,k=l&&!f?"LIVE":o?"PAUSED":W?"STOPPED":h?"UPCOMING":f?"FINISHED":(t.status||"").toUpperCase(),J=t.isLegacy?t.quizId:t.slotId,S=!!x[J],A=y===J,ot=f?"Results":l?S?"Play":"Join Now":h?S?"Joined âœ“":"Pre-Join":"View",St=async()=>{if(f){a(t.isLegacy?`/quiz/${t.quizId}`:`/quiz/slot/${t.slotId}`);return}if(!u){d({title:"Login Required",description:"Please login to join the quiz.",variant:"destructive"}),a("/login",{state:{from:m.pathname,message:"Login to join the quiz"}});return}if(S&&!l){a(t.isLegacy?`/quiz/${t.quizId}`:`/quiz/slot/${t.slotId}`);return}if(l){a(t.isLegacy?`/quiz/${t.quizId}`:`/quiz/slot/${t.slotId}`);return}h&&!S&&await rt({id:t.quizId,...t})};return s.jsx("div",{className:`p-[1px] rounded-xl sm:rounded-2xl ${l?"bg-gradient-to-r from-emerald-500/60 to-green-500/60":"bg-gradient-to-r from-indigo-500/40 via-violet-500/30 to-fuchsia-500/40"}`,children:s.jsxs("div",{className:"rounded-xl sm:rounded-2xl bg-slate-900/95 p-3 sm:p-4 lg:p-5",children:[s.jsx("div",{className:"flex justify-end mb-1.5 sm:mb-2",children:s.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-md text-[9px] sm:text-[11px] font-bold ${k==="LIVE"?"bg-rose-600 text-white":k==="UPCOMING"?"bg-sky-600 text-white":k==="PAUSED"?"bg-amber-600 text-white":"bg-slate-700 text-slate-300"}`,children:k})}),s.jsx("h3",{className:"text-sm sm:text-base font-bold text-white mb-2 sm:mb-3 line-clamp-2",children:t.quiz_title||t.title||"Quiz"}),s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 text-[10px] sm:text-xs text-slate-400 mb-2 sm:mb-3",children:[s.jsxs("div",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded bg-slate-800/60 border border-slate-700/50",children:[s.jsx("span",{className:"text-[9px] sm:text-[10px] text-slate-500",children:"Start"})," ",t.start_time?Q(t.start_time):"â€”"]}),s.jsxs("div",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded bg-slate-800/60 border border-slate-700/50",children:[s.jsx("span",{className:"text-[9px] sm:text-[10px] text-slate-500",children:"End"})," ",t.end_time?Q(t.end_time):"â€”"]})]}),s.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-[10px] sm:text-xs mb-2 sm:mb-3",children:[s.jsxs("span",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-amber-400/10 text-amber-200 border border-amber-500/30 shadow-sm",children:["ðŸ¥‡ ",L(Z)]}),s.jsxs("span",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-r from-sky-500/20 to-sky-400/10 text-sky-200 border border-sky-500/30 shadow-sm",children:["ðŸ¥ˆ ",L(tt)]}),s.jsxs("span",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-r from-violet-500/20 to-violet-400/10 text-violet-200 border border-violet-500/30 shadow-sm",children:["ðŸ¥‰ ",L(et)]})]}),s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2 sm:mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs",children:[s.jsxs("span",{className:"px-2 py-1 rounded-md bg-slate-800/70 border border-slate-700/50 text-slate-300",children:["ðŸ“ ",V," Questions"]}),s.jsxs("span",{className:"px-2 py-1 rounded-md bg-slate-800/70 border border-slate-700/50 text-slate-300",children:["ðŸ‘¥ ",st," Joined"]})]}),z!==null&&s.jsxs("div",{className:"text-xs sm:text-sm font-semibold text-indigo-300",children:[h?"In":"Ends"," ",Math.floor(z/60).toString().padStart(2,"0"),":",(z%60).toString().padStart(2,"0")]})]}),s.jsx("button",{type:"button",disabled:A||S&&h,onClick:St,onMouseEnter:()=>pt(t.isLegacy?`/quiz/${t.quizId}`:`/quiz/slot/${t.slotId}`),className:`w-full h-9 sm:h-10 lg:h-11 rounded-lg text-xs sm:text-sm font-bold text-white transition ${A?"opacity-50 cursor-wait":S&&h?"bg-gradient-to-r from-emerald-700 to-green-600 cursor-default":l?"bg-gradient-to-r from-emerald-600 to-green-500 hover:opacity-90":"bg-gradient-to-r from-indigo-600 to-violet-600 hover:opacity-90"}`,children:A?"Joining...":ot})]})},t.slotId)};_.useEffect(()=>{if(!F)return;const t=F.start_time?new Date(F.start_time).getTime():null;if(!t)return;const r=Date.now(),i=t-r-6e4;if(i<=0||i>1800*1e3)return;const n=setTimeout(()=>{try{d({title:"Upcoming Slot",description:"1 minute to start â€“ be ready!",duration:4e3})}catch(l){}},i);return()=>clearTimeout(n)},[F,d]);const It=typeof window!="undefined"?`${window.location.origin}/category/${e}/`:`https://quizdangal.com/category/${e}/`;return s.jsxs("div",{className:"px-3 sm:px-4 pt-16 sm:pt-20 pb-6",children:[s.jsx($t,{title:`${B.title} â€“ Quiz Dangal`,description:`Active and upcoming quizzes in ${B.title}.`,canonical:It,robots:"index, follow"}),s.jsx("span",{className:"hidden","aria-hidden":!0,children:U}),s.jsxs("div",{className:"max-w-md sm:max-w-2xl lg:max-w-4xl mx-auto space-y-4",children:[s.jsx("div",{className:"p-[1px] rounded-xl sm:rounded-2xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:s.jsxs("div",{className:"rounded-xl sm:rounded-2xl bg-slate-900/95 p-3 sm:p-4 lg:p-5",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-2",children:[s.jsx("div",{className:"w-9 h-9 sm:w-12 sm:h-12 lg:w-14 lg:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center text-lg sm:text-2xl lg:text-3xl",children:B.emoji}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h1",{className:"text-base sm:text-xl lg:text-2xl font-bold text-white truncate",children:B.title}),s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-[10px] sm:text-xs mt-1",children:[s.jsxs("span",{className:"px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded sm:rounded-md bg-emerald-600/20 text-emerald-300 border border-emerald-600/30",children:[vt," live"]}),s.jsxs("span",{className:"px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded sm:rounded-md bg-sky-600/20 text-sky-300 border border-sky-600/30",children:[Nt," upcoming"]})]})]})]}),Y&&s.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs text-slate-400",children:[s.jsx(Jt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Next: ",ut(Y)," â€¢ ",Q(Y)]})]})}),T==="slots"?s.jsx(s.Fragment,{children:j?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:Array.from({length:3}).map((t,r)=>s.jsx("div",{className:"h-40 sm:h-48 lg:h-52 rounded-xl sm:rounded-2xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},r))}):s.jsx(s.Fragment,{children:I.filter(t=>{const r=Date.now(),i=t.start_time?new Date(t.start_time).getTime():null,n=t.end_time?new Date(t.end_time).getTime():null,l=i&&n&&r>=i&&r<n,o=i&&r<i,f=o&&i-r<=300*1e3;return l||(t.isLegacy?o:f)}).length>0?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:I.filter(t=>{const r=Date.now(),i=t.start_time?new Date(t.start_time).getTime():null,n=t.end_time?new Date(t.end_time).getTime():null,l=i&&n&&r>=i&&r<n,o=i&&r<i,f=o&&i-r<=300*1e3;return l||(t.isLegacy?o:f)}).map(t=>wt(t))}):s.jsx("div",{className:"rounded-xl sm:rounded-2xl border border-slate-800 bg-slate-900/50 p-4 sm:p-6 text-center text-sm sm:text-base text-slate-400",children:"No quizzes scheduled yet."})})}):j?s.jsx("div",{className:"grid gap-3 sm:gap-4",children:Array.from({length:4}).map((t,r)=>s.jsx("div",{className:"h-24 sm:h-28 rounded-xl sm:rounded-2xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},r))}):at.length===0?s.jsx("div",{className:"text-center text-muted-foreground py-16",children:"No quizzes in this category yet."}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:at.map((t,r)=>{var it,S,A;const i=Date.now(),n=t.start_time?new Date(t.start_time).getTime():null,l=t.end_time?new Date(t.end_time).getTime():null,o=n&&l&&i>=n&&i<l,f=n&&i<n,h=o||f,z=f&&n?Math.max(0,Math.floor((n-i)/1e3)):o&&l?Math.max(0,Math.floor((l-i)/1e3)):null,E=Array.isArray(t.prizes)?t.prizes:[],X=t.prize_type||"coins",Z=(it=E[0])!=null?it:0,tt=(S=E[1])!=null?S:0,et=(A=E[2])!=null?A:0,L=$=>gt(X,$,{fallback:0}).formatted,st=v[t.id]||0,V=x[t.id],W=!!V,k=n&&l?Math.max(1,l-n):null,J=o&&k?Math.min(100,Math.max(0,Math.round((i-n)/k*100))):null;return s.jsx(Mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:r*.02},onClick:()=>a(`/quiz/${t.id}`),className:"cursor-pointer",role:"button",tabIndex:0,onKeyDown:$=>{$.key==="Enter"&&a(`/quiz/${t.id}`)},children:s.jsx("div",{className:`p-[1px] rounded-xl sm:rounded-2xl ${o?"bg-gradient-to-r from-emerald-500/60 to-green-500/60":"bg-gradient-to-r from-indigo-500/40 via-violet-500/30 to-fuchsia-500/40"}`,children:s.jsxs("div",{className:"rounded-xl sm:rounded-2xl bg-slate-900/95 p-3 sm:p-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsx("h3",{className:"text-sm sm:text-base font-bold text-white flex-1 min-w-0 line-clamp-2",children:t.title}),s.jsxs("div",{className:"shrink-0 flex items-center gap-1",children:[o&&s.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-[9px] sm:text-[10px] font-bold bg-rose-600 text-white",children:"LIVE"}),f&&s.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-[9px] sm:text-[10px] font-bold bg-sky-600 text-white",children:"SOON"}),V&&s.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-[9px] sm:text-[10px] font-semibold bg-indigo-600/20 text-indigo-300 border border-indigo-500/40",children:"Joined"})]})]}),s.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 text-[10px] sm:text-xs mb-2",children:[s.jsxs("span",{className:"px-1.5 sm:px-2 py-1 rounded bg-amber-500/15 text-amber-300 border border-amber-600/30",children:["ðŸ¥‡ ",L(Z)]}),s.jsxs("span",{className:"px-1.5 sm:px-2 py-1 rounded bg-sky-500/15 text-sky-300 border border-sky-600/30",children:["ðŸ¥ˆ ",L(tt)]}),s.jsxs("span",{className:"px-1.5 sm:px-2 py-1 rounded bg-violet-500/15 text-violet-300 border border-violet-600/30",children:["ðŸ¥‰ ",L(et)]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs text-slate-400 mb-2",children:[s.jsx("span",{children:t.start_time?ut(t.start_time):"â€”"}),s.jsxs("span",{className:"px-1.5 sm:px-2 py-0.5 sm:py-1 rounded bg-slate-800/60 border border-slate-700/50",children:[t.start_time?Q(t.start_time):"â€”"," - ",t.end_time?Q(t.end_time):"â€”"]})]}),s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[s.jsxs("div",{className:"flex items-center gap-1 text-[10px] sm:text-xs text-slate-500",children:[s.jsx(Qt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),st," joined"]}),z!==null&&s.jsxs("div",{className:"text-xs sm:text-sm font-semibold text-indigo-300",children:[f?"In":"Ends"," ",Math.floor(z/60).toString().padStart(2,"0"),":",(z%60).toString().padStart(2,"0")]})]}),J!==null&&s.jsx("div",{className:"mb-2 w-full bg-slate-800 rounded-full h-1 sm:h-1.5 overflow-hidden",children:s.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${J}%`}})}),s.jsx("button",{type:"button",onClick:$=>{$.stopPropagation(),W||!h?a(`/quiz/${t.id}`):rt(t)},onMouseEnter:()=>pt("/quiz"),disabled:y===t.id,className:`w-full h-9 sm:h-10 rounded-lg text-xs sm:text-sm font-bold text-white transition ${o?"bg-gradient-to-r from-emerald-600 to-green-500 hover:opacity-90":"bg-gradient-to-r from-indigo-600 to-violet-600 hover:opacity-90"} ${y===t.id?"opacity-80":""}`,children:W?"JOINED":h?y===t.id?"JOININGâ€¦":"JOIN":"VIEW"})]})})},t.id)})})]})]})};export{re as default};
