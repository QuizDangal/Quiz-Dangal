import{_ as At}from"./supabase-07ebd5d8.js";import{e as kt,u as Mt,h as tt,s as A,a as Lt,b as Rt,g as de,n as qt,r as Et,i as It,c as $t,j as e,B as Ae}from"./index-62a9babd.js";import{r as C}from"./react-63c462fe.js";import{m as Ut}from"./motion-lite-3d667e23.js";import{g as Dt}from"./avatar-f9a34966.js";import{S as me}from"./SEO-61bc05c8.js";import{c as Pt,b as Qt}from"./router-d6d570a4.js";import{T as st,c as Wt,Y as Bt,O as Ht,Z as Ot,d as Vt}from"./icons-1e9e0bae.js";const rs=()=>{const{id:W,slotId:at}=Pt(),[nt,ke]=C.useState(W),U=at||null,fe=Qt(),{toast:F}=kt(),{user:c,userProfile:f,refreshUserProfile:Me}=Mt(),[r,rt]=C.useState(null),[M,Le]=C.useState([]),[l,it]=C.useState(null),[ue,he]=C.useState(!0),[pe,se]=C.useState(""),[lt,Re]=C.useState(!1),[ae,ne]=C.useState(null),[qe,ot]=C.useState(!1),[Ee,xe]=C.useState(null),[ct,dt]=C.useState(0),[D,ge]=C.useState([]),[be,Ie]=C.useState(!1),$e=(f==null?void 0:f.role)==="admin",mt={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}};C.useEffect(()=>{(async()=>{if(U&&!W){const{data:n}=await A.from("quiz_slots_view").select("quiz_id").eq("id",U).maybeSingle();n!=null&&n.quiz_id&&ke(n.quiz_id)}else ke(W)})()},[U,W]);const j=nt,B=C.useCallback(async()=>{var s,n;if(!tt||!A||!j){if(!j&&(U||W))return;se("Results are unavailable right now."),he(!1);return}try{se("");const{data:a,error:t}=await A.from("quizzes").select("*").eq("id",j).single();if(t)throw t;rt(a||null);let w=!1;if(c!=null&&c.id)try{let d=null;if(U){const{data:o}=await A.from("quiz_participants").select("id, status").eq("slot_id",U).eq("user_id",c.id).maybeSingle();d=o}if(!d){const{data:o}=await A.from("quiz_participants").select("id, status").eq("quiz_id",j).eq("user_id",c.id).maybeSingle();d=o}if(d)w=!0;else{const{data:o}=await A.from("questions").select("id").eq("quiz_id",j).limit(1);if(o!=null&&o.length){const{data:_}=await A.from("user_answers").select("id").eq("question_id",o[0].id).eq("user_id",c.id).maybeSingle();_&&(w=!0)}}Re(w)}catch(d){console.error("[Results] Participation check error:",d),w=!1,Re(!1)}const u=$e||w||Lt({defaultValue:!0}),{data:p,error:S}=await A.from("quiz_results").select("leaderboard").eq("quiz_id",j).maybeSingle();if(S)throw S;let y=Array.isArray(p==null?void 0:p.leaderboard)?p.leaderboard:[];if((!p||y.length===0)&&(a!=null&&a.end_time)){const o=new Date(a.end_time).getTime()-Date.now();if(ne(o>0?o:0),o<=0&&u)try{await Rt(A,j,{throttleMs:200});const{data:_}=await A.from("quiz_results").select("leaderboard").eq("quiz_id",j).maybeSingle(),T=Array.isArray(_==null?void 0:_.leaderboard)?_.leaderboard:[];T.length&&(y=T)}catch(_){}}const z=Array.isArray(y)?y.map((d,o)=>{var _;return{...d,rank:(_=d.rank)!=null?_:o+1}}):[];Le(z);try{const{data:d}=await A.rpc("get_engagement_counts",{p_quiz_id:j}),o=Array.isArray(d)?d[0]:d,_=Number((s=o==null?void 0:o.joined)!=null?s:0),T=Number((n=o==null?void 0:o.pre_joined)!=null?n:0);dt(_+T)}catch(d){}try{if(((a==null?void 0:a.category)||"").toLowerCase()!=="opinion"&&j&&(w||z.length)){const{data:o}=await A.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",j).order("id");let _=new Map;if(c!=null&&c.id&&Array.isArray(o)&&o.length){const x=o.map(N=>N.id),{data:g}=await A.from("user_answers").select("question_id, selected_option_id").in("question_id",x).eq("user_id",c.id);Array.isArray(g)&&(_=new Map(g.map(N=>[N.question_id,N.selected_option_id])))}const T=(o||[]).map(x=>({id:x.id,question_text:x.question_text,options:(x.options||[]).map(g=>({id:g.id,option_text:g.option_text,is_correct:!!g.is_correct,isSelected:_.get(x.id)===g.id}))}));ge(T)}else ge([])}catch(d){ge([])}try{const d=z.slice(0,10).map(o=>o.user_id);if(d.length){const{data:o}=await A.rpc("profiles_public_by_ids",{p_ids:d});if(Array.isArray(o)&&o.length){const _=new Map(o.map(x=>[x.id,x])),T=await Dt(o.map(x=>x.avatar_url).filter(Boolean));Le(x=>x.map(g=>{const N=_.get(g.user_id);if(!N)return g;const E=N.avatar_url&&T.get(N.avatar_url)||"";return{...g,profiles:{username:N.username,full_name:N.full_name,avatar_url:E}}}))}}}catch(d){}const k=z.find(d=>(d.user_id||d.userId)===(c==null?void 0:c.id));k&&it(k)}catch(a){console.error("Error fetching results:",a),se((a==null?void 0:a.message)||"Failed to load results.")}finally{he(!1)}},[j,W,U,c==null?void 0:c.id,$e]);C.useEffect(()=>{j&&B()},[B,j]);const ft=()=>{he(!0),se(""),B()},G=(r==null?void 0:r.prize_type)||"coins",re=l!=null&&l.rank&&Array.isArray(r==null?void 0:r.prizes)&&r.prizes[l.rank-1]?r.prizes[l.rank-1]:0,ut=de(G,re,{fallback:0});C.useEffect(()=>{let s=!1;return(async()=>{try{if(M.length===0){xe(null);return}const a=await we();s||xe(a)}catch(a){s||xe(null)}})(),()=>{s=!0}},[M.length,j,l==null?void 0:l.rank,l==null?void 0:l.score,f==null?void 0:f.full_name,f==null?void 0:f.username,c==null?void 0:c.id,f==null?void 0:f.referral_code,re]),C.useEffect(()=>{try{if(!(c!=null&&c.id)||!Array.isArray(r==null?void 0:r.prizes)||!(l!=null&&l.rank))return;(r.prizes[l.rank-1]||0)>0&&Me(c)}catch(s){}},[c,l==null?void 0:l.rank,r==null?void 0:r.prizes,Me]);const we=C.useCallback(async()=>{try{const a=document.createElement("canvas");a.width=1080,a.height=1920;const t=a.getContext("2d");t.textBaseline="top";const w="Inter, system-ui, -apple-system, Segoe UI, Roboto",u=(i,m)=>{t.font=`${i} ${m}px ${w}`},p=i=>t.measureText(i).width,S=(i,m,h,b,v)=>{let L=b;for(u(h,L);L>v&&p(i)>m;)L-=2,u(h,L);return L},y=(i,m,h,b)=>{u(h,b);const v=String(i).split(/\s+/),L=[];let q="";for(const V of v){const ce=q?q+" "+V:V;p(ce)<=m?q=ce:(q&&L.push(q),q=V)}return q&&L.push(q),L},z=(i,m,h,b,v,L,q,V,ce)=>{let Q=L,te=y(i,b,v,Q);for(;(te.length>V||te.some(Y=>p(Y)>b))&&Q>q;)Q-=1,te=y(i,b,v,Q);u(v,Q),t.fillStyle=ce;const Je=Math.round(Q*1.25),Ke=Math.min(V,te.length);for(let Y=0;Y<Ke;Y++){const et=te[Y],Tt=p(et);t.fillText(et,m-Tt/2,h+Y*Je)}return{height:Ke*Je,size:Q}},k=(i,m)=>{let h=String(i);for(;h&&p(h)>m;)h=h.slice(0,-1);return h.length<String(i).length?h.slice(0,Math.max(0,h.length-1))+"â€¦":h},d=i=>new Promise((m,h)=>{const b=new Image;b.crossOrigin="anonymous",b.onload=()=>m(b),b.onerror=h,b.src=i}),o=(i,m,h,b,v)=>{t.beginPath(),t.moveTo(i+v,m),t.lineTo(i+h-v,m),t.quadraticCurveTo(i+h,m,i+h,m+v),t.lineTo(i+h,m+b-v),t.quadraticCurveTo(i+h,m+b,i+h-v,m+b),t.lineTo(i+v,m+b),t.quadraticCurveTo(i,m+b,i,m+b-v),t.lineTo(i,m+v),t.quadraticCurveTo(i,m,i+v,m),t.closePath()},_=t.createLinearGradient(0,0,1080,1920);_.addColorStop(0,"#150a36"),_.addColorStop(1,"#0f0926"),t.fillStyle=_,t.fillRect(0,0,1080,1920);const T=64,x=1080/2;let g=T+12;const N=140,E=g+N;t.save(),t.beginPath(),t.arc(x,E,N,0,Math.PI*2),t.closePath();const ye=t.createLinearGradient(x-N,E-N,x+N,E+N);ye.addColorStop(0,"#1cc5ff"),ye.addColorStop(1,"#ef47ff"),t.fillStyle=ye,t.fill();try{const m=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let h;try{h=await d(m)}catch(L){h=await d("/android-chrome-192x192.png")}const b=16,v=N*2-b;t.save(),t.beginPath(),t.arc(x,E,N-b/2,0,Math.PI*2),t.clip(),t.drawImage(h,Math.round(x-v/2),Math.round(E-v/2),Math.round(v),Math.round(v)),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.7)",t.beginPath(),t.arc(x,E,N-b/2,0,Math.PI*2),t.stroke()}catch(i){}t.restore(),g=E+N+18;const bt=`ðŸ… ${((f==null?void 0:f.full_name)||(f==null?void 0:f.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,wt=z(bt,x,g,1080-T*2,"900",56,34,2,"#ffd54a");g+=wt.height+16;const yt=z("âœ¨ Brains = Fame âœ¨",x,g,1080-T*2,"700",36,22,1,"rgba(255,255,255,0.9)");g+=yt.height+28;const $=T,R=1080-T*2,ve=$+56,Ue=48,vt=40,De=l!=null&&l.rank?`#${l.rank} Rank!`:"Results Live!",Pe=`ðŸ‘‘ Prize: ${de(G,re,{fallback:0}).formatted}`,X=typeof(l==null?void 0:l.score)=="number"?`â˜‘ï¸ Score: ${l.score}`:"",je=S(De,R-100,"900",112,80),_e=S(Pe,R-100,"900",48,32),Ne=X?S(X,R-100,"900",44,28):0,jt=Math.round(je*1)+24+Math.round(_e*1.15)+12+(X?Math.round(Ne*1.15)+12:0),Qe=Ue+jt+vt,Z=g,Se=t.createLinearGradient($,Z,$+R,Z);Se.addColorStop(0,"rgba(34,211,238,0.9)"),Se.addColorStop(1,"rgba(236,72,153,0.9)"),t.save(),o($,Z,R,Qe,36),t.fillStyle="rgba(15,23,42,0.72)",t.fill(),t.lineWidth=4,t.strokeStyle=Se,t.stroke(),t.restore();let H=Z+Ue;u("900",je),t.fillStyle="#ffffff",t.fillText(De,ve,H),H+=Math.round(je*1)+24,u("900",_e),t.fillStyle="#ffd54a",t.fillText(Pe,ve,H),H+=Math.round(_e*1.15)+12,X&&(u("900",Ne),t.fillStyle="rgba(168,255,230,0.95)",t.fillText(X,ve,H),H+=Math.round(Ne*1.15)+12),g=Z+Qe+28;const We=230,Be=Math.max(120,1920-T-We-g),ze="âš¡ My Result is Live!",Ce=S(ze,R-120,"900",48,26),_t="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",ie=26,He=Math.round(ie*1.25);u("700",ie);const Oe=y(_t,R-120,"700",ie).slice(0,2),Nt=Oe.length*He;let le=28+Math.round(Ce)+12+Nt+28;le>Be&&(le=Be);const oe=g;o($,oe,R,le,28),t.fillStyle="rgba(8,11,30,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(56,189,248,0.5)",t.stroke(),u("900",Ce),t.fillStyle="#facc15";const St=p(ze);t.fillText(ze,x-St/2,oe+28),u("700",ie),t.fillStyle="rgba(226,232,240,0.92)";let Ve=oe+28+Math.round(Ce)+12;for(const i of Oe){const m=p(i);t.fillText(i,x-m/2,Ve),Ve+=He}g=oe+le+24;const I=g,J=Math.max(We,Math.min(280,1920-T-I));o($,I,R,J,24),t.fillStyle="rgba(12,10,36,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(79,70,229,0.45)",t.stroke();const zt=f!=null&&f.referral_code?f.referral_code:c!=null&&c.id?c.id.replace(/-/g,"").slice(0,8).toUpperCase():"",K=qt(zt),Ct=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(K)}`;if(K)try{const i=Et();(!i||i!==K)&&It(K)}catch(i){}const ee=Math.min(220,J-72),Ye=ee+32,Fe=ee+40,Te=$+R-Ye-36,Ge=I+Math.max(24,Math.round((J-Fe)/2));o(Te,Ge,Ye,Fe,18),t.fillStyle="#ffffff",t.fill();try{const{default:i}=await At(()=>import("./browser-864b0b18.js").then(h=>h.b),[]),m=document.createElement("canvas");await i.toCanvas(m,Ct,{width:ee,margin:1,color:{dark:"#000000",light:"#ffffff"}}),t.drawImage(m,Te+16,Ge+16,ee,ee)}catch(i){}const P=$+36,O=Te-24-P;t.fillStyle="rgba(255,255,255,0.96)",u("900",48),t.fillText(k("ðŸ§  Play & Win",O),P,I+36),t.fillStyle="rgba(203,213,225,0.98)",u("800",36),t.fillText(k("ðŸŒ www.quizdangal.com",O),P,I+36+54),u("900",44),t.fillStyle="rgba(255,255,255,0.96)";const Xe="ðŸ”— Referral: ",Ze=p(Xe);return t.fillText(k(Xe,O),P,I+36+54+62),t.fillStyle="rgba(0,255,198,1)",t.fillText(k(K,Math.max(0,O-Ze-8)),P+Ze,I+36+54+62),u("700",26),t.fillStyle="rgba(226,232,240,0.92)",t.fillText(k("Your turn to flex your brain ðŸ’¯",O),P,I+J-80),u("700",24),t.fillStyle="rgba(203,213,225,0.92)",t.fillText(k("#QuizDangal  #ChallengeAccepted  #PlayToWin",O),P,I+J-44),await new Promise(i=>a.toBlob(i,"image/jpeg",.92))}catch(s){try{const n=document.createElement("canvas");n.width=8,n.height=8;const a=n.getContext("2d"),t=a.createLinearGradient(0,0,8,8);return t.addColorStop(0,"#130531"),t.addColorStop(1,"#1e0b4b"),a.fillStyle=t,a.fillRect(0,0,8,8),await new Promise(u=>n.toBlob(u,"image/jpeg",.9))}catch(n){return null}}},[c==null?void 0:c.id,f==null?void 0:f.full_name,f==null?void 0:f.username,f==null?void 0:f.referral_code,l==null?void 0:l.rank,l==null?void 0:l.score,G,re]);C.useEffect(()=>{if(!(r!=null&&r.end_time)||M.length>0){ne(null);return}const s=new Date(r.end_time).getTime(),n=()=>{const t=s-Date.now();t>0?ne(t):(ne(0),qe||(ot(!0),B()))};n();const a=setInterval(n,1e3);return()=>clearInterval(a)},[r==null?void 0:r.end_time,M.length,qe,B]);const ht=(()=>{var s,n;try{const a=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},t=(n=(s={}.VITE_ENABLE_REALTIME)!=null?s:a.VITE_ENABLE_REALTIME)!=null?n:"1",w=String(t).toLowerCase();return w==="1"||w==="true"||w==="yes"}catch(a){return!1}})(),pt=(()=>{try{if(!ht||!tt||!A||!j||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();$t({enabled:M.length===0&&pt,channelName:`quiz-results-${j}`,table:"quiz_results",filter:`quiz_id=eq.${j}`,onChange:B,joinTimeoutMs:5e3});const xt=async()=>{try{let s=Ee;if(s||(s=await we()),s&&navigator.canShare&&window.File){const n=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[n]})){await navigator.share({files:[n],title:"Quiz Dangal Result"}),F({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download="quiz-dangal-result.jpg",a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(n),1500),F({title:"Poster saved",description:"Share the image from your gallery."});return}F({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){F({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},gt=async()=>{try{let s=Ee;if(s||(s=await we()),s&&navigator.canShare&&window.File){const y=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[y]})){await navigator.share({files:[y],title:"Quiz Dangal Result"});return}}if(s)try{const y=URL.createObjectURL(s),z=document.createElement("a");z.href=y,z.download="quiz-dangal-result.jpg",z.rel="noopener",document.body.appendChild(z),z.click(),document.body.removeChild(z),setTimeout(()=>URL.revokeObjectURL(y),1500)}catch(y){}const n=navigator.userAgent||"",a=/Android/i.test(n),t=/iPhone|iPad|iPod/i.test(n),w="whatsapp://send",u="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",p="https://wa.me/",S=y=>!!window.open(y,"_blank");if(a){if(S(w))return;window.location.href=u,setTimeout(()=>{document.hidden||(window.location.href=p)},700);return}if(t){window.location.href=w,setTimeout(()=>{document.hidden||(window.location.href=p)},700);return}S(p)}catch(s){F({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};if(ue)return e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${j}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]});if(!ue&&pe)return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Error | Quiz Dangal",description:pe||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${j}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),e.jsx("p",{className:"text-slate-300 mb-4",children:pe}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(Ae,{variant:"brand",onClick:ft,children:"Retry"}),e.jsx(Ae,{variant:"white",onClick:()=>fe("/my-quizzes/"),children:"Back"})]})]})]});if(!ue&&(ae!=null?ae:0)>0&&M.length===0){const s=p=>{const S=Math.max(0,Math.floor(p/1e3)),y=Math.floor(S/86400),z=Math.floor(S%86400/3600),k=Math.floor(S%3600/60),d=S%60;return{days:y,hours:z,minutes:k,seconds:d}},{days:n,hours:a,minutes:t,seconds:w}=s(ae),u=(p,S)=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:p.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:S})]});return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Results will be published soon."}),e.jsx("p",{className:"text-slate-300 mb-4",children:"Quiz ends in"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[n>0&&u(n,"Days"),u(a,"Hours"),u(t,"Minutes"),u(w,"Seconds")]}),(r==null?void 0:r.end_time)&&e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Expected publish time: ",new Date(r.end_time).toLocaleString()]}),e.jsx(Ae,{variant:"brand",className:"w-full",onClick:()=>fe("/"),children:"Back to Home"})]})]})}return e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(me,{title:`${r!=null&&r.title?`${r.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:M.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${j}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(st,{className:"w-5 h-5 text-amber-400"}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:r==null?void 0:r.title}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[e.jsx(Wt,{className:"w-3 h-3"}),e.jsxs("span",{children:[ct||(M==null?void 0:M.length)||0," participants"]})]})]}),(l==null?void 0:l.rank)&&e.jsxs("div",{className:"shrink-0 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:e.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",l.rank]})}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(r==null?void 0:r.prizes)&&r.prizes.length>0&&e.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:r.prizes.slice(0,5).map((s,n)=>{const a=de(G,s,{fallback:0}),t=n===0?"ðŸ¥‡":n===1?"ðŸ¥ˆ":n===2?"ðŸ¥‰":`#${n+1}`;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("span",{children:a.formatted})]},n)})})]})}),c&&(l||lt)&&e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold text-white",children:l?"Your Result":"You Participated"}),l&&e.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",M.length]})]}),((D==null?void 0:D.length)||0)>0&&e.jsxs("button",{type:"button",onClick:()=>Ie(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${be?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":be,children:[e.jsx(Bt,{className:"w-3 h-3"}),"Q&A"]})]}),l?e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),e.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",l.rank]})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),e.jsx("p",{className:"text-base font-bold text-emerald-400",children:l.score})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),e.jsx("p",{className:"text-base font-bold text-purple-400",children:ut.formatted})]})]}):e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),be&&((D==null?void 0:D.length)||0)>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[e.jsx(Ht,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),e.jsx("button",{type:"button",onClick:()=>Ie(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),e.jsx("div",{className:"space-y-2",children:D.map((s,n)=>e.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[e.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[e.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",n+1,"."]}),s.question_text]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(a=>{const t=!!a.is_correct,w=!!a.isSelected,u=t?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":w?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return e.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${u}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsx("span",{children:"âœ“"}),w&&!t&&e.jsx("span",{children:"âœ—"}),e.jsx("span",{className:"truncate",children:a.option_text})]})},a.id)})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[e.jsx(st,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),e.jsxs("div",{className:"space-y-1.5",children:[M.length===0&&e.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),M.map((s,n)=>{var S,y,z,k,d;const a=s.rank&&Array.isArray(r==null?void 0:r.prizes)&&r.prizes[s.rank-1]?r.prizes[s.rank-1]:0,t=de(G,a,{fallback:0}),w=s.user_id===(c==null?void 0:c.id),u=n<3,p=n===0?"ðŸ¥‡":n===1?"ðŸ¥ˆ":n===2?"ðŸ¥‰":null;return e.jsxs(Ut.div,{variants:mt,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-2 p-2 rounded-lg border ${w?"bg-indigo-950/40 border-indigo-600/40":u?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${u?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:p||`#${s.rank||n+1}`}),e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(S=s.profiles)!=null&&S.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{children:(((y=s.profiles)==null?void 0:y.full_name)||((z=s.profiles)==null?void 0:z.username)||"U").charAt(0).toUpperCase()})}),e.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((k=s.profiles)==null?void 0:k.username)||((d=s.profiles)==null?void 0:d.full_name)||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),e.jsx("div",{className:"text-right min-w-[50px]",children:e.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:t.formatted})})]})]},`${s.id}-${n}`)})]})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:e.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>fe("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Back"]}),e.jsxs("button",{onClick:gt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),e.jsxs("button",{onClick:xt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{rs as default};
