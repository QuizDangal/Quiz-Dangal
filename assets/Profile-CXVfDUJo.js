import{u as K,e as X,s as m,j as e,S as ee}from"./index-Ds81wWIh.js";import{r as n,L as w}from"./router-D53U3OCX.js";import te from"./ProfileUpdateModal-DCgMxVIJ.js";import{L as ae,b as A,p as se,Z as le,a as re,g as ne,I as ie,q as oe,r as de,s as ce,t as ge,n as xe}from"./icons-XxcMCUz0.js";import"./supabase-BMIB7Fuo.js";import"./react-DQQtrPfG.js";import"./label-YpGiWerw.js";function je(){var _;const{signOut:D}=K(),{toast:L}=X(),[z,S]=n.useState(!0),[d,I]=n.useState(null),[l,j]=n.useState(null),[k,p]=n.useState(""),[N,C]=n.useState(!1),[T,U]=n.useState(!1),[f,H]=n.useState(!1),[x,O]=n.useState(0),[y,F]=n.useState({nextLevel:1,nextReq:50,have:0,remaining:50,currReq:0}),g=n.useMemo(()=>[0,50,200,450,800,1250,1800,2450,3200,4050,5e3,6050,7200,8450,9800,11250,12800,14450,16200,18050,2e4,22050,24200,26450,28800,31250,33800,36450,39200,42050,45e3,48050,51200,54450,57800,61250,64800,68450,72200,76050,8e4,84050,88200,92450,96800,101250,105800,110450,115200,120050,125e3,130050,135200,140450,145800,151250,156800,162450,168200,174050,18e4,186050,192200,198450,204800,211250,217800,224450,231200,238050,245e3,252050,259200,266450,273800,281250,288800,296450,304200,312050,32e4,328050,336200,344450,352800,361250,369800,378450,387200,396050,405e3,414050,423200,432450,441800,451250,460800,470450,480200,490050,5e5],[]),E=n.useCallback(t=>{const s=Number(t||0);let a=0;for(let r=1;r<g.length&&s>=g[r];r++)a=r;return a},[g]),R=n.useCallback((t,s)=>{const a=Number(t||0),r=Math.max(0,Number(s||0)),i=100,o=Math.min(i,r+1),c=g[r]||0,h=g[o]||g[i],J=Math.max(0,(h||0)-a);return{nextLevel:o,nextReq:h,have:a,remaining:J,currReq:c}},[g]),b=n.useRef(null),$=n.useCallback(async t=>{if(!t)return"";if(t.includes("://"))return t;const{data:s,error:a}=await m.storage.from("avatars").createSignedUrl(t,3600);return a?"":(s==null?void 0:s.signedUrl)||""},[]),q=n.useCallback(async t=>{const{data:s,error:a}=await m.from("profiles").select("*").eq("id",t.id).single();if(a)throw a;return s},[]),M=n.useCallback(t=>{const s=Number((t==null?void 0:t.total_coins)||0),a=E(s);O(a),F(R(s,a))},[E,R]),v=n.useCallback(async()=>{S(!0);try{const{data:{session:t}}=await m.auth.getSession(),s=(t==null?void 0:t.user)||null;if(I(s),!s){j(null),p("");return}const a=await q(s);j(a),M(a);const r=await $(a==null?void 0:a.avatar_url);p(r)}catch(t){j(null),p("")}finally{S(!1)}},[q,M,$]);n.useEffect(()=>{v()},[v]);const G=async()=>{await D()},Q=()=>{var t;return(t=b.current)==null?void 0:t.click()},Y=async t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(!(!s||!d)){C(!0);try{const r=`${d.id}/${Date.now()}-${s.name}`,{error:i}=await m.storage.from("avatars").upload(r,s,{upsert:!0});if(i)throw i;const{error:o}=await m.from("profiles").update({avatar_url:r}).eq("id",d.id);if(o)throw o;const{data:c,error:h}=await m.storage.from("avatars").createSignedUrl(r,3600);h||p((c==null?void 0:c.signedUrl)||""),await v(),L({title:"Avatar updated",description:"Your profile picture has been changed.",variant:"default"})}catch(r){L({title:"Avatar change failed",description:(r==null?void 0:r.message)||"Try again later",variant:"destructive"})}finally{C(!1),b.current&&(b.current.value="")}}},V=(t,s)=>{const a=Number(t||0);if(Math.max(0,Number(s||0))>=100)return 100;const{nextReq:i,currReq:o}=y;if(!i||i<=o)return 0;const c=i-o,h=Math.max(0,Math.min(c,a-o));return Math.round(h/c*100)};if(z)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ae,{className:"w-8 h-8 animate-spin text-indigo-300"})});if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-800/40 text-indigo-300 flex items-center justify-center mb-3 border border-indigo-700/60",children:e.jsx(A,{className:"w-6 h-6"})}),e.jsxs("p",{className:"text-lg text-slate-200",children:["You are not logged in or session expired.",e.jsx("br",{}),"Please"," ",e.jsx(w,{to:"/login",className:"text-indigo-300 underline",children:"login"})," ","to view your profile."]})]});const W=l!=null&&l.username?`@${l.username}`:"Username not set",Z=(l==null?void 0:l.email)||d.email,P=Number((_=l==null?void 0:l.total_coins)!=null?_:0),B=V(P,x),u=(t=>t>=80?"from-violet-500 via-fuchsia-500 to-pink-500":t>=50?"from-amber-400 via-orange-500 to-red-500":t>=20?"from-cyan-400 via-blue-500 to-indigo-500":"from-emerald-400 via-teal-500 to-cyan-500")(x);return e.jsxs("div",{className:"relative overflow-x-hidden",children:[e.jsx(ee,{title:"Your Quiz Dangal Profile",description:"View and manage your Quiz Dangal profile details, quiz preferences, and account settings.",canonical:"https://quizdangal.com/profile/",robots:"noindex, nofollow",author:"Quiz Dangal",datePublished:"2025-01-01"}),e.jsxs("div",{className:"mx-auto w-full max-w-lg lg:max-w-xl px-4 pt-14 lg:pt-20 pb-12 space-y-3 lg:space-y-4",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl lg:rounded-2xl bg-gradient-to-br from-slate-900/95 via-slate-800/90 to-slate-900/95 border border-white/10 shadow-2xl",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden lg:hidden","aria-hidden":!0,children:[e.jsx("div",{className:`absolute -top-20 -left-20 w-40 h-40 rounded-full bg-gradient-to-br ${u} opacity-25 blur-3xl`}),e.jsx("div",{className:"absolute -bottom-20 -right-20 w-48 h-48 rounded-full bg-gradient-to-br from-pink-500 via-purple-500 to-indigo-500 opacity-20 blur-3xl"})]}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-[2px] lg:h-[1px] bg-gradient-to-r ${u}`}),e.jsxs("div",{className:"relative p-4 lg:p-3",children:[e.jsxs("div",{className:"flex items-start gap-3 lg:gap-2",children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:`absolute -inset-1 rounded-full bg-gradient-to-tr ${u} blur-sm opacity-60 lg:opacity-40`}),e.jsx("div",{className:"relative w-20 h-20 lg:w-16 lg:h-16 rounded-full overflow-hidden ring-[3px] lg:ring-2 ring-white/20 ring-offset-2 lg:ring-offset-1 ring-offset-slate-900 shadow-2xl lg:shadow-lg",children:k?e.jsx("img",{src:k,alt:"User profile avatar",title:l!=null&&l.full_name||l!=null&&l.username?`${l.full_name||l.username}'s avatar`:"User avatar",className:"w-full h-full object-cover",width:80,height:80,loading:"lazy",decoding:"async"}):e.jsx("div",{className:`w-full h-full bg-gradient-to-br ${u} flex items-center justify-center`,children:e.jsx("span",{className:"text-2xl lg:text-xl font-bold text-white",children:((l==null?void 0:l.full_name)||(d==null?void 0:d.email)||"U").charAt(0).toUpperCase()})})}),e.jsx("button",{type:"button",onClick:Q,disabled:N,className:"absolute -bottom-0.5 -right-0.5 p-1.5 lg:p-1 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 border-2 border-slate-900 shadow-lg text-white hover:scale-110 transition disabled:opacity-60",title:N?"Uploading...":"Change avatar","aria-label":N?"Uploading avatar":"Change avatar",children:e.jsx(se,{className:"w-3.5 h-3.5 lg:w-3 lg:h-3","aria-hidden":"true"})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",className:"hidden",onChange:Y,id:"avatar-upload","aria-label":"Upload avatar image"}),e.jsx("div",{className:`absolute -top-1 -left-1 px-2 lg:px-1.5 py-0.5 rounded-full bg-gradient-to-r ${u} shadow-lg`,children:e.jsx("span",{className:"text-[10px] lg:text-[9px] font-bold text-white",children:x})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 lg:gap-1.5",children:[e.jsx("h2",{className:"text-lg lg:text-base font-bold text-white truncate",children:W}),x>=50&&e.jsx(A,{className:"w-4 h-4 lg:w-3.5 lg:h-3.5 text-amber-400 shrink-0"})]}),e.jsx("p",{className:"text-xs lg:text-[11px] text-slate-400 truncate mt-0.5",children:Z})]})]}),e.jsxs("button",{type:"button",onClick:()=>U(!0),className:"mt-3 lg:mt-2 inline-flex items-center gap-1.5 px-4 lg:px-3 py-1.5 lg:py-1 rounded-full text-[11px] lg:text-[10px] font-semibold bg-white/10 border border-white/20 text-white hover:bg-white/20 hover:scale-105 transition","aria-label":"Edit your profile",children:[e.jsx("svg",{className:"w-3 h-3 lg:w-2.5 lg:h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Edit Profile"]}),e.jsxs("button",{type:"button",onClick:()=>H(!f),className:"mt-3 lg:mt-2 w-full p-2.5 lg:p-2 rounded-xl lg:rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition text-left","aria-label":f?"Hide level info":"Show level info","aria-expanded":f,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 lg:mb-1",children:[e.jsx(le,{className:"w-3.5 h-3.5 lg:w-3 lg:h-3 text-yellow-400","aria-hidden":"true"}),e.jsxs("span",{className:"text-xs lg:text-[11px] font-semibold text-white",children:["Level ",x]})]}),e.jsx("div",{className:"relative h-2 lg:h-1.5 bg-slate-800/80 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${u} shadow-[0_0_12px_rgba(139,92,246,0.5)] transition-all duration-700`,style:{width:`${B}%`}})}),f&&e.jsxs("div",{className:"mt-2 p-2.5 lg:p-2 rounded-lg bg-slate-800/90 border border-white/10 text-[11px] lg:text-[10px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Current Coins"}),e.jsx("span",{className:"text-amber-400 font-bold",children:P.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-slate-400",children:["Next Level (",x+1,")"]}),e.jsx("span",{className:"text-emerald-400 font-bold",children:y.nextReq.toLocaleString()})]}),e.jsxs("div",{className:"mt-1 pt-1 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Need More"}),e.jsx("span",{className:"text-rose-400 font-bold",children:y.remaining.toLocaleString()})]})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-2 gap-3 lg:gap-2",children:[e.jsxs(w,{to:"/wallet",className:"relative flex items-center gap-3 lg:gap-2 p-3 lg:p-2.5 rounded-xl lg:rounded-lg overflow-hidden group",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(20, 184, 166, 0.15) 100%)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:[e.jsx("div",{className:"w-9 h-9 lg:w-8 lg:h-8 rounded-lg bg-gradient-to-br from-emerald-400 to-teal-500 grid place-items-center shadow-md flex-shrink-0",children:e.jsx(re,{className:"w-4.5 h-4.5 lg:w-4 lg:h-4 text-white","aria-hidden":"true"})}),e.jsx("p",{className:"flex-1 text-sm lg:text-xs font-bold text-white",children:"Wallet"})]}),e.jsxs(w,{to:"/refer",className:"relative flex items-center gap-3 lg:gap-2 p-3 lg:p-2.5 rounded-xl lg:rounded-lg overflow-hidden group",style:{background:"linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(168, 85, 247, 0.15) 100%)",border:"1px solid rgba(168, 85, 247, 0.3)"},children:[e.jsx("div",{className:"w-9 h-9 lg:w-8 lg:h-8 rounded-lg bg-gradient-to-br from-pink-400 to-violet-500 grid place-items-center shadow-md flex-shrink-0",children:e.jsx(ne,{className:"w-4.5 h-4.5 lg:w-4 lg:h-4 text-white","aria-hidden":"true"})}),e.jsx("p",{className:"flex-1 text-sm lg:text-xs font-bold text-white",children:"Refer & Earn"})]})]}),e.jsxs("section",{className:"rounded-2xl lg:rounded-xl bg-gradient-to-br from-slate-900/90 via-slate-800/80 to-slate-900/90 border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"px-4 lg:px-3 py-3 lg:py-2 border-b border-white/5",children:e.jsx("p",{className:"text-sm lg:text-xs font-semibold text-slate-200",children:"Settings & Info"})}),[{label:"About Us",href:"/about-us",icon:ie,color:"from-blue-500 to-cyan-500"},{label:"Contact Us",href:"/contact-us",icon:oe,color:"from-pink-500 to-rose-500"},{label:"Terms & Conditions",href:"/terms-conditions",icon:de,color:"from-violet-500 to-purple-500"},{label:"Privacy Policy",href:"/privacy-policy",icon:ce,color:"from-amber-500 to-orange-500"}].map(t=>e.jsxs(w,{to:t.href,className:"group flex items-center justify-between px-4 lg:px-3 py-3 lg:py-2 hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-2",children:[e.jsx("span",{className:`w-8 h-8 lg:w-7 lg:h-7 rounded-xl lg:rounded-lg bg-gradient-to-br ${t.color} grid place-items-center shadow group-hover:scale-105 transition`,children:e.jsx(t.icon,{className:"w-4 h-4 lg:w-3.5 lg:h-3.5 text-white"})}),e.jsx("span",{className:"text-sm lg:text-xs font-medium text-white",children:t.label})]}),e.jsx(ge,{className:"w-4 h-4 lg:w-3.5 lg:h-3.5 text-slate-500 group-hover:text-white group-hover:translate-x-0.5 transition"})]},t.href)),e.jsx("div",{className:"px-4 lg:px-3 py-3 lg:py-2 border-t border-white/5",children:e.jsxs("button",{type:"button",onClick:G,className:"inline-flex items-center gap-2 lg:gap-1.5 px-3 lg:px-2.5 py-1.5 lg:py-1 rounded-lg bg-rose-500/10 hover:bg-rose-500/20 transition text-xs lg:text-[11px] text-rose-300 font-semibold","aria-label":"Log out of your account",children:[e.jsx(xe,{className:"w-3.5 h-3.5 lg:w-3 lg:h-3","aria-hidden":"true"}),"Logout"]})})]}),e.jsx(te,{isOpen:T,onClose:()=>{U(!1),v()},isFirstTime:!1})]})]})}export{je as default};
