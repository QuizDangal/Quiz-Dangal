import{j as e,B as k,m,A as W,f as U,e as S,g as X}from"./index-e5d81da9.js";import{r as $}from"./react-63c462fe.js";import{u as G}from"./useQuizEngine-2bcbe2d3.js";import{S as u}from"./SEO-16cc2069.js";import{c as K,b as V}from"./router-d6d570a4.js";import{L as C,X as D,b as L,c as P,s as A}from"./icons-1e9e0bae.js";import"./supabase-07ebd5d8.js";import"./smartJoinQuiz-6e2330c2.js";const re=()=>{var _;const{id:o}=K(),d=V(),{quiz:t,questions:c,currentQuestionIndex:p,answers:z,quizState:n,timeLeft:j,submitting:g,joined:M,participantStatus:T,totalJoined:E,displayJoined:J,handleJoinOrPrejoin:R,handleAnswerSelect:I,handleSubmit:O,formatTime:w}=G(o,d),[N,v]=$.useState(null);$.useEffect(()=>{if(!(t!=null&&t.end_time)){v(null);return}if(!(n==="completed"||n==="finished")){v(null);return}const s=new Date(t.end_time).getTime(),i=()=>{const l=Math.max(0,s-Date.now());v(l)};i();const a=setInterval(i,1e3);return()=>clearInterval(a)},[t==null?void 0:t.end_time,n]);const B=()=>{if(!(t!=null&&t.end_time))return e.jsx("p",{className:"text-slate-300",children:"Results will be published soon."});const s=N!=null?N:Math.max(0,new Date(t.end_time).getTime()-Date.now()),i=Math.max(0,Math.floor(s/1e3)),a=Math.floor(i/86400),l=Math.floor(i%86400/3600),y=Math.floor(i%3600/60),h=i%60,r=({value:b,label:f})=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:b.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:f})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-slate-300",children:"Results will be published soon."}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a>0&&e.jsx(r,{value:a,label:"Days"}),e.jsx(r,{value:l,label:"Hours"}),e.jsx(r,{value:y,label:"Minutes"}),e.jsx(r,{value:h,label:"Seconds"})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Expected publish time: ",new Date(t.end_time).toLocaleString()]})]})};if(n==="loading"||!t)return e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(u,{title:"Quiz â€“ Loading | Quiz Dangal",description:"Loading quiz details.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${o}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-16 w-16 animate-spin text-accent-b mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz..."})]})]});const q=()=>e.jsxs("div",{className:"mt-2 text-[10px] text-slate-400",children:[e.jsx("div",{className:"mb-1",children:t.start_time?U(t.start_time):"â€”"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"Start"}),e.jsx("div",{className:"text-slate-300",children:t.start_time?S(t.start_time):"â€”"})]}),e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"End"}),e.jsx("div",{className:"text-slate-300",children:t.end_time?S(t.end_time):"â€”"})]})]})]}),Q=()=>{var r,b,f;const s=Array.isArray(t.prizes)?t.prizes:[],i=t.prize_type||"coins",a=(r=s[0])!=null?r:0,l=(b=s[1])!=null?b:0,y=(f=s[2])!=null?f:0,h=H=>X(i,H,{fallback:0}).formatted;return e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-1.5 text-[10px]",children:[e.jsxs("span",{className:"px-2 py-1 rounded-md bg-amber-500/15 text-amber-300 border border-amber-600/30",children:["ðŸ¥‡ ",h(a)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-sky-500/15 text-sky-300 border border-sky-600/30",children:["ðŸ¥ˆ ",h(l)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-violet-500/15 text-violet-300 border border-violet-600/30",children:["ðŸ¥‰ ",h(y)]})]})};if(!M&&n!=="completed"){const s=new Date,i=t.start_time?new Date(t.start_time):null,a=t.end_time?new Date(t.end_time):null,l=t.status==="active"&&i&&a&&s>=i&&s<a;return e.jsxs("div",{className:"min-h-screen flex items-center justify-center px-3 pt-16",children:[e.jsx(u,{title:`${t.title||"Quiz"} â€“ Lobby | Quiz Dangal`,description:"Join the quiz lobby.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${o}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:()=>window.history.length>1?d(-1):d("/"),className:"absolute top-3 right-3 text-slate-500 hover:text-white transition",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:t.title}),e.jsx("p",{className:"text-[11px] text-slate-400 mb-2",children:l?"Quiz is live!":"Quiz starts in"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:w(j)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[11px] text-slate-400 mb-2",children:[e.jsx(P,{className:"h-3 w-3"}),J," joined"]}),e.jsx(Q,{}),e.jsx(q,{}),e.jsx("div",{className:"mt-4",children:e.jsx(k,{onClick:R,className:`w-full h-10 text-sm font-bold ${l?"bg-gradient-to-r from-emerald-600 to-green-500":"bg-gradient-to-r from-indigo-600 to-violet-600"} hover:opacity-90`,children:l?"Join & Start":"Pre-Join"})})]})})})]})}if(n==="waiting")return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(u,{title:`${t.title||"Quiz"} â€“ Waiting | Quiz Dangal`,description:"Waiting for the quiz to start.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${o}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsx(m.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:()=>window.history.length>1?d(-1):d("/"),className:"absolute top-2 right-2 text-slate-400 hover:text-slate-200 transition",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(L,{className:"h-6 w-6 text-indigo-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Quiz starts in:"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:w(j)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-400 mb-2",children:[e.jsx(P,{className:"h-3 w-3"}),E," joined"]}),e.jsx(Q,{}),e.jsx(q,{}),e.jsx("p",{className:"mt-2 text-[10px] text-slate-500",children:"Auto-starts when timer hits zero"})]})})})]});if(n==="completed"||n==="finished")return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(u,{title:`${t.title||"Quiz"} â€“ Completed | Quiz Dangal`,description:"Quiz completed. Results will be published soon.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${o}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsx(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-green-500/40 to-teal-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(A,{className:"h-6 w-6 text-emerald-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:"Quiz Submitted!"}),e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Thank you for participating!"}),B(),e.jsx("button",{onClick:()=>d("/"),className:"mt-3 w-full h-9 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-emerald-600 to-green-500 hover:opacity-90 transition",children:"Back to Home"})]})})})]});if(c.length===0)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600",children:"No questions available for this quiz."})})});const x=c[p],F=(p+1)/c.length*100;return e.jsxs("div",{className:"min-h-screen px-3 pt-16 pb-6",children:[e.jsx(u,{title:`${t.title||"Quiz"} â€“ Play | Quiz Dangal`,description:"Answer questions and compete to win.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${o}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-sm font-bold text-white truncate",children:t.title}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Q",p+1," of ",c.length]})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("div",{className:"text-lg font-bold text-rose-400 tabular-nums",children:w(j)}),e.jsx("div",{className:"text-[9px] text-slate-500 uppercase",children:"Time Left"})]})]}),e.jsx("div",{className:"mt-2 w-full bg-slate-800 rounded-full h-1.5 overflow-hidden",children:e.jsx(m.div,{className:"h-1.5 rounded-full bg-gradient-to-r from-cyan-400 via-indigo-500 to-fuchsia-500",style:{width:`${F}%`},transition:{duration:.4}})})]})}),e.jsx(W,{mode:"wait",children:e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"rounded-xl border border-slate-700/60 bg-slate-900/90 p-4",children:[e.jsx("h2",{className:"text-sm font-bold text-center text-white mb-4 leading-relaxed",children:x.question_text}),e.jsx("div",{className:"space-y-2",children:(_=x.options)==null?void 0:_.map((s,i)=>{const a=z[x.id]===s.id;return e.jsxs(m.button,{onClick:()=>I(x.id,s.id),disabled:g||n!=="active"||T==="completed",whileTap:{scale:.98},className:`w-full p-3 rounded-lg text-left text-sm font-medium transition-all border ${a?"bg-emerald-600/90 text-white border-emerald-500 shadow-lg":"bg-slate-800/60 hover:bg-slate-800 text-slate-200 border-slate-700/60"}`,children:[e.jsxs("span",{className:`font-bold mr-2 ${a?"text-white":"text-indigo-400"}`,children:[String.fromCharCode(65+i),"."]}),s.option_text]},s.id)})}),p===c.length-1&&Object.keys(z).length===c.length&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4",children:e.jsx(k,{onClick:O,disabled:g,className:"w-full h-11 text-sm font-bold bg-gradient-to-r from-indigo-600 via-violet-600 to-fuchsia-600 hover:opacity-90",children:g?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Submit Quiz"]})})})]},x.id)})]})]})};export{re as default};
