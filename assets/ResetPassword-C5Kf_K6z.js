import{s as d,j as e,S as k}from"./index-BUms4FRM.js";import{u as q,r as n}from"./router-CWIfZQRv.js";import"./supabase-cQshKuiM.js";import"./react-MKCYUrdX.js";import"./icons-BNA5wz6Z.js";function I(){const w=q(),[b,i]=n.useState(!1),[l,y]=n.useState(""),[m,v]=n.useState(""),[p,g]=n.useState(!1),[f,o]=n.useState("");n.useEffect(()=>{const r=new URL(window.location.href),t=r.hash||"",u=r.search||"",x=()=>{const a=new URLSearchParams(u).get("code");if(a)return a;const c=t.indexOf("?");return c!==-1?new URLSearchParams(t.substring(c+1)).get("code"):null},S=new URLSearchParams(u),j=t.includes("type=recovery"),N=S.get("type")==="recovery",P=t.includes("access_token=")||!!x();(j||N||P)&&i(!0),(async()=>{const s=x();if(s)try{const{error:a}=await d.auth.exchangeCodeForSession({code:s});if(a)throw a;try{const c=window.location.origin+window.location.pathname+(window.location.hash.split("?")[0]||"");window.history.replaceState({},document.title,c)}catch(c){}i(!0)}catch(a){o((a==null?void 0:a.message)||"Could not validate reset link. Try requesting a new one.")}})(),(async()=>{try{const{data:s}=await d.auth.getSession();s!=null&&s.session&&window.location.pathname.includes("/reset-password")&&i(!0)}catch(s){}})();const{data:{subscription:h}}=d.auth.onAuthStateChange(s=>{s==="PASSWORD_RECOVERY"&&i(!0),s==="SIGNED_IN"&&i(!0)});return()=>h==null?void 0:h.unsubscribe()},[]);const R=async r=>{if(r.preventDefault(),l.length<6)return o("Password must be at least 6 characters.");if(l!==m)return o("Passwords do not match.");g(!0),o("");try{const{error:t}=await d.auth.updateUser({password:l});if(t)throw t;o("Password updated! Redirecting to sign in…");try{await d.auth.signOut()}catch(u){}w("/login?reset=1",{replace:!0})}catch(t){o((t==null?void 0:t.message)||"Failed to update password.")}finally{g(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",children:[e.jsx(k,{title:"Reset Password – Quiz Dangal",description:"Reset your Quiz Dangal password securely. Enter your new password to regain access to your account.",canonical:"https://quizdangal.com/reset-password/",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/50 via-violet-900/40 to-fuchsia-900/40 backdrop-blur-xl border border-indigo-700/60 rounded-2xl p-8 max-w-md w-full shadow-xl text-slate-100",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-violet-400 via-indigo-300 to-fuchsia-400 bg-clip-text text-transparent mb-2 text-center",children:"Reset Password"}),b?e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-password",className:"block text-sm text-slate-200 mb-1",children:"New Password"}),e.jsx("input",{id:"new-password",type:"password",className:"w-full border border-slate-300 bg-white text-black rounded-lg px-3 py-2",value:l,onChange:r=>y(r.target.value),placeholder:"Enter new password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"block text-sm text-slate-200 mb-1",children:"Confirm New Password"}),e.jsx("input",{id:"confirm-password",type:"password",className:"w-full border border-slate-300 bg-white text-black rounded-lg px-3 py-2",value:m,onChange:r=>v(r.target.value),placeholder:"Re-enter new password",required:!0})]}),f&&e.jsx("div",{className:"text-sm text-center text-slate-300",children:f}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-gradient-to-r from-indigo-600 via-violet-600 to-fuchsia-600 hover:from-indigo-500 hover:to-fuchsia-700 text-white rounded-lg py-2.5 font-semibold",children:p?"Updating…":"Update Password"}),e.jsx("button",{type:"button",onClick:()=>w("/login"),className:"w-full bg-white text-black border border-slate-300 hover:bg-slate-50 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500/40 py-2.5 font-medium",children:"Back to Login"})]}):e.jsx("div",{className:"text-center text-slate-300",children:"The reset link is invalid or has expired, or you are already signed in. If you see this by mistake, open the link again or request a new reset from the Sign In screen."})]})]})}export{I as default};
