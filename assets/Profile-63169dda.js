import{u as Z,d as g,j as e,S as B}from"./index-4dae992b.js";import{r as l}from"./react-63c462fe.js";import{L as v}from"./router-5fd03704.js";import G from"./ProfileUpdateModal-b475fc7b.js";import{o as J,a as $,p as K,Z as X,C as ee,h as te,I as se,q as ae,r as re,s as le,t as ne,L as oe}from"./icons-a32f58a9.js";import"./supabase-24c2e735.js";import"./label-41a60bd0.js";function fe(){var _;const{signOut:q}=Z(),[M,y]=l.useState(!0),[m,P]=l.useState(null),[t,w]=l.useState(null),[L,u]=l.useState(""),[j,S]=l.useState(!1),[A,C]=l.useState(!1),[k,I]=l.useState(!1),[x,z]=l.useState(0),[N,D]=l.useState({nextLevel:1,nextReq:50,have:0,remaining:50,currReq:0}),h=l.useMemo(()=>[0,50,200,450,800,1250,1800,2450,3200,4050,5e3,6050,7200,8450,9800,11250,12800,14450,16200,18050,2e4,22050,24200,26450,28800,31250,33800,36450,39200,42050,45e3,48050,51200,54450,57800,61250,64800,68450,72200,76050,8e4,84050,88200,92450,96800,101250,105800,110450,115200,120050,125e3,130050,135200,140450,145800,151250,156800,162450,168200,174050,18e4,186050,192200,198450,204800,211250,217800,224450,231200,238050,245e3,252050,259200,266450,273800,281250,288800,296450,304200,312050,32e4,328050,336200,344450,352800,361250,369800,378450,387200,396050,405e3,414050,423200,432450,441800,451250,460800,470450,480200,490050,5e5],[]),U=l.useCallback(s=>{const n=Number(s||0);let a=0;for(let r=1;r<h.length&&n>=h[r];r++)a=r;return a},[h]),E=l.useCallback((s,n)=>{const a=Number(s||0),r=Math.max(0,Number(n||0)),o=100,i=Math.min(o,r+1),c=h[r]||0,d=h[i]||h[o],Y=Math.max(0,(d||0)-a);return{nextLevel:i,nextReq:d,have:a,remaining:Y,currReq:c}},[h]),b=l.useRef(null),p=l.useCallback(async()=>{y(!0);try{const{data:{session:s}}=await g.auth.getSession(),n=(s==null?void 0:s.user)||null;if(P(n),n){const{data:a,error:r}=await g.from("profiles").select("*").eq("id",n.id).single();if(r)throw r;w(a);const o=Number((a==null?void 0:a.total_coins)||0),i=U(o);if(z(i),D(E(o,i)),a!=null&&a.avatar_url)if(a.avatar_url.includes("://"))u(a.avatar_url);else{const{data:c,error:d}=await g.storage.from("avatars").createSignedUrl(a.avatar_url,3600);d?(console.warn("Avatar signed URL creation failed:",d),u("")):u((c==null?void 0:c.signedUrl)||"")}else u("")}else w(null),u("")}catch(s){w(null),u("")}finally{y(!1)}},[U,E]);l.useEffect(()=>{p()},[p]);const O=async()=>{await q()},T=()=>{var s;return(s=b.current)==null?void 0:s.click()},F=async s=>{var a;const n=(a=s.target.files)==null?void 0:a[0];if(!(!n||!m)){S(!0);try{const r=`${m.id}/${Date.now()}-${n.name}`,{error:o}=await g.storage.from("avatars").upload(r,n,{upsert:!0});if(o)throw o;const{error:i}=await g.from("profiles").update({avatar_url:r}).eq("id",m.id);if(i)throw i;const{data:c,error:d}=await g.storage.from("avatars").createSignedUrl(r,3600);d||u((c==null?void 0:c.signedUrl)||""),await p(),alert("Avatar updated")}catch(r){alert(`Avatar change failed: ${(r==null?void 0:r.message)||"Try again later"}`)}finally{S(!1),b.current&&(b.current.value="")}}},H=(s,n)=>{const a=Number(s||0);if(Math.max(0,Number(n||0))>=100)return 100;const{nextReq:o,currReq:i}=N;if(!o||o<=i)return 0;const c=o-i,d=Math.max(0,Math.min(c,a-i));return Math.round(d/c*100)};if(M)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(J,{className:"w-8 h-8 animate-spin text-indigo-300"})});if(!m)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-800/40 text-indigo-300 flex items-center justify-center mb-3 border border-indigo-700/60",children:e.jsx($,{className:"w-6 h-6"})}),e.jsxs("p",{className:"text-lg text-slate-200",children:["You are not logged in or session expired.",e.jsx("br",{}),"Please"," ",e.jsx(v,{to:"/login",className:"text-indigo-300 underline",children:"login"})," ","to view your profile."]})]});const Q=t!=null&&t.username?`@${t.username}`:"Username not set",V=(t==null?void 0:t.email)||m.email,R=Number((_=t==null?void 0:t.total_coins)!=null?_:0),W=H(R,x),f=x>=80?"from-violet-500 via-fuchsia-500 to-pink-500":x>=50?"from-amber-400 via-orange-500 to-red-500":x>=20?"from-cyan-400 via-blue-500 to-indigo-500":"from-emerald-400 via-teal-500 to-cyan-500";return e.jsxs("div",{className:"relative overflow-x-hidden",children:[e.jsx(B,{title:"Your Quiz Dangal Profile",description:"View and manage your Quiz Dangal profile details, quiz preferences, and account settings.",canonical:"https://quizdangal.com/profile/",robots:"noindex, nofollow"}),e.jsxs("div",{className:"mx-auto w-full max-w-lg px-4 pt-14 pb-12 space-y-3",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-slate-900/95 via-slate-800/90 to-slate-900/95 border border-white/10 shadow-2xl",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden","aria-hidden":!0,children:[e.jsx("div",{className:`absolute -top-20 -left-20 w-40 h-40 rounded-full bg-gradient-to-br ${f} opacity-25 blur-3xl`}),e.jsx("div",{className:"absolute -bottom-20 -right-20 w-48 h-48 rounded-full bg-gradient-to-br from-pink-500 via-purple-500 to-indigo-500 opacity-20 blur-3xl"})]}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r ${f}`}),e.jsxs("div",{className:"relative p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:`absolute -inset-1 rounded-full bg-gradient-to-tr ${f} blur-sm opacity-60`}),e.jsx("div",{className:"relative w-20 h-20 rounded-full overflow-hidden ring-[3px] ring-white/20 ring-offset-2 ring-offset-slate-900 shadow-2xl",children:L?e.jsx("img",{src:L,alt:t!=null&&t.full_name||t!=null&&t.username?`${t.full_name||t.username} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:`w-full h-full bg-gradient-to-br ${f} flex items-center justify-center`,children:e.jsx("span",{className:"text-2xl font-bold text-white",children:((t==null?void 0:t.full_name)||(m==null?void 0:m.email)||"U").charAt(0).toUpperCase()})})}),e.jsx("button",{onClick:T,disabled:j,className:"absolute -bottom-0.5 -right-0.5 p-1.5 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 border-2 border-slate-900 shadow-lg text-white hover:scale-110 transition disabled:opacity-60",title:j?"Uploading...":"Change avatar","aria-label":j?"Uploading avatar":"Change avatar",children:e.jsx(K,{className:"w-3.5 h-3.5","aria-hidden":"true"})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",className:"hidden",onChange:F}),e.jsx("div",{className:`absolute -top-1 -left-1 px-2 py-0.5 rounded-full bg-gradient-to-r ${f} shadow-lg`,children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:x})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white truncate",children:Q}),x>=50&&e.jsx($,{className:"w-4 h-4 text-amber-400 shrink-0"})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5",children:V})]})]}),e.jsxs("button",{onClick:()=>C(!0),className:"mt-3 inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full text-[11px] font-semibold bg-white/10 border border-white/20 text-white hover:bg-white/20 hover:scale-105 transition",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Edit Profile"]}),e.jsxs("button",{onClick:()=>I(!k),className:"mt-3 w-full p-2.5 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-left",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(X,{className:"w-3.5 h-3.5 text-yellow-400"}),e.jsxs("span",{className:"text-xs font-semibold text-white",children:["Level ",x]})]}),e.jsx("div",{className:"relative h-2 bg-slate-800/80 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${f} shadow-[0_0_12px_rgba(139,92,246,0.5)] transition-all duration-700`,style:{width:`${W}%`}})}),k&&e.jsxs("div",{className:"mt-2 p-2.5 rounded-lg bg-slate-800/90 border border-white/10 text-[11px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Current Coins"}),e.jsx("span",{className:"text-amber-400 font-bold",children:R.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-slate-400",children:["Next Level (",x+1,")"]}),e.jsx("span",{className:"text-emerald-400 font-bold",children:N.nextReq.toLocaleString()})]}),e.jsxs("div",{className:"mt-1 pt-1 border-t border-white/10 flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Need More"}),e.jsx("span",{className:"text-rose-400 font-bold",children:N.remaining.toLocaleString()})]})]})]})]})]}),e.jsxs("section",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(v,{to:"/wallet",className:"relative flex items-center gap-3 p-3 rounded-xl overflow-hidden group",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(20, 184, 166, 0.15) 100%)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-400 to-teal-500 grid place-items-center shadow-md flex-shrink-0",children:e.jsx(ee,{className:"w-4.5 h-4.5 text-white"})}),e.jsx("p",{className:"flex-1 text-sm font-bold text-white",children:"Wallet"})]}),e.jsxs(v,{to:"/refer",className:"relative flex items-center gap-3 p-3 rounded-xl overflow-hidden group",style:{background:"linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(168, 85, 247, 0.15) 100%)",border:"1px solid rgba(168, 85, 247, 0.3)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-pink-400 to-violet-500 grid place-items-center shadow-md flex-shrink-0",children:e.jsx(te,{className:"w-4.5 h-4.5 text-white"})}),e.jsx("p",{className:"flex-1 text-sm font-bold text-white",children:"Refer & Earn"})]})]}),e.jsxs("section",{className:"rounded-2xl bg-gradient-to-br from-slate-900/90 via-slate-800/80 to-slate-900/90 border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-white/5",children:e.jsx("p",{className:"text-sm font-semibold text-slate-200",children:"Settings & Info"})}),[{label:"About Us",href:"/about-us",icon:se,color:"from-blue-500 to-cyan-500"},{label:"Contact Us",href:"/contact-us",icon:ae,color:"from-pink-500 to-rose-500"},{label:"Terms & Conditions",href:"/terms-conditions",icon:re,color:"from-violet-500 to-purple-500"},{label:"Privacy Policy",href:"/privacy-policy",icon:le,color:"from-amber-500 to-orange-500"}].map(s=>e.jsxs(v,{to:s.href,className:"group flex items-center justify-between px-4 py-3 hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-8 h-8 rounded-xl bg-gradient-to-br ${s.color} grid place-items-center shadow group-hover:scale-105 transition`,children:e.jsx(s.icon,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.label})]}),e.jsx(ne,{className:"w-4 h-4 text-slate-500 group-hover:text-white group-hover:translate-x-0.5 transition"})]},s.href)),e.jsx("div",{className:"px-4 py-3 border-t border-white/5",children:e.jsxs("button",{onClick:O,className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-rose-500/10 hover:bg-rose-500/20 transition text-xs text-rose-300 font-semibold",children:[e.jsx(oe,{className:"w-3.5 h-3.5"}),"Logout"]})})]}),e.jsx(G,{isOpen:A,onClose:()=>{C(!1),p()},isFirstTime:!1})]})]})}export{fe as default};
