import{_ as kt}from"./supabase-07ebd5d8.js";import{e as Mt,u as Lt,h as nt,s as E,a as Et,b as Rt,g as pe,n as It,r as qt,i as $t,c as Pt,j as t,B as Le}from"./index-ead586f9.js";import{r as j}from"./react-63c462fe.js";import{m as Ut}from"./motion-lite-3d667e23.js";import{g as Dt}from"./avatar-4ce2520b.js";import{S as xe}from"./SEO-af453678.js";import{c as Qt,b as Bt}from"./router-d6d570a4.js";import{T as rt,c as Wt,Y as Ht,O as Ot,Z as Vt,d as Yt}from"./icons-1e9e0bae.js";const rs=()=>{const{id:O,slotId:it}=Qt(),[lt,Ee]=j.useState(O),D=it||null,ge=Bt(),{toast:Z}=Mt(),{user:c,userProfile:f,refreshUserProfile:Re}=Lt(),[n,ot]=j.useState(null),[C,Ie]=j.useState([]),[i,ct]=j.useState(null),[be,re]=j.useState(!0),[we,ie]=j.useState(""),[dt,mt]=j.useState(!1),[le,oe]=j.useState(null),[qe,ft]=j.useState(!1),[$e,ye]=j.useState(null),[ut,Pe]=j.useState(0),[Q,ht]=j.useState([]),[ve,Ue]=j.useState(!1),De=(f==null?void 0:f.role)==="admin",pt={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}};j.useEffect(()=>{(async()=>{if(D&&!O){const{data:a}=await E.from("quiz_slots_view").select("quiz_id").eq("id",D).maybeSingle();a!=null&&a.quiz_id&&Ee(a.quiz_id)}else Ee(O)})()},[D,O]);const y=lt,V=j.useCallback(async()=>{var s,a,l;if(!nt||!E||!y){if(!y&&(D||O))return;ie("Results are unavailable right now."),re(!1);return}try{ie("");const[e,N,d,v]=await Promise.all([E.from("quizzes").select("*").eq("id",y).single(),E.from("quiz_results").select("leaderboard").eq("quiz_id",y).maybeSingle(),(async()=>{try{return await E.rpc("get_engagement_counts",{p_quiz_id:y})}catch(o){return{data:null}}})(),c!=null&&c.id?E.from("quiz_participants").select("id, status").eq("user_id",c.id).or(D?`slot_id.eq.${D},quiz_id.eq.${y}`:`quiz_id.eq.${y}`).limit(1).maybeSingle():Promise.resolve({data:null})]);if(e.error)throw e.error;const h=e.data;ot(h||null);let w=!!v.data;mt(w);try{const o=Array.isArray(d.data)?d.data[0]:d.data,g=Number((s=o==null?void 0:o.joined)!=null?s:0),p=Number((a=o==null?void 0:o.pre_joined)!=null?a:0);Pe(g+p)}catch(o){Pe(0)}const _=De||w||Et({defaultValue:!0});let S=Array.isArray((l=N.data)==null?void 0:l.leaderboard)?N.data.leaderboard:[];if(S.length===0&&(h!=null&&h.end_time)){const g=new Date(h.end_time).getTime()-Date.now();if(oe(g>0?g:0),g<=0&&_)try{await Rt(E,y,{throttleMs:200});const{data:p}=await E.from("quiz_results").select("leaderboard").eq("quiz_id",y).maybeSingle(),I=Array.isArray(p==null?void 0:p.leaderboard)?p.leaderboard:[];I.length&&(S=I)}catch(p){}}const k=Array.isArray(S)?S.map((o,g)=>{var p;return{...o,rank:(p=o.rank)!=null?p:g+1}}):[];Ie(k),re(!1);const B=k.find(o=>(o.user_id||o.userId)===(c==null?void 0:c.id));B&&ct(B);const R=((h==null?void 0:h.category)||"").toLowerCase()!=="opinion"&&(w||k.length),T=k.slice(0,10).map(o=>o.user_id).filter(Boolean);Promise.all([R?E.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",y).order("id"):Promise.resolve({data:[]}),T.length?E.rpc("profiles_public_by_ids",{p_ids:T}):Promise.resolve({data:[]})]).then(async([o,g])=>{try{if(R&&Array.isArray(o.data)&&o.data.length){let p=new Map;if(c!=null&&c.id){const z=o.data.map(M=>M.id),{data:A}=await E.from("user_answers").select("question_id, selected_option_id").in("question_id",z).eq("user_id",c.id);Array.isArray(A)&&(p=new Map(A.map(M=>[M.question_id,M.selected_option_id])))}const I=o.data.map(z=>({id:z.id,question_text:z.question_text,options:(z.options||[]).map(A=>({id:A.id,option_text:A.option_text,is_correct:!!A.is_correct,isSelected:p.get(z.id)===A.id}))}));ht(I)}}catch(p){}try{if(Array.isArray(g.data)&&g.data.length){const p=new Map(g.data.map(z=>[z.id,z])),I=await Dt(g.data.map(z=>z.avatar_url).filter(Boolean));Ie(z=>z.map(A=>{const M=p.get(A.user_id);if(!M)return A;const Ne=M.avatar_url&&I.get(M.avatar_url)||"";return{...A,profiles:{username:M.username,full_name:M.full_name,avatar_url:Ne}}}))}}catch(p){}}).catch(()=>{})}catch(e){console.error("Error fetching results:",e),ie((e==null?void 0:e.message)||"Failed to load results."),re(!1)}},[y,O,D,c==null?void 0:c.id,De]);j.useEffect(()=>{y&&V()},[V,y]);const xt=()=>{re(!0),ie(""),V()},J=(n==null?void 0:n.prize_type)||"coins",ce=i!=null&&i.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[i.rank-1]?n.prizes[i.rank-1]:0,gt=pe(J,ce,{fallback:0});j.useEffect(()=>{let s=!1;return(async()=>{try{if(C.length===0){ye(null);return}const l=await je();s||ye(l)}catch(l){s||ye(null)}})(),()=>{s=!0}},[C.length,y,i==null?void 0:i.rank,i==null?void 0:i.score,f==null?void 0:f.full_name,f==null?void 0:f.username,c==null?void 0:c.id,f==null?void 0:f.referral_code,ce]),j.useEffect(()=>{try{if(!(c!=null&&c.id)||!Array.isArray(n==null?void 0:n.prizes)||!(i!=null&&i.rank))return;(n.prizes[i.rank-1]||0)>0&&Re(c)}catch(s){}},[c,i==null?void 0:i.rank,n==null?void 0:n.prizes,Re]);const je=j.useCallback(async()=>{try{const l=document.createElement("canvas");l.width=1080,l.height=1920;const e=l.getContext("2d");e.textBaseline="top";const N="Inter, system-ui, -apple-system, Segoe UI, Roboto",d=(r,m)=>{e.font=`${r} ${m}px ${N}`},v=r=>e.measureText(r).width,h=(r,m,u,x,b)=>{let L=x;for(d(u,L);L>b&&v(r)>m;)L-=2,d(u,L);return L},w=(r,m,u,x)=>{d(u,x);const b=String(r).split(/\s+/),L=[];let $="";for(const G of b){const he=$?$+" "+G:G;v(he)<=m?$=he:($&&L.push($),$=G)}return $&&L.push($),L},_=(r,m,u,x,b,L,$,G,he)=>{let H=L,ne=w(r,x,b,H);for(;(ne.length>G||ne.some(X=>v(X)>x))&&H>$;)H-=1,ne=w(r,x,b,H);d(b,H),e.fillStyle=he;const tt=Math.round(H*1.25),st=Math.min(G,ne.length);for(let X=0;X<st;X++){const at=ne[X],At=v(at);e.fillText(at,m-At/2,u+X*tt)}return{height:st*tt,size:H}},S=(r,m)=>{let u=String(r);for(;u&&v(u)>m;)u=u.slice(0,-1);return u.length<String(r).length?u.slice(0,Math.max(0,u.length-1))+"â€¦":u},k=r=>new Promise((m,u)=>{const x=new Image;x.crossOrigin="anonymous",x.onload=()=>m(x),x.onerror=u,x.src=r}),B=(r,m,u,x,b)=>{e.beginPath(),e.moveTo(r+b,m),e.lineTo(r+u-b,m),e.quadraticCurveTo(r+u,m,r+u,m+b),e.lineTo(r+u,m+x-b),e.quadraticCurveTo(r+u,m+x,r+u-b,m+x),e.lineTo(r+b,m+x),e.quadraticCurveTo(r,m+x,r,m+x-b),e.lineTo(r,m+b),e.quadraticCurveTo(r,m,r+b,m),e.closePath()},de=e.createLinearGradient(0,0,1080,1920);de.addColorStop(0,"#150a36"),de.addColorStop(1,"#0f0926"),e.fillStyle=de,e.fillRect(0,0,1080,1920);const R=64,T=1080/2;let o=R+12;const g=140,p=o+g;e.save(),e.beginPath(),e.arc(T,p,g,0,Math.PI*2),e.closePath();const I=e.createLinearGradient(T-g,p-g,T+g,p+g);I.addColorStop(0,"#1cc5ff"),I.addColorStop(1,"#ef47ff"),e.fillStyle=I,e.fill();try{const m=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let u;try{u=await k(m)}catch(L){u=await k("/android-chrome-192x192.png")}const x=16,b=g*2-x;e.save(),e.beginPath(),e.arc(T,p,g-x/2,0,Math.PI*2),e.clip(),e.drawImage(u,Math.round(T-b/2),Math.round(p-b/2),Math.round(b),Math.round(b)),e.restore(),e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.7)",e.beginPath(),e.arc(T,p,g-x/2,0,Math.PI*2),e.stroke()}catch(r){}e.restore(),o=p+g+18;const A=`ðŸ… ${((f==null?void 0:f.full_name)||(f==null?void 0:f.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,M=_(A,T,o,1080-R*2,"900",56,34,2,"#ffd54a");o+=M.height+16;const Ne=_("âœ¨ Brains = Fame âœ¨",T,o,1080-R*2,"700",36,22,1,"rgba(255,255,255,0.9)");o+=Ne.height+28;const U=R,q=1080-R*2,_e=U+56,Qe=48,jt=40,Be=i!=null&&i.rank?`#${i.rank} Rank!`:"Results Live!",We=`ðŸ‘‘ Prize: ${pe(J,ce,{fallback:0}).formatted}`,K=typeof(i==null?void 0:i.score)=="number"?`â˜‘ï¸ Score: ${i.score}`:"",Se=h(Be,q-100,"900",112,80),ze=h(We,q-100,"900",48,32),Ce=K?h(K,q-100,"900",44,28):0,Nt=Math.round(Se*1)+24+Math.round(ze*1.15)+12+(K?Math.round(Ce*1.15)+12:0),He=Qe+Nt+jt,ee=o,Te=e.createLinearGradient(U,ee,U+q,ee);Te.addColorStop(0,"rgba(34,211,238,0.9)"),Te.addColorStop(1,"rgba(236,72,153,0.9)"),e.save(),B(U,ee,q,He,36),e.fillStyle="rgba(15,23,42,0.72)",e.fill(),e.lineWidth=4,e.strokeStyle=Te,e.stroke(),e.restore();let Y=ee+Qe;d("900",Se),e.fillStyle="#ffffff",e.fillText(Be,_e,Y),Y+=Math.round(Se*1)+24,d("900",ze),e.fillStyle="#ffd54a",e.fillText(We,_e,Y),Y+=Math.round(ze*1.15)+12,K&&(d("900",Ce),e.fillStyle="rgba(168,255,230,0.95)",e.fillText(K,_e,Y),Y+=Math.round(Ce*1.15)+12),o=ee+He+28;const Oe=230,Ve=Math.max(120,1920-R-Oe-o),Ae="âš¡ My Result is Live!",ke=h(Ae,q-120,"900",48,26),_t="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",me=26,Ye=Math.round(me*1.25);d("700",me);const Fe=w(_t,q-120,"700",me).slice(0,2),St=Fe.length*Ye;let fe=28+Math.round(ke)+12+St+28;fe>Ve&&(fe=Ve);const ue=o;B(U,ue,q,fe,28),e.fillStyle="rgba(8,11,30,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(56,189,248,0.5)",e.stroke(),d("900",ke),e.fillStyle="#facc15";const zt=v(Ae);e.fillText(Ae,T-zt/2,ue+28),d("700",me),e.fillStyle="rgba(226,232,240,0.92)";let Ge=ue+28+Math.round(ke)+12;for(const r of Fe){const m=v(r);e.fillText(r,T-m/2,Ge),Ge+=Ye}o=ue+fe+24;const P=o,te=Math.max(Oe,Math.min(280,1920-R-P));B(U,P,q,te,24),e.fillStyle="rgba(12,10,36,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(79,70,229,0.45)",e.stroke();const Ct=f!=null&&f.referral_code?f.referral_code:c!=null&&c.id?c.id.replace(/-/g,"").slice(0,8).toUpperCase():"",se=It(Ct),Tt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(se)}`;if(se)try{const r=qt();(!r||r!==se)&&$t(se)}catch(r){}const ae=Math.min(220,te-72),Xe=ae+32,Ze=ae+40,Me=U+q-Xe-36,Je=P+Math.max(24,Math.round((te-Ze)/2));B(Me,Je,Xe,Ze,18),e.fillStyle="#ffffff",e.fill();try{const{default:r}=await kt(()=>import("./browser-864b0b18.js").then(u=>u.b),[]),m=document.createElement("canvas");await r.toCanvas(m,Tt,{width:ae,margin:1,color:{dark:"#000000",light:"#ffffff"}}),e.drawImage(m,Me+16,Je+16,ae,ae)}catch(r){}const W=U+36,F=Me-24-W;e.fillStyle="rgba(255,255,255,0.96)",d("900",48),e.fillText(S("ðŸ§  Play & Win",F),W,P+36),e.fillStyle="rgba(203,213,225,0.98)",d("800",36),e.fillText(S("ðŸŒ www.quizdangal.com",F),W,P+36+54),d("900",44),e.fillStyle="rgba(255,255,255,0.96)";const Ke="ðŸ”— Referral: ",et=v(Ke);return e.fillText(S(Ke,F),W,P+36+54+62),e.fillStyle="rgba(0,255,198,1)",e.fillText(S(se,Math.max(0,F-et-8)),W+et,P+36+54+62),d("700",26),e.fillStyle="rgba(226,232,240,0.92)",e.fillText(S("Your turn to flex your brain ðŸ’¯",F),W,P+te-80),d("700",24),e.fillStyle="rgba(203,213,225,0.92)",e.fillText(S("#QuizDangal  #ChallengeAccepted  #PlayToWin",F),W,P+te-44),await new Promise(r=>l.toBlob(r,"image/jpeg",.92))}catch(s){try{const a=document.createElement("canvas");a.width=8,a.height=8;const l=a.getContext("2d"),e=l.createLinearGradient(0,0,8,8);return e.addColorStop(0,"#130531"),e.addColorStop(1,"#1e0b4b"),l.fillStyle=e,l.fillRect(0,0,8,8),await new Promise(d=>a.toBlob(d,"image/jpeg",.9))}catch(a){return null}}},[c==null?void 0:c.id,f==null?void 0:f.full_name,f==null?void 0:f.username,f==null?void 0:f.referral_code,i==null?void 0:i.rank,i==null?void 0:i.score,J,ce]);j.useEffect(()=>{if(!(n!=null&&n.end_time)||C.length>0){oe(null);return}const s=new Date(n.end_time).getTime(),a=()=>{const e=s-Date.now();e>0?oe(e):(oe(0),qe||(ft(!0),V()))};a();const l=setInterval(a,1e3);return()=>clearInterval(l)},[n==null?void 0:n.end_time,C.length,qe,V]);const bt=(()=>{var s,a;try{const l=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},e=(a=(s={}.VITE_ENABLE_REALTIME)!=null?s:l.VITE_ENABLE_REALTIME)!=null?a:"1",N=String(e).toLowerCase();return N==="1"||N==="true"||N==="yes"}catch(l){return!1}})(),wt=(()=>{try{if(!bt||!nt||!E||!y||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();Pt({enabled:C.length===0&&wt,channelName:`quiz-results-${y}`,table:"quiz_results",filter:`quiz_id=eq.${y}`,onChange:V,joinTimeoutMs:5e3});const yt=async()=>{try{let s=$e;if(s||(s=await je()),s&&navigator.canShare&&window.File){const a=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[a]})){await navigator.share({files:[a],title:"Quiz Dangal Result"}),Z({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="quiz-dangal-result.jpg",l.rel="noopener",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>URL.revokeObjectURL(a),1500),Z({title:"Poster saved",description:"Share the image from your gallery."});return}Z({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){Z({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},vt=async()=>{try{let s=$e;if(s||(s=await je()),s&&navigator.canShare&&window.File){const w=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[w]})){await navigator.share({files:[w],title:"Quiz Dangal Result"});return}}if(s)try{const w=URL.createObjectURL(s),_=document.createElement("a");_.href=w,_.download="quiz-dangal-result.jpg",_.rel="noopener",document.body.appendChild(_),_.click(),document.body.removeChild(_),setTimeout(()=>URL.revokeObjectURL(w),1500)}catch(w){}const a=navigator.userAgent||"",l=/Android/i.test(a),e=/iPhone|iPad|iPod/i.test(a),N="whatsapp://send",d="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",v="https://wa.me/",h=w=>!!window.open(w,"_blank");if(l){if(h(N))return;window.location.href=d,setTimeout(()=>{document.hidden||(window.location.href=v)},700);return}if(e){window.location.href=N,setTimeout(()=>{document.hidden||(window.location.href=v)},700);return}h(v)}catch(s){Z({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};if(be)return t.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[t.jsx(xe,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${y}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]});if(!be&&we)return t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(xe,{title:"Results â€“ Error | Quiz Dangal",description:we||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${y}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),t.jsx("p",{className:"text-slate-300 mb-4",children:we}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Le,{variant:"brand",onClick:xt,children:"Retry"}),t.jsx(Le,{variant:"white",onClick:()=>ge("/my-quizzes/"),children:"Back"})]})]})]});if(!be&&(le!=null?le:0)>0&&C.length===0){const s=v=>{const h=Math.max(0,Math.floor(v/1e3)),w=Math.floor(h/86400),_=Math.floor(h%86400/3600),S=Math.floor(h%3600/60),k=h%60;return{days:w,hours:_,minutes:S,seconds:k}},{days:a,hours:l,minutes:e,seconds:N}=s(le),d=(v,h)=>t.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[t.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:v.toString().padStart(2,"0")}),t.jsx("div",{className:"text-xs text-slate-400",children:h})]});return t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(xe,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Results will be published soon."}),t.jsx("p",{className:"text-slate-300 mb-4",children:"Quiz ends in"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a>0&&d(a,"Days"),d(l,"Hours"),d(e,"Minutes"),d(N,"Seconds")]}),(n==null?void 0:n.end_time)&&t.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Expected publish time: ",new Date(n.end_time).toLocaleString()]}),t.jsx(Le,{variant:"brand",className:"w-full",onClick:()=>ge("/"),children:"Back to Home"})]})]})}return t.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[t.jsx(xe,{title:`${n!=null&&n.title?`${n.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:C.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${y}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),t.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[t.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:t.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(rt,{className:"w-5 h-5 text-amber-400"}),t.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),t.jsx("p",{className:"text-xs text-slate-400 truncate",children:n==null?void 0:n.title}),t.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[t.jsx(Wt,{className:"w-3 h-3"}),t.jsxs("span",{children:[ut||(C==null?void 0:C.length)||0," participants"]})]})]}),(i==null?void 0:i.rank)&&t.jsxs("div",{className:"shrink-0 text-center",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:t.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",i.rank]})}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(n==null?void 0:n.prizes)&&n.prizes.length>0&&t.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:n.prizes.slice(0,5).map((s,a)=>{const l=pe(J,s,{fallback:0}),e=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":`#${a+1}`;return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[t.jsx("span",{children:e}),t.jsx("span",{children:l.formatted})]},a)})})]})}),c&&(i||dt)&&t.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:t.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("div",{className:"text-xs font-semibold text-white",children:i?"Your Result":"You Participated"}),i&&t.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",C.length]})]}),((Q==null?void 0:Q.length)||0)>0&&t.jsxs("button",{type:"button",onClick:()=>Ue(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${ve?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":ve,children:[t.jsx(Ht,{className:"w-3 h-3"}),"Q&A"]})]}),i?t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),t.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",i.rank]})]}),t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),t.jsx("p",{className:"text-base font-bold text-emerald-400",children:i.score})]}),t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),t.jsx("p",{className:"text-base font-bold text-purple-400",children:gt.formatted})]})]}):t.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),ve&&((Q==null?void 0:Q.length)||0)>0&&t.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[t.jsx(Ot,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),t.jsx("button",{type:"button",onClick:()=>Ue(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),t.jsx("div",{className:"space-y-2",children:Q.map((s,a)=>t.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[t.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[t.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",a+1,"."]}),s.question_text]}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(l=>{const e=!!l.is_correct,N=!!l.isSelected,d=e?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":N?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return t.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${d}`,children:t.jsxs("div",{className:"flex items-center gap-1",children:[e&&t.jsx("span",{children:"âœ“"}),N&&!e&&t.jsx("span",{children:"âœ—"}),t.jsx("span",{className:"truncate",children:l.option_text})]})},l.id)})})]},s.id))})]}),t.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[t.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[t.jsx(rt,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),t.jsxs("div",{className:"space-y-1.5",children:[C.length===0&&t.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),C.map((s,a)=>{var h,w,_,S,k;const l=s.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[s.rank-1]?n.prizes[s.rank-1]:0,e=pe(J,l,{fallback:0}),N=s.user_id===(c==null?void 0:c.id),d=a<3,v=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":null;return t.jsxs(Ut.div,{variants:pt,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-2 p-2 rounded-lg border ${N?"bg-indigo-950/40 border-indigo-600/40":d?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${d?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:v||`#${s.rank||a+1}`}),t.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(h=s.profiles)!=null&&h.avatar_url?t.jsx("img",{src:s.profiles.avatar_url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):t.jsx("span",{children:(((w=s.profiles)==null?void 0:w.full_name)||((_=s.profiles)==null?void 0:_.username)||"U").charAt(0).toUpperCase()})}),t.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((S=s.profiles)==null?void 0:S.username)||((k=s.profiles)==null?void 0:k.full_name)||"Anonymous"})]}),t.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[t.jsx("div",{className:"text-right",children:t.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),t.jsx("div",{className:"text-right min-w-[50px]",children:t.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:e.formatted})})]})]},`${s.id}-${a}`)})]})]})]}),t.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:t.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:()=>ge("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[t.jsx(Vt,{className:"w-4 h-4"}),"Back"]}),t.jsxs("button",{onClick:vt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[t.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),t.jsxs("button",{onClick:yt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[t.jsx(Yt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{rs as default};
