import{_ as kt}from"./supabase-07ebd5d8.js";import{e as Mt,u as Rt,h as rt,s as A,a as Lt,b as qt,g as he,n as Et,r as It,i as $t,c as Pt,j as t,B as Le}from"./index-4d7cf7b0.js";import{r as v}from"./react-63c462fe.js";import{m as Ut}from"./motion-lite-3d667e23.js";import{g as Dt}from"./avatar-dbd7ba00.js";import{S as pe}from"./SEO-4572607d.js";import{c as Qt,b as Bt}from"./router-d6d570a4.js";import{T as it,c as Wt,Y as Ht,O as Ot,Z as Vt,d as Yt}from"./icons-1e9e0bae.js";const rs=()=>{const{id:O,slotId:lt}=Qt(),[ot,qe]=v.useState(O),D=lt||null,xe=Bt(),{toast:Z}=Mt(),{user:o,userProfile:f,refreshUserProfile:Ee}=Rt(),[n,ct]=v.useState(null),[k,Ie]=v.useState([]),[i,dt]=v.useState(null),[ge,be]=v.useState(!0),[we,re]=v.useState(""),[mt,ft]=v.useState(!1),[ie,le]=v.useState(null),[$e,ut]=v.useState(!1),[Pe,ye]=v.useState(null),[ht,Ue]=v.useState(0),[Q,ve]=v.useState([]),[je,De]=v.useState(!1),Qe=(f==null?void 0:f.role)==="admin",pt={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}};v.useEffect(()=>{(async()=>{if(D&&!O){const{data:a}=await A.from("quiz_slots_view").select("quiz_id").eq("id",D).maybeSingle();a!=null&&a.quiz_id&&qe(a.quiz_id)}else qe(O)})()},[D,O]);const w=ot,V=v.useCallback(async()=>{var s,a,l;if(!rt||!A||!w){if(!w&&(D||O))return;re("Results are unavailable right now."),be(!1);return}try{re("");const[e,j,d,y]=await Promise.all([A.from("quizzes").select("*").eq("id",w).single(),A.from("quiz_results").select("leaderboard").eq("quiz_id",w).maybeSingle(),(async()=>{try{return await A.rpc("get_engagement_counts",{p_quiz_id:w})}catch(c){return{data:null}}})(),o!=null&&o.id?A.from("quiz_participants").select("id, status").eq("user_id",o.id).or(D?`slot_id.eq.${D},quiz_id.eq.${w}`:`quiz_id.eq.${w}`).limit(1).maybeSingle():Promise.resolve({data:null})]);if(e.error)throw e.error;const h=e.data;ct(h||null);let g=!!y.data;if(!g&&(o!=null&&o.id))try{const{count:c}=await A.from("user_answers").select("id",{count:"exact",head:!0}).eq("user_id",o.id).in("question_id",A.from("questions").select("id").eq("quiz_id",w)).limit(1);c&&c>0&&(g=!0)}catch(c){}ft(g);try{const c=Array.isArray(d.data)?d.data[0]:d.data,T=Number((s=c==null?void 0:c.joined)!=null?s:0),p=Number((a=c==null?void 0:c.pre_joined)!=null?a:0);Ue(T+p)}catch(c){Ue(0)}const _=Qe||g||Lt({defaultValue:!0});let S=Array.isArray((l=j.data)==null?void 0:l.leaderboard)?j.data.leaderboard:[];if(S.length===0&&(h!=null&&h.end_time)){const T=new Date(h.end_time).getTime()-Date.now();if(le(T>0?T:0),T<=0&&_)try{await qt(A,w,{throttleMs:200});const{data:p}=await A.from("quiz_results").select("leaderboard").eq("quiz_id",w).maybeSingle(),z=Array.isArray(p==null?void 0:p.leaderboard)?p.leaderboard:[];z.length&&(S=z)}catch(p){}}const R=Array.isArray(S)?S.map((c,T)=>{var p;return{...c,rank:(p=c.rank)!=null?p:T+1}}):[];Ie(R);const B=R.find(c=>(c.user_id||c.userId)===(o==null?void 0:o.id));B&&dt(B);const E=((h==null?void 0:h.category)||"").toLowerCase()!=="opinion"&&(g||R.length),M=R.slice(0,10).map(c=>c.user_id).filter(Boolean),[N,C]=await Promise.all([E?A.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",w).order("id"):Promise.resolve({data:[]}),M.length?A.rpc("profiles_public_by_ids",{p_ids:M}):Promise.resolve({data:[]})]);try{if(E&&Array.isArray(N.data)&&N.data.length){let c=new Map;if(o!=null&&o.id){const p=N.data.map(L=>L.id),{data:z}=await A.from("user_answers").select("question_id, selected_option_id").in("question_id",p).eq("user_id",o.id);Array.isArray(z)&&(c=new Map(z.map(L=>[L.question_id,L.selected_option_id])))}const T=N.data.map(p=>({id:p.id,question_text:p.question_text,options:(p.options||[]).map(z=>({id:z.id,option_text:z.option_text,is_correct:!!z.is_correct,isSelected:c.get(p.id)===z.id}))}));ve(T)}else ve([])}catch(c){ve([])}try{if(Array.isArray(C.data)&&C.data.length){const c=new Map(C.data.map(p=>[p.id,p])),T=await Dt(C.data.map(p=>p.avatar_url).filter(Boolean));Ie(p=>p.map(z=>{const L=c.get(z.user_id);if(!L)return z;const Ne=L.avatar_url&&T.get(L.avatar_url)||"";return{...z,profiles:{username:L.username,full_name:L.full_name,avatar_url:Ne}}}))}}catch(c){}}catch(e){console.error("Error fetching results:",e),re((e==null?void 0:e.message)||"Failed to load results.")}finally{be(!1)}},[w,O,D,o==null?void 0:o.id,Qe]);v.useEffect(()=>{w&&V()},[V,w]);const xt=()=>{be(!0),re(""),V()},J=(n==null?void 0:n.prize_type)||"coins",oe=i!=null&&i.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[i.rank-1]?n.prizes[i.rank-1]:0,gt=he(J,oe,{fallback:0});v.useEffect(()=>{let s=!1;return(async()=>{try{if(k.length===0){ye(null);return}const l=await _e();s||ye(l)}catch(l){s||ye(null)}})(),()=>{s=!0}},[k.length,w,i==null?void 0:i.rank,i==null?void 0:i.score,f==null?void 0:f.full_name,f==null?void 0:f.username,o==null?void 0:o.id,f==null?void 0:f.referral_code,oe]),v.useEffect(()=>{try{if(!(o!=null&&o.id)||!Array.isArray(n==null?void 0:n.prizes)||!(i!=null&&i.rank))return;(n.prizes[i.rank-1]||0)>0&&Ee(o)}catch(s){}},[o,i==null?void 0:i.rank,n==null?void 0:n.prizes,Ee]);const _e=v.useCallback(async()=>{try{const l=document.createElement("canvas");l.width=1080,l.height=1920;const e=l.getContext("2d");e.textBaseline="top";const j="Inter, system-ui, -apple-system, Segoe UI, Roboto",d=(r,m)=>{e.font=`${r} ${m}px ${j}`},y=r=>e.measureText(r).width,h=(r,m,u,x,b)=>{let q=x;for(d(u,q);q>b&&y(r)>m;)q-=2,d(u,q);return q},g=(r,m,u,x)=>{d(u,x);const b=String(r).split(/\s+/),q=[];let $="";for(const G of b){const ue=$?$+" "+G:G;y(ue)<=m?$=ue:($&&q.push($),$=G)}return $&&q.push($),q},_=(r,m,u,x,b,q,$,G,ue)=>{let H=q,ne=g(r,x,b,H);for(;(ne.length>G||ne.some(X=>y(X)>x))&&H>$;)H-=1,ne=g(r,x,b,H);d(b,H),e.fillStyle=ue;const st=Math.round(H*1.25),at=Math.min(G,ne.length);for(let X=0;X<at;X++){const nt=ne[X],At=y(nt);e.fillText(nt,m-At/2,u+X*st)}return{height:at*st,size:H}},S=(r,m)=>{let u=String(r);for(;u&&y(u)>m;)u=u.slice(0,-1);return u.length<String(r).length?u.slice(0,Math.max(0,u.length-1))+"â€¦":u},R=r=>new Promise((m,u)=>{const x=new Image;x.crossOrigin="anonymous",x.onload=()=>m(x),x.onerror=u,x.src=r}),B=(r,m,u,x,b)=>{e.beginPath(),e.moveTo(r+b,m),e.lineTo(r+u-b,m),e.quadraticCurveTo(r+u,m,r+u,m+b),e.lineTo(r+u,m+x-b),e.quadraticCurveTo(r+u,m+x,r+u-b,m+x),e.lineTo(r+b,m+x),e.quadraticCurveTo(r,m+x,r,m+x-b),e.lineTo(r,m+b),e.quadraticCurveTo(r,m,r+b,m),e.closePath()},ce=e.createLinearGradient(0,0,1080,1920);ce.addColorStop(0,"#150a36"),ce.addColorStop(1,"#0f0926"),e.fillStyle=ce,e.fillRect(0,0,1080,1920);const E=64,M=1080/2;let N=E+12;const C=140,c=N+C;e.save(),e.beginPath(),e.arc(M,c,C,0,Math.PI*2),e.closePath();const T=e.createLinearGradient(M-C,c-C,M+C,c+C);T.addColorStop(0,"#1cc5ff"),T.addColorStop(1,"#ef47ff"),e.fillStyle=T,e.fill();try{const m=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let u;try{u=await R(m)}catch(q){u=await R("/android-chrome-192x192.png")}const x=16,b=C*2-x;e.save(),e.beginPath(),e.arc(M,c,C-x/2,0,Math.PI*2),e.clip(),e.drawImage(u,Math.round(M-b/2),Math.round(c-b/2),Math.round(b),Math.round(b)),e.restore(),e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.7)",e.beginPath(),e.arc(M,c,C-x/2,0,Math.PI*2),e.stroke()}catch(r){}e.restore(),N=c+C+18;const z=`ðŸ… ${((f==null?void 0:f.full_name)||(f==null?void 0:f.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,L=_(z,M,N,1080-E*2,"900",56,34,2,"#ffd54a");N+=L.height+16;const Ne=_("âœ¨ Brains = Fame âœ¨",M,N,1080-E*2,"700",36,22,1,"rgba(255,255,255,0.9)");N+=Ne.height+28;const U=E,I=1080-E*2,Se=U+56,Be=48,jt=40,We=i!=null&&i.rank?`#${i.rank} Rank!`:"Results Live!",He=`ðŸ‘‘ Prize: ${he(J,oe,{fallback:0}).formatted}`,K=typeof(i==null?void 0:i.score)=="number"?`â˜‘ï¸ Score: ${i.score}`:"",ze=h(We,I-100,"900",112,80),Ce=h(He,I-100,"900",48,32),Te=K?h(K,I-100,"900",44,28):0,_t=Math.round(ze*1)+24+Math.round(Ce*1.15)+12+(K?Math.round(Te*1.15)+12:0),Oe=Be+_t+jt,ee=N,Ae=e.createLinearGradient(U,ee,U+I,ee);Ae.addColorStop(0,"rgba(34,211,238,0.9)"),Ae.addColorStop(1,"rgba(236,72,153,0.9)"),e.save(),B(U,ee,I,Oe,36),e.fillStyle="rgba(15,23,42,0.72)",e.fill(),e.lineWidth=4,e.strokeStyle=Ae,e.stroke(),e.restore();let Y=ee+Be;d("900",ze),e.fillStyle="#ffffff",e.fillText(We,Se,Y),Y+=Math.round(ze*1)+24,d("900",Ce),e.fillStyle="#ffd54a",e.fillText(He,Se,Y),Y+=Math.round(Ce*1.15)+12,K&&(d("900",Te),e.fillStyle="rgba(168,255,230,0.95)",e.fillText(K,Se,Y),Y+=Math.round(Te*1.15)+12),N=ee+Oe+28;const Ve=230,Ye=Math.max(120,1920-E-Ve-N),ke="âš¡ My Result is Live!",Me=h(ke,I-120,"900",48,26),Nt="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",de=26,Fe=Math.round(de*1.25);d("700",de);const Ge=g(Nt,I-120,"700",de).slice(0,2),St=Ge.length*Fe;let me=28+Math.round(Me)+12+St+28;me>Ye&&(me=Ye);const fe=N;B(U,fe,I,me,28),e.fillStyle="rgba(8,11,30,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(56,189,248,0.5)",e.stroke(),d("900",Me),e.fillStyle="#facc15";const zt=y(ke);e.fillText(ke,M-zt/2,fe+28),d("700",de),e.fillStyle="rgba(226,232,240,0.92)";let Xe=fe+28+Math.round(Me)+12;for(const r of Ge){const m=y(r);e.fillText(r,M-m/2,Xe),Xe+=Fe}N=fe+me+24;const P=N,te=Math.max(Ve,Math.min(280,1920-E-P));B(U,P,I,te,24),e.fillStyle="rgba(12,10,36,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(79,70,229,0.45)",e.stroke();const Ct=f!=null&&f.referral_code?f.referral_code:o!=null&&o.id?o.id.replace(/-/g,"").slice(0,8).toUpperCase():"",se=Et(Ct),Tt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(se)}`;if(se)try{const r=It();(!r||r!==se)&&$t(se)}catch(r){}const ae=Math.min(220,te-72),Ze=ae+32,Je=ae+40,Re=U+I-Ze-36,Ke=P+Math.max(24,Math.round((te-Je)/2));B(Re,Ke,Ze,Je,18),e.fillStyle="#ffffff",e.fill();try{const{default:r}=await kt(()=>import("./browser-864b0b18.js").then(u=>u.b),[]),m=document.createElement("canvas");await r.toCanvas(m,Tt,{width:ae,margin:1,color:{dark:"#000000",light:"#ffffff"}}),e.drawImage(m,Re+16,Ke+16,ae,ae)}catch(r){}const W=U+36,F=Re-24-W;e.fillStyle="rgba(255,255,255,0.96)",d("900",48),e.fillText(S("ðŸ§  Play & Win",F),W,P+36),e.fillStyle="rgba(203,213,225,0.98)",d("800",36),e.fillText(S("ðŸŒ www.quizdangal.com",F),W,P+36+54),d("900",44),e.fillStyle="rgba(255,255,255,0.96)";const et="ðŸ”— Referral: ",tt=y(et);return e.fillText(S(et,F),W,P+36+54+62),e.fillStyle="rgba(0,255,198,1)",e.fillText(S(se,Math.max(0,F-tt-8)),W+tt,P+36+54+62),d("700",26),e.fillStyle="rgba(226,232,240,0.92)",e.fillText(S("Your turn to flex your brain ðŸ’¯",F),W,P+te-80),d("700",24),e.fillStyle="rgba(203,213,225,0.92)",e.fillText(S("#QuizDangal  #ChallengeAccepted  #PlayToWin",F),W,P+te-44),await new Promise(r=>l.toBlob(r,"image/jpeg",.92))}catch(s){try{const a=document.createElement("canvas");a.width=8,a.height=8;const l=a.getContext("2d"),e=l.createLinearGradient(0,0,8,8);return e.addColorStop(0,"#130531"),e.addColorStop(1,"#1e0b4b"),l.fillStyle=e,l.fillRect(0,0,8,8),await new Promise(d=>a.toBlob(d,"image/jpeg",.9))}catch(a){return null}}},[o==null?void 0:o.id,f==null?void 0:f.full_name,f==null?void 0:f.username,f==null?void 0:f.referral_code,i==null?void 0:i.rank,i==null?void 0:i.score,J,oe]);v.useEffect(()=>{if(!(n!=null&&n.end_time)||k.length>0){le(null);return}const s=new Date(n.end_time).getTime(),a=()=>{const e=s-Date.now();e>0?le(e):(le(0),$e||(ut(!0),V()))};a();const l=setInterval(a,1e3);return()=>clearInterval(l)},[n==null?void 0:n.end_time,k.length,$e,V]);const bt=(()=>{var s,a;try{const l=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},e=(a=(s={}.VITE_ENABLE_REALTIME)!=null?s:l.VITE_ENABLE_REALTIME)!=null?a:"1",j=String(e).toLowerCase();return j==="1"||j==="true"||j==="yes"}catch(l){return!1}})(),wt=(()=>{try{if(!bt||!rt||!A||!w||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();Pt({enabled:k.length===0&&wt,channelName:`quiz-results-${w}`,table:"quiz_results",filter:`quiz_id=eq.${w}`,onChange:V,joinTimeoutMs:5e3});const yt=async()=>{try{let s=Pe;if(s||(s=await _e()),s&&navigator.canShare&&window.File){const a=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[a]})){await navigator.share({files:[a],title:"Quiz Dangal Result"}),Z({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="quiz-dangal-result.jpg",l.rel="noopener",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>URL.revokeObjectURL(a),1500),Z({title:"Poster saved",description:"Share the image from your gallery."});return}Z({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){Z({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},vt=async()=>{try{let s=Pe;if(s||(s=await _e()),s&&navigator.canShare&&window.File){const g=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[g]})){await navigator.share({files:[g],title:"Quiz Dangal Result"});return}}if(s)try{const g=URL.createObjectURL(s),_=document.createElement("a");_.href=g,_.download="quiz-dangal-result.jpg",_.rel="noopener",document.body.appendChild(_),_.click(),document.body.removeChild(_),setTimeout(()=>URL.revokeObjectURL(g),1500)}catch(g){}const a=navigator.userAgent||"",l=/Android/i.test(a),e=/iPhone|iPad|iPod/i.test(a),j="whatsapp://send",d="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",y="https://wa.me/",h=g=>!!window.open(g,"_blank");if(l){if(h(j))return;window.location.href=d,setTimeout(()=>{document.hidden||(window.location.href=y)},700);return}if(e){window.location.href=j,setTimeout(()=>{document.hidden||(window.location.href=y)},700);return}h(y)}catch(s){Z({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};if(ge)return t.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[t.jsx(pe,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${w}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]});if(!ge&&we)return t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(pe,{title:"Results â€“ Error | Quiz Dangal",description:we||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${w}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),t.jsx("p",{className:"text-slate-300 mb-4",children:we}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Le,{variant:"brand",onClick:xt,children:"Retry"}),t.jsx(Le,{variant:"white",onClick:()=>xe("/my-quizzes/"),children:"Back"})]})]})]});if(!ge&&(ie!=null?ie:0)>0&&k.length===0){const s=y=>{const h=Math.max(0,Math.floor(y/1e3)),g=Math.floor(h/86400),_=Math.floor(h%86400/3600),S=Math.floor(h%3600/60),R=h%60;return{days:g,hours:_,minutes:S,seconds:R}},{days:a,hours:l,minutes:e,seconds:j}=s(ie),d=(y,h)=>t.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[t.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:y.toString().padStart(2,"0")}),t.jsx("div",{className:"text-xs text-slate-400",children:h})]});return t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(pe,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Results will be published soon."}),t.jsx("p",{className:"text-slate-300 mb-4",children:"Quiz ends in"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a>0&&d(a,"Days"),d(l,"Hours"),d(e,"Minutes"),d(j,"Seconds")]}),(n==null?void 0:n.end_time)&&t.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Expected publish time: ",new Date(n.end_time).toLocaleString()]}),t.jsx(Le,{variant:"brand",className:"w-full",onClick:()=>xe("/"),children:"Back to Home"})]})]})}return t.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[t.jsx(pe,{title:`${n!=null&&n.title?`${n.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:k.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${w}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),t.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[t.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:t.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(it,{className:"w-5 h-5 text-amber-400"}),t.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),t.jsx("p",{className:"text-xs text-slate-400 truncate",children:n==null?void 0:n.title}),t.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[t.jsx(Wt,{className:"w-3 h-3"}),t.jsxs("span",{children:[ht||(k==null?void 0:k.length)||0," participants"]})]})]}),(i==null?void 0:i.rank)&&t.jsxs("div",{className:"shrink-0 text-center",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:t.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",i.rank]})}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(n==null?void 0:n.prizes)&&n.prizes.length>0&&t.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:n.prizes.slice(0,5).map((s,a)=>{const l=he(J,s,{fallback:0}),e=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":`#${a+1}`;return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[t.jsx("span",{children:e}),t.jsx("span",{children:l.formatted})]},a)})})]})}),o&&(i||mt)&&t.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:t.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("div",{className:"text-xs font-semibold text-white",children:i?"Your Result":"You Participated"}),i&&t.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",k.length]})]}),((Q==null?void 0:Q.length)||0)>0&&t.jsxs("button",{type:"button",onClick:()=>De(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${je?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":je,children:[t.jsx(Ht,{className:"w-3 h-3"}),"Q&A"]})]}),i?t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),t.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",i.rank]})]}),t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),t.jsx("p",{className:"text-base font-bold text-emerald-400",children:i.score})]}),t.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[t.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),t.jsx("p",{className:"text-base font-bold text-purple-400",children:gt.formatted})]})]}):t.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),je&&((Q==null?void 0:Q.length)||0)>0&&t.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[t.jsx(Ot,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),t.jsx("button",{type:"button",onClick:()=>De(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),t.jsx("div",{className:"space-y-2",children:Q.map((s,a)=>t.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[t.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[t.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",a+1,"."]}),s.question_text]}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(l=>{const e=!!l.is_correct,j=!!l.isSelected,d=e?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":j?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return t.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${d}`,children:t.jsxs("div",{className:"flex items-center gap-1",children:[e&&t.jsx("span",{children:"âœ“"}),j&&!e&&t.jsx("span",{children:"âœ—"}),t.jsx("span",{className:"truncate",children:l.option_text})]})},l.id)})})]},s.id))})]}),t.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[t.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[t.jsx(it,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),t.jsxs("div",{className:"space-y-1.5",children:[k.length===0&&t.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),k.map((s,a)=>{var h,g,_,S,R;const l=s.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[s.rank-1]?n.prizes[s.rank-1]:0,e=he(J,l,{fallback:0}),j=s.user_id===(o==null?void 0:o.id),d=a<3,y=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":null;return t.jsxs(Ut.div,{variants:pt,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-2 p-2 rounded-lg border ${j?"bg-indigo-950/40 border-indigo-600/40":d?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${d?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:y||`#${s.rank||a+1}`}),t.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(h=s.profiles)!=null&&h.avatar_url?t.jsx("img",{src:s.profiles.avatar_url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):t.jsx("span",{children:(((g=s.profiles)==null?void 0:g.full_name)||((_=s.profiles)==null?void 0:_.username)||"U").charAt(0).toUpperCase()})}),t.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((S=s.profiles)==null?void 0:S.username)||((R=s.profiles)==null?void 0:R.full_name)||"Anonymous"})]}),t.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[t.jsx("div",{className:"text-right",children:t.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),t.jsx("div",{className:"text-right min-w-[50px]",children:t.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:e.formatted})})]})]},`${s.id}-${a}`)})]})]})]}),t.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:t.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:()=>xe("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[t.jsx(Vt,{className:"w-4 h-4"}),"Back"]}),t.jsxs("button",{onClick:vt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[t.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),t.jsxs("button",{onClick:yt,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[t.jsx(Yt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{rs as default};
