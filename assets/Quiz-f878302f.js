import{i as Ae,u as Le,l as Re,s as j,m as xe,Q as Pe,o as pe,b as he,j as e,B as ve,f as De,d as ge,e as $e}from"./index-28ae524f.js";import{r as a}from"./react-63c462fe.js";import{s as qe}from"./smartJoinQuiz-03f7b087.js";import{m as H,AnimatePresence as Je}from"./motion-lite-a13d6934.js";import{S as Z}from"./SEO-868e6e0c.js";import{k as we,X as Ne,b as ue,c as _e,s as Se}from"./icons-2bdec3f2.js";import{c as Me,u as Fe,b as Oe}from"./router-d6d570a4.js";import"./supabase-24c2e735.js";function be(){return typeof document=="undefined"?!1:document.visibilityState==="hidden"}function Ve(n,f,y={}){const{slotId:o=null}=y,{toast:l}=Ae(),{user:c}=Le(),{isSubscribed:u,subscribeToPush:_}=Re(),[d,z]=a.useState(null),[Q,L]=a.useState([]),[b,x]=a.useState(0),[S,R]=a.useState({}),[p,g]=a.useState("loading"),[K,U]=a.useState(null),[ne,B]=a.useState(0),[v,ee]=a.useState(null),[O,re]=a.useState(!1),[ae,oe]=a.useState(!!o),D=a.useCallback(t=>{var i,m,h,C,P,ie;const r=Number((h=(m=(i=t==null?void 0:t.participants_joined)!=null?i:t==null?void 0:t.joined_count)!=null?m:t==null?void 0:t.joined)!=null?h:0),s=Number((ie=(P=(C=t==null?void 0:t.participants_pre)!=null?C:t==null?void 0:t.pre_joined_count)!=null?P:t==null?void 0:t.pre_joined)!=null?ie:0);return{joined:Number.isFinite(r)?r:0,pre_joined:Number.isFinite(s)?s:0}},[]),$=a.useCallback(async()=>{if(!(!o||!j))try{const{data:t,error:r}=await j.from("quiz_slots_view").select("*").eq("id",o).maybeSingle();!r&&t&&(ee(t),re(t.status==="paused"),J(D(t)))}catch(t){}finally{oe(!1)}},[o,D]);a.useEffect(()=>{$();const t=o?setInterval($,3e4):null;return()=>{t&&clearInterval(t)}},[$,o]);const[A,q]=a.useState(!1),[V,J]=a.useState({joined:0,pre_joined:0}),[W,k]=a.useState(!1),[E,T]=a.useState(null),w=a.useRef(null),te=a.useRef(!0),N=a.useRef([]),M=a.useRef(null),F=a.useRef(null);a.useEffect(()=>()=>{te.current=!1,w.current&&clearTimeout(w.current),M.current&&clearTimeout(M.current)},[]);const I=a.useRef({});a.useEffect(()=>{I.current=S},[S]);const se=a.useCallback(()=>{if(M.current||N.current.length===0)return;const t=N.current[0],r=2e3*Math.pow(2,(t.attempt||1)-1),s=Math.min(r,3e4);M.current=setTimeout(()=>{M.current=null,G()},s)},[]),G=a.useCallback(async()=>{if(N.current.length===0)return;const t=[...N.current];N.current=[];for(const r of t)if(!(!c||E==="completed"))try{const{error:s}=await j.from("user_answers").upsert({user_id:c.id,question_id:r.questionId,selected_option_id:r.optionId},{onConflict:"user_id,question_id"});if(s)throw s;R(i=>({...i,[r.questionId]:r.optionId}))}catch(s){const i=(r.attempt||1)+1;i<=6?N.current.push({...r,attempt:i}):l({title:"Answer not saved",description:"One answer failed to sync after multiple retries.",variant:"destructive"})}N.current.length>0&&se()},[E,c,l,se]);a.useEffect(()=>{const t=()=>G(),r=()=>{be()||G()};return window.addEventListener("online",t),document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("online",t),document.removeEventListener("visibilitychange",r)}},[G]);const me=(V.joined||0)+(V.pre_joined||0),Te=p==="active"?V.joined||0:me,X=a.useCallback(async(t=null)=>{const r=t||(d==null?void 0:d.id)||n||o;if(r)try{const{data:s,error:i}=await j.from("questions").select("id, question_text, options ( id, option_text )").eq("quiz_id",r).order("id");if(i){console.error("Questions fetch error:",i),xe.error("Failed to load questions",i.message),L([]);return}if(!s||s.length===0){xe.warn("No questions found for quiz",r),L([]);return}L(s)}catch(s){console.error("Questions load exception:",s),L([])}},[d==null?void 0:d.id,n,o]),Y=a.useCallback(async()=>{var t,r;if(o){if(v){J(D(v));return}await $();return}if(!n){J({joined:0,pre_joined:0});return}try{const{data:s,error:i}=await j.rpc("get_engagement_counts",{p_quiz_id:n});if(i)console.warn("Engagement counts fetch failed:",i),J({joined:0,pre_joined:0});else{const m=Array.isArray(s)?s[0]:s,h=Number((t=m==null?void 0:m.joined)!=null?t:0),C=Number((r=m==null?void 0:m.pre_joined)!=null?r:0);J({joined:isNaN(h)?0:h,pre_joined:isNaN(C)?0:C})}}catch(s){console.warn("Engagement refresh failed",s)}},[n,o,v,$,D]),fe=a.useCallback(async()=>{try{U(null);let t=null;if(o){const{data:i,error:m}=await j.from("quiz_slots_view").select("*").eq("id",o).maybeSingle();if(m||!i){const h="Quiz slot not found.";l({title:"Error",description:h,variant:"destructive"}),U(h),g("error");return}t={id:i.quiz_id||i.id,slotId:i.id,title:i.quiz_title,category:i.category,start_time:i.start_time,end_time:i.end_time,status:i.status,prizes:i.prizes,prize_type:"coins",questions:i.questions},ee(i)}else{const{data:i,error:m}=await j.from("quizzes").select("*").eq("id",n).single();if(m||!i){const h="Quiz not found.";l({title:"Error",description:h,variant:"destructive"}),U(h),g("error");return}t=i}z(t);const r=(t==null?void 0:t.id)||n;let s=null;if(c&&c.id&&r){let i=null,m=null;if(o){const h=await j.from("quiz_participants").select("status").eq("user_id",c.id).eq("slot_id",o).maybeSingle();i=h.data,m=h.error}else{const h=await j.from("quiz_participants").select("status").eq("user_id",c.id).eq("quiz_id",r).maybeSingle();i=h.data,m=h.error}!m&&i?(s=i,k(!0),T(i.status||null),s.status==="completed"&&g("completed")):(k(!1),T(null))}else k(!1),T(null);s&&s.status!=="completed"&&await X(t==null?void 0:t.id),await Y()}catch(t){console.error("Error fetching quiz data:",t);const r="Failed to load quiz. Please check your internet and try again.";l({title:"Error",description:r,variant:"destructive"}),U(r),g("error")}},[n,o,c,f,l,X,Y]);a.useEffect(()=>{fe()},[fe]),a.useEffect(()=>{if(!d||p==="completed"||p==="error")return;const t=()=>{const s=new Date,i=v!=null&&v.start_time?new Date(v.start_time):d.start_time?new Date(d.start_time):null,m=v!=null&&v.end_time?new Date(v.end_time):d.end_time?new Date(d.end_time):null,h=i&&s<i,C=i&&m&&s>=i&&s<m;if(O){g("waiting"),B(h&&i?Math.max(0,Math.round((i.getTime()-s.getTime())/1e3)):C&&m?Math.max(0,Math.round((m.getTime()-s.getTime())/1e3)):0);return}if(h){g("waiting"),B(Math.max(0,Math.round((i.getTime()-s.getTime())/1e3)));return}if(C){g("active"),B(Math.max(0,Math.round((m.getTime()-s.getTime())/1e3)));return}g("finished"),B(0)};t();const r=setInterval(t,1e3);return()=>clearInterval(r)},[d,p,v,O]),a.useEffect(()=>{if(!d||!(p==="waiting"||p==="active"))return;const r=setInterval(()=>{be()||Y()},Pe);return()=>clearInterval(r)},[d,p,Y]),a.useEffect(()=>{(async()=>{var r,s;if(d&&p==="active"&&c&&!(o&&O))try{if(!W||E==="pre_joined"){let i=!1,m=null;for(let h=0;h<2&&!i;h++){const{error:C}=o?await j.rpc("join_slot",{p_slot_id:o}):await j.rpc("join_quiz",{p_quiz_id:n});if(!C){i=!0;break}m=C;const P=String(C.message||"").toLowerCase();if(P.includes("not active")||P.includes("not ready")){await new Promise(ie=>setTimeout(ie,1500));continue}if(P.includes("already")||P.includes("completed")){i=!0;break}if(P.includes("ended")||P.includes("has ended")){g("finished");break}break}if(i)k(!0),T("joined");else if(m){const{error:h}=o?await j.rpc("pre_join_slot",{p_slot_id:o}):await j.rpc("pre_join_quiz",{p_quiz_id:n});if(!h)k(!0),T("pre_joined");else throw m}}Q.length===0&&await X(d==null?void 0:d.id)}catch(i){if(!((r=i==null?void 0:i.message)!=null&&r.includes("already"))&&!((s=i==null?void 0:i.message)!=null&&s.includes("completed"))){const m=pe(i);console.error("Quiz join error:",m,i)}}})()},[d,p,c,W,E,n,o,O,X,Q.length,l]),a.useEffect(()=>{if(w.current&&(clearTimeout(w.current),w.current=null),!d||!d.end_time||!(p==="finished"||p==="completed"))return;const t=()=>{(async()=>{try{await he(j,n)}catch(r){}f(`/results/${n}`)})()};try{const r=new Date(d.end_time).getTime(),s=Date.now(),i=Math.max(0,r-s);i===0?t():w.current=setTimeout(()=>{w.current=null,t()},i)}catch(r){console.error("Error calculating redirect time:",r),w.current=setTimeout(()=>{w.current=null,t()},5e3)}return()=>{w.current&&(clearTimeout(w.current),w.current=null)}},[d,n,p,f]);const Ce=a.useCallback(async()=>{var t,r;if(d){if(!c){l({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),f("/login");return}if(E!=="completed"){try{typeof Notification!="undefined"&&Notification.permission!=="granted"&&!u&&await _()}catch(s){}try{const s=await qe({supabase:j,quiz:d,user:c});if(s.status==="error")throw s.error;s.status==="already"?(k(!0),T("joined"),l({title:"Already Joined",description:"Starting shortly."})):s.status==="joined"?(k(!0),T("joined"),l({title:"Joined!",description:"Starting now."})):s.status==="pre_joined"?(k(!0),T("joined"),l({title:"Joined!",description:"Quiz starts soon. Stay tuned!"})):s.status==="scheduled_retry"&&(k(!0),T("joined"),l({title:"Joined!",description:"Quiz starts soon. Stay tuned!"})),d.status==="active"&&(s.status==="joined"||s.status==="already")&&(await X(d==null?void 0:d.id),g("active")),Y()}catch(s){if(!((t=s==null?void 0:s.message)!=null&&t.includes("already"))&&!((r=s==null?void 0:s.message)!=null&&r.includes("completed"))){const i=pe(s);console.error("Join quiz error:",i,s),l({title:"Error",description:i||"Could not join quiz. Please try again.",variant:"destructive"})}}}}},[d,c,E,u,_,l,f,Y,X,g]),ze=a.useCallback(async(t,r)=>{if(!(A||p!=="active"||E==="completed")&&c!=null&&c.id){R(s=>({...s,[t]:r})),b<Q.length-1&&(typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>x(s=>s+1)):setTimeout(()=>x(s=>s+1),250));try{const{error:s}=await j.from("user_answers").upsert({user_id:c.id,question_id:t,selected_option_id:r},{onConflict:"user_id,question_id"});if(s)throw s}catch(s){console.error("Error saving answer:",s),N.current.some(m=>m.questionId===t)||l({title:"Sync delayed",description:"Network issue. Will retry automatically.",variant:"destructive"}),N.current=N.current.filter(m=>m.questionId!==t),N.current.push({questionId:t,optionId:r,attempt:1}),se()}}},[A,p,E,c==null?void 0:c.id,b,Q.length,l,se]),le=a.useCallback(async()=>{if(!A&&c!=null&&c.id){q(!0);try{if(await G(),N.current.length>0){l({title:"Sync pending",description:"Some answers are still syncing. Please check internet and try again.",variant:"destructive"});return}let t=j.from("quiz_participants").update({status:"completed"}).eq("user_id",c.id);o?t=t.eq("slot_id",o):t=t.eq("quiz_id",n);const{error:r}=await t;if(r)throw r;l({title:"Quiz Completed!",description:"Your answers have been submitted. Results will be announced soon!"}),g("completed");try{await he(j,o||n)}catch(s){}f(o?`/results/slot/${o}`:`/results/${n}`)}catch(t){console.error("Error submitting quiz:",t),l({title:"Submission Failed",description:"Could not submit your answers. Please try again.",variant:"destructive"})}finally{te.current&&q(!1)}}},[A,c==null?void 0:c.id,n,o,l,f,G]);a.useEffect(()=>{F.current=le},[le]);const ce=a.useRef(null),de=a.useRef(null);a.useEffect(()=>{de.current=null,ce.current=null},[n,o]),a.useEffect(()=>{const t=ce.current;if(ce.current=p,p!=="finished"||t==="finished")return;const r=o?`slot:${o}`:`quiz:${n}`;if(de.current===r)return;Object.keys(I.current||{}).length>0&&E==="joined"&&!A&&(de.current=r,typeof F.current=="function"&&F.current())},[p,E,A,n,o]);const Qe=a.useCallback(t=>{const r=Math.floor(t/60),s=t%60;return`${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},[]);return{quiz:d,questions:Q,currentQuestionIndex:b,answers:S,quizState:p,error:K,timeLeft:ne,submitting:A,engagement:V,joined:W,participantStatus:E,totalJoined:me,displayJoined:Te,slotMeta:v,slotPaused:O,slotLoading:ae,setCurrentQuestionIndex:x,handleJoinOrPrejoin:Ce,handleAnswerSelect:ze,handleSubmit:le,formatTime:Qe}}const Ee=({startTime:n,endTime:f})=>e.jsxs("div",{className:"mt-2 text-[10px] text-slate-400",children:[e.jsx("div",{className:"mb-1",children:n?De(n):"â€”"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"Start"}),e.jsx("div",{className:"text-slate-300",children:n?ge(n):"â€”"})]}),e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-500",children:"End"}),e.jsx("div",{className:"text-slate-300",children:f?ge(f):"â€”"})]})]})]}),ke=({prizes:n=[],prizeType:f="coins"})=>{var u,_,d;const y=(u=n[0])!=null?u:0,o=(_=n[1])!=null?_:0,l=(d=n[2])!=null?d:0,c=z=>$e(f,z,{fallback:0}).formatted;return e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-1.5 text-[10px]",children:[e.jsxs("span",{className:"px-2 py-1 rounded-md bg-amber-500/15 text-amber-300 border border-amber-600/30",children:["ðŸ¥‡ ",c(y)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-sky-500/15 text-sky-300 border border-sky-600/30",children:["ðŸ¥ˆ ",c(o)]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-violet-500/15 text-violet-300 border border-violet-600/30",children:["ðŸ¥‰ ",c(l)]})]})},je=({quizId:n})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(Z,{title:"Quiz â€“ Loading | Quiz Dangal",description:"Loading quiz details.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${n||""}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"h-16 w-16 animate-spin text-indigo-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading quiz..."})]})]}),ye=({message:n})=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center text-red-400",children:n||"An error occurred"})}),He=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-400",children:"No questions available for this quiz."})})}),Ue=({quiz:n,title:f,isActive:y,timeLeft:o,displayJoined:l,prizes:c,prizeType:u,formatTime:_,onJoin:d,onClose:z})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center px-3 pt-16",children:[e.jsx(Z,{title:`${f} â€“ Lobby | Quiz Dangal`,description:"Join the quiz lobby.",robots:"noindex, nofollow"}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:z,className:"absolute top-3 right-3 text-slate-500 hover:text-white transition",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center",children:e.jsx(ue,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:f}),e.jsx("p",{className:"text-[11px] text-slate-400 mb-2",children:y?"Quiz is live!":"Quiz starts in"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:_(o)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[11px] text-slate-400 mb-2",children:[e.jsx(_e,{className:"h-3 w-3"}),l," joined"]}),e.jsx(ke,{prizes:c,prizeType:u}),e.jsx(Ee,{startTime:n==null?void 0:n.start_time,endTime:n==null?void 0:n.end_time}),e.jsx("div",{className:"mt-4",children:e.jsx(ve,{onClick:d,className:`w-full h-10 text-sm font-bold ${y?"bg-gradient-to-r from-emerald-600 to-green-500":"bg-gradient-to-r from-indigo-600 to-violet-600"} hover:opacity-90`,children:y?"Join & Start":"Pre-Join"})})]})})})]}),Be=({quiz:n,title:f,timeLeft:y,totalJoined:o,prizes:l,prizeType:c,formatTime:u,onClose:_})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(Z,{title:`${f} â€“ Waiting | Quiz Dangal`,description:"Waiting for the quiz to start.",robots:"noindex, nofollow"}),e.jsx(H.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"relative rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("button",{"aria-label":"Close",onClick:_,className:"absolute top-2 right-2 text-slate-400 hover:text-slate-200 transition",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(ue,{className:"h-6 w-6 text-indigo-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1 line-clamp-2",children:f}),e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Quiz starts in:"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-300 mb-2",children:u(y)}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-400 mb-2",children:[e.jsx(_e,{className:"h-3 w-3"}),o," joined"]}),e.jsx(ke,{prizes:l,prizeType:c}),e.jsx(Ee,{startTime:n==null?void 0:n.start_time,endTime:n==null?void 0:n.end_time}),e.jsx("p",{className:"mt-2 text-[10px] text-slate-500",children:"Auto-starts when timer hits zero"})]})})})]}),We=({title:n,onNavigateHome:f})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(Z,{title:`${n} â€“ Completed | Quiz Dangal`,description:"Quiz completed. Results will be published soon.",robots:"noindex, nofollow"}),e.jsx(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-green-500/40 to-teal-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(Se,{className:"h-6 w-6 text-emerald-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:"Quiz Submitted!"}),e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Thank you for participating!"}),e.jsx("p",{className:"text-sm text-slate-300 mb-3",children:"Results will be published soon."}),e.jsx("button",{onClick:f,className:"mt-3 w-full h-9 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-emerald-600 to-green-500 hover:opacity-90 transition",children:"Back to Home"})]})})})]}),Ge=({title:n,onNavigateHome:f})=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 pt-16 sm:pt-20",children:[e.jsx(Z,{title:`${n} â€“ Time's Up | Quiz Dangal`,description:"Quiz time ended.",robots:"noindex, nofollow"}),e.jsx(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-sm",children:e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/50 via-orange-500/40 to-red-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 backdrop-blur-sm p-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto mb-2",children:e.jsx(ue,{className:"h-6 w-6 text-amber-300"})}),e.jsx("h2",{className:"text-base font-bold text-white mb-1",children:"Time's Up!"}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"This quiz has ended. Try the next one!"}),e.jsx("button",{onClick:f,className:"w-full h-9 rounded-lg text-xs font-bold text-white bg-gradient-to-r from-indigo-600 to-violet-600 hover:opacity-90 transition",children:"Browse Quizzes"})]})})})]}),Xe=({title:n,quizId:f,questions:y,currentQuestionIndex:o,answers:l,timeLeft:c,submitting:u,quizState:_,participantStatus:d,formatTime:z,onAnswerSelect:Q,onSubmit:L})=>{const b=y[o],x=(o+1)/y.length*100;return e.jsxs("div",{className:"min-h-screen px-3 pt-16 pb-6",children:[e.jsx(Z,{title:`${n} â€“ Play | Quiz Dangal`,description:"Answer questions and compete to win.",canonical:typeof window!="undefined"?`${window.location.origin}/quiz/${f}`:"https://quizdangal.com/quiz",robots:"noindex, nofollow"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-indigo-500/50 via-violet-500/40 to-fuchsia-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-sm font-bold text-white truncate",children:n}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Q",o+1," of ",y.length]})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("div",{className:"text-lg font-bold text-rose-400 tabular-nums",children:z(c)}),e.jsx("div",{className:"text-[9px] text-slate-500 uppercase",children:"Time Left"})]})]}),e.jsx("div",{className:"mt-2 w-full bg-slate-800 rounded-full h-1.5 overflow-hidden",children:e.jsx(H.div,{className:"h-1.5 rounded-full bg-gradient-to-r from-cyan-400 via-indigo-500 to-fuchsia-500",style:{width:`${x}%`},transition:{duration:.3}})})]})}),e.jsx(Je,{mode:"wait",children:e.jsxs(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"rounded-xl border border-slate-700/60 bg-slate-900/90 p-4",children:[e.jsx("h2",{className:"text-sm font-bold text-center text-white mb-4 leading-relaxed",children:b==null?void 0:b.question_text}),e.jsx("div",{className:"space-y-2",children:((b==null?void 0:b.options)||[]).map((S,R)=>{const p=l[b==null?void 0:b.id]===S.id;return e.jsxs(H.button,{onClick:()=>Q(b.id,S.id),disabled:u||_!=="active"||d==="completed",whileTap:{scale:.98},className:`w-full p-3 rounded-lg text-left text-sm font-medium transition-all border ${p?"bg-emerald-600/90 text-white border-emerald-500 shadow-lg":"bg-slate-800/60 hover:bg-slate-800 text-slate-200 border-slate-700/60"}`,children:[e.jsxs("span",{className:`font-bold mr-2 ${p?"text-white":"text-indigo-400"}`,children:[String.fromCharCode(65+R),"."]}),S.option_text]},S.id)})}),(()=>{const S=o===y.length-1,R=Object.keys(l).length,p=y.length;return!S||R===0||_!=="active"||d==="completed"?null:e.jsx(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4",children:e.jsx(ve,{onClick:L,disabled:u,className:"w-full h-11 text-sm font-bold bg-gradient-to-r from-indigo-600 via-violet-600 to-fuchsia-600 hover:opacity-90",children:u?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Submit Quiz (",R,"/",p,")"]})})})})()]},(b==null?void 0:b.id)||o)})]})]})},nt=()=>{const{id:n,slotId:f}=Me(),y=Fe(),o=Oe(),l=y.pathname.includes("/quiz/slot/"),c=l?f:n,[u,_]=a.useState(null),[d,z]=a.useState(l),[Q,L]=a.useState(null),b=a.useCallback(async()=>{if(!(!l||!f)){if(!j){L("Supabase not configured"),z(!1);return}try{const{data:F,error:I}=await j.from("quiz_slots_view").select("*").eq("id",f).maybeSingle();if(I)throw I;if(!F)throw new Error("Slot not found");_(F),z(!1)}catch(F){L(F.message||"Failed to load slot"),z(!1)}}},[l,f]);a.useEffect(()=>{l&&b()},[l,b]);const{quiz:x,questions:S,currentQuestionIndex:R,answers:p,quizState:g,timeLeft:K,submitting:U,joined:ne,participantStatus:B,error:v,totalJoined:ee,displayJoined:O,handleJoinOrPrejoin:re,handleAnswerSelect:ae,handleSubmit:oe,formatTime:D}=Ve(l?u==null?void 0:u.id:n,o,l?{slotId:f}:void 0),$=()=>{window.history.length>1?o(-1):o("/")},A=()=>o("/");if(l&&d)return e.jsx(je,{quizId:c});if(l&&Q)return e.jsx(ye,{message:Q});if(g==="error")return e.jsx(ye,{message:v||"Something went wrong. Please try again."});if(g==="loading"||!l&&!x||l&&!u)return e.jsx(je,{quizId:c});const q=l?(u==null?void 0:u.quiz_title)||(x==null?void 0:x.title)||"Quiz":(x==null?void 0:x.title)||"Quiz",V=l?Array.isArray(u==null?void 0:u.prizes)?u.prizes:[]:Array.isArray(x==null?void 0:x.prizes)?x.prizes:[],J=l?"coins":(x==null?void 0:x.prize_type)||"coins",W=l?u==null?void 0:u.start_time:x==null?void 0:x.start_time,k=l?u==null?void 0:u.end_time:x==null?void 0:x.end_time,E=new Date,T=W?new Date(W):null,w=k?new Date(k):null,te=T&&w&&E>=T&&E<w,N=l?{start_time:u==null?void 0:u.start_time,end_time:u==null?void 0:u.end_time}:x;if(!ne&&g!=="completed")return e.jsx(Ue,{quiz:N,title:q,isActive:te,timeLeft:K,displayJoined:O,prizes:V,prizeType:J,formatTime:D,onJoin:re,onClose:$});if(g==="waiting")return e.jsx(Be,{quiz:N,title:q,timeLeft:K,totalJoined:ee,prizes:V,prizeType:J,formatTime:D,onClose:$});const M=Object.keys(p).length>0;return g==="completed"||g==="finished"&&M?e.jsx(We,{title:q,onNavigateHome:A}):g==="finished"&&!M?e.jsx(Ge,{title:q,onNavigateHome:A}):!S||S.length===0?e.jsx(He,{}):e.jsx(Xe,{title:q,quizId:c,questions:S,currentQuestionIndex:R,answers:p,timeLeft:K,submitting:U,quizState:g,participantStatus:B,formatTime:D,onAnswerSelect:ae,onSubmit:oe})};export{nt as default};
