const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-AiupN7X5.js","assets/react-MKCYUrdX.js"])))=>i.map(i=>d[i]);
import{_ as Lt}from"./supabase-cQshKuiM.js";import{e as Pt,u as qt,c as Te,n as Dt,y as Qt,i as Et,h as ct,s as D,a as $t,j as e,S as me,B as fe,d as It,l as Ut}from"./index-Beuxb_yr.js";import{g as Wt,r as w,u as Bt}from"./router-CWIfZQRv.js";import{m as Ht}from"./motion-lite-CguNR5TK.js";import{g as Ft}from"./avatar-BBpLsxTY.js";import{T as mt,p as Yt,ah as Vt,ae as Ot,ai as Gt,h as Xt}from"./icons-BNA5wz6Z.js";import"./react-MKCYUrdX.js";const is=()=>{const{id:X,slotId:ft}=Wt(),[ut,Ue]=w.useState(X),W=ft||null,ue=Bt(),{toast:ae}=Pt(),{user:c,userProfile:h,refreshUserProfile:We}=qt(),[n,ht]=w.useState(null),[A,ke]=w.useState([]),[o,Be]=w.useState(null),[he,xe]=w.useState(!0),[Ae,pe]=w.useState(""),[He,ge]=w.useState(!1),[xt,pt]=w.useState(!1),[Y,be]=w.useState(null),[Fe,gt]=w.useState(!1),[Ye,Me]=w.useState(null),[bt,Re]=w.useState(0),[V,wt]=w.useState([]),[Le,Ve]=w.useState(!1),vt={hidden:{opacity:0,y:12,scale:.97},show:s=>({opacity:1,y:0,scale:1,transition:{duration:.25,delay:s*.04,ease:[.25,.46,.45,.94]}})};w.useEffect(()=>{let s=!1;return(async()=>{if(W&&!X)try{const{data:i}=await D.from("quiz_slots_view").select("quiz_id").eq("id",W).maybeSingle();!s&&(i!=null&&i.quiz_id)&&Ue(i.quiz_id)}catch(i){}else s||Ue(X)})(),()=>{s=!0}},[W,X]);const v=ut,Oe=w.useRef(0),Z=w.useCallback(async()=>{var i;const s=Oe.current+=1,a=()=>Oe.current!==s;if(!ct||!D||!v){if(!v&&(W||X))return;pe("Results are unavailable right now."),xe(!1);return}try{a()||pe("");const[t,T]=await Promise.all([D.from("quizzes").select("*").eq("id",v).single(),D.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle()]);if(t.error)throw t.error;const r=t.data;a()||ht(r||null);let g=Array.isArray((i=T.data)==null?void 0:i.leaderboard)?T.data.leaderboard:[];if(r!=null&&r.end_time){const N=new Date(r.end_time).getTime()-Date.now();a()||be(N>0?N:0)}const x=Array.isArray(g)?g.map((b,N)=>{var M;return{...b,rank:(M=b.rank)!=null?M:N+1}}):[];a()||(ke(x),xe(!1));try{const b=r!=null&&r.end_time?new Date(r.end_time).getTime():null,N=typeof b=="number"&&b<=Date.now();a()||ge(N&&x.length===0)}catch(b){a()||ge(!1)}const y=x.find(b=>(b.user_id||b.userId)===(c==null?void 0:c.id));a()||Be(y||null);const j=c!=null&&c.id?D.from("quiz_participants").select("id").eq("user_id",c.id).or(W?`slot_id.eq.${W},quiz_id.eq.${v}`:`quiz_id.eq.${v}`).limit(1).maybeSingle():Promise.resolve({data:null}),P=(async()=>{try{return W?await D.from("quiz_slots_view").select("*").eq("id",W).maybeSingle():await D.rpc("get_engagement_counts",{p_quiz_id:v})}catch(b){return{data:null}}})();g.length===0&&(r!=null&&r.end_time)&&new Date(r.end_time).getTime()<=Date.now()&&It(D,v,{throttleMs:0}).then(async N=>{if(!N||a())return;const{data:M}=await D.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle();if(a())return;const $=Array.isArray(M==null?void 0:M.leaderboard)?M.leaderboard:[];$.length&&(ke($.map((S,_)=>{var z;return{...S,rank:(z=S.rank)!=null?z:_+1}})),ge(!1))}).catch(()=>{}),Promise.all([j,P]).then(([b,N])=>{var z,B,J,Pe,ye,je,Ne,I,q;if(a())return;const M=!!b.data;pt(M);try{const d=Array.isArray(N.data)?N.data[0]:N.data;if(W){const U=Number((J=(B=(z=d==null?void 0:d.participants_joined)!=null?z:d==null?void 0:d.joined_count)!=null?B:d==null?void 0:d.joined)!=null?J:0),Q=Number((je=(ye=(Pe=d==null?void 0:d.participants_pre)!=null?Pe:d==null?void 0:d.pre_joined_count)!=null?ye:d==null?void 0:d.pre_joined)!=null?je:0),H=Number((Ne=d==null?void 0:d.participants_total)!=null?Ne:U+Q);Re(Number.isFinite(H)?H:0)}else{const U=Number((I=d==null?void 0:d.joined)!=null?I:0),Q=Number((q=d==null?void 0:d.pre_joined)!=null?q:0);Re(U+Q)}}catch(d){Re(0)}const S=((r==null?void 0:r.category)||"").toLowerCase()!=="opinion"&&(M||x.length),_=x.slice(0,10).map(d=>d.user_id).filter(Boolean);Promise.all([S?D.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",v).order("id"):Promise.resolve({data:[]}),_.length?D.rpc("profiles_public_by_ids",{p_ids:_}):Promise.resolve({data:[]})]).then(async([d,U])=>{if(!a()){try{if(S&&Array.isArray(d.data)&&d.data.length){let Q=new Map;if(c!=null&&c.id){const R=d.data.map(C=>C.id),{data:L}=await D.from("user_answers").select("question_id, selected_option_id").in("question_id",R).eq("user_id",c.id);if(a())return;Array.isArray(L)&&(Q=new Map(L.map(C=>[C.question_id,C.selected_option_id])))}const H=d.data.map(R=>({id:R.id,question_text:R.question_text,options:(R.options||[]).map(L=>({id:L.id,option_text:L.option_text,is_correct:!!L.is_correct,isSelected:Q.get(R.id)===L.id}))}));a()||wt(H)}}catch(Q){}try{if(Array.isArray(U.data)&&U.data.length){const Q=new Map(U.data.map(R=>[R.id,R])),H=await Ft(U.data.map(R=>R.avatar_url).filter(Boolean));a()||ke(R=>R.map(L=>{const C=Q.get(L.user_id);if(!C)return L;const re=C.avatar_url&&H.get(C.avatar_url)||"";return{...L,profiles:{username:C.username,full_name:C.full_name,avatar_url:re}}}))}}catch(Q){}}}).catch(()=>{})}).catch(()=>{})}catch(t){Ut.error("Error fetching results:",t),ge(!1),pe((t==null?void 0:t.message)||"Failed to load results."),xe(!1)}},[v,X,W,c==null?void 0:c.id]);w.useEffect(()=>{v&&Z()},[Z,v]);const Ge=()=>{xe(!0),pe(""),Z()},ne=(n==null?void 0:n.prize_type)||"coins",we=o!=null&&o.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[o.rank-1]?n.prizes[o.rank-1]:0,yt=Te(ne,we,{fallback:0});w.useEffect(()=>{try{if(!(c!=null&&c.id)||!Array.isArray(n==null?void 0:n.prizes)||!(o!=null&&o.rank))return;(n.prizes[o.rank-1]||0)>0&&We(c)}catch(s){}},[c,o==null?void 0:o.rank,n==null?void 0:n.prizes,We]);const ve=w.useCallback(async()=>{try{const i=document.createElement("canvas");i.width=1080,i.height=1920;const t=i.getContext("2d");t.textBaseline="top";const T="Inter, system-ui, -apple-system, Segoe UI, Roboto",r=(l,m)=>{t.font=`${l} ${m}px ${T}`},g=l=>t.measureText(l).width,x=(l,m,f,p,u)=>{let k=p;for(r(f,k);k>u&&g(l)>m;)k-=2,r(f,k);return k},y=(l,m,f,p)=>{r(f,p);const u=String(l).split(/\s+/),k=[];let E="";for(const te of u){const Ce=E?E+" "+te:te;g(Ce)<=m?E=Ce:(E&&k.push(E),E=te)}return E&&k.push(E),k},j=(l,m,f,p,u,k,E,te,Ce)=>{let G=k,ce=y(l,p,u,G);for(;(ce.length>te||ce.some(se=>g(se)>p))&&G>E;)G-=1,ce=y(l,p,u,G);r(u,G),t.fillStyle=Ce;const lt=Math.round(G*1.25),ot=Math.min(te,ce.length);for(let se=0;se<ot;se++){const dt=ce[se],Rt=g(dt);t.fillText(dt,m-Rt/2,f+se*lt)}return{height:ot*lt,size:G}},P=(l,m)=>{let f=String(l);for(;f&&g(f)>m;)f=f.slice(0,-1);return f.length<String(l).length?f.slice(0,Math.max(0,f.length-1))+"â€¦":f},b=(l,m=1e4)=>new Promise((f,p)=>{const u=new Image;u.crossOrigin="anonymous";const k=setTimeout(()=>{u.onload=null,u.onerror=null,p(new Error("Image load timeout"))},m);u.onload=()=>{clearTimeout(k),f(u)},u.onerror=E=>{clearTimeout(k),p(E)},u.src=l}),N=(l,m,f,p,u)=>{t.beginPath(),t.moveTo(l+u,m),t.lineTo(l+f-u,m),t.quadraticCurveTo(l+f,m,l+f,m+u),t.lineTo(l+f,m+p-u),t.quadraticCurveTo(l+f,m+p,l+f-u,m+p),t.lineTo(l+u,m+p),t.quadraticCurveTo(l,m+p,l,m+p-u),t.lineTo(l,m+u),t.quadraticCurveTo(l,m,l+u,m),t.closePath()},M=t.createLinearGradient(0,0,1080,1920);M.addColorStop(0,"#150a36"),M.addColorStop(1,"#0f0926"),t.fillStyle=M,t.fillRect(0,0,1080,1920);const $=64,S=1080/2;let _=$+12;const z=140,B=_+z;t.save(),t.beginPath(),t.arc(S,B,z,0,Math.PI*2),t.closePath();const J=t.createLinearGradient(S-z,B-z,S+z,B+z);J.addColorStop(0,"#1cc5ff"),J.addColorStop(1,"#ef47ff"),t.fillStyle=J,t.fill();try{const m="".trim()||"/android-chrome-192x192.png";let f;try{f=await b(m)}catch(k){f=await b("/android-chrome-192x192.png")}const p=16,u=z*2-p;t.save(),t.beginPath(),t.arc(S,B,z-p/2,0,Math.PI*2),t.clip(),t.drawImage(f,Math.round(S-u/2),Math.round(B-u/2),Math.round(u),Math.round(u)),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.7)",t.beginPath(),t.arc(S,B,z-p/2,0,Math.PI*2),t.stroke()}catch(l){}t.restore(),_=B+z+18;const ye=`ðŸ… ${((h==null?void 0:h.full_name)||(h==null?void 0:h.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,je=j(ye,S,_,1080-$*2,"900",56,34,2,"#ffd54a");_+=je.height+16;const Ne=j("âœ¨ Brains = Fame âœ¨",S,_,1080-$*2,"700",36,22,1,"rgba(255,255,255,0.9)");_+=Ne.height+28;const I=$,q=1080-$*2,d=I+56,U=48,Q=40,H=o!=null&&o.rank?`#${o.rank} Rank!`:"Results Live!",L=`ðŸ‘‘ Prize: ${Te(ne,we,{fallback:0}).formatted}`,C=typeof(o==null?void 0:o.score)=="number"?`â˜‘ï¸ Score: ${o.score}`:"",re=x(H,q-100,"900",112,80),qe=x(L,q-100,"900",48,32),De=C?x(C,q-100,"900",44,28):0,zt=Math.round(re*1)+24+Math.round(qe*1.15)+12+(C?Math.round(De*1.15)+12:0),Xe=U+zt+Q,ie=_,Qe=t.createLinearGradient(I,ie,I+q,ie);Qe.addColorStop(0,"rgba(34,211,238,0.9)"),Qe.addColorStop(1,"rgba(236,72,153,0.9)"),t.save(),N(I,ie,q,Xe,36),t.fillStyle="rgba(15,23,42,0.72)",t.fill(),t.lineWidth=4,t.strokeStyle=Qe,t.stroke(),t.restore();let K=ie+U;r("900",re),t.fillStyle="#ffffff",t.fillText(H,d,K),K+=Math.round(re*1)+24,r("900",qe),t.fillStyle="#ffd54a",t.fillText(L,d,K),K+=Math.round(qe*1.15)+12,C&&(r("900",De),t.fillStyle="rgba(168,255,230,0.95)",t.fillText(C,d,K),K+=Math.round(De*1.15)+12),_=ie+Xe+28;const Ze=230,Je=Math.max(120,1920-$-Ze-_),Ee="âš¡ My Result is Live!",$e=x(Ee,q-120,"900",48,26),Ct="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",_e=26,Ke=Math.round(_e*1.25);r("700",_e);const et=y(Ct,q-120,"700",_e).slice(0,2),Tt=et.length*Ke;let Se=28+Math.round($e)+12+Tt+28;Se>Je&&(Se=Je);const ze=_;N(I,ze,q,Se,28),t.fillStyle="rgba(8,11,30,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(56,189,248,0.5)",t.stroke(),r("900",$e),t.fillStyle="#facc15";const kt=g(Ee);t.fillText(Ee,S-kt/2,ze+28),r("700",_e),t.fillStyle="rgba(226,232,240,0.92)";let tt=ze+28+Math.round($e)+12;for(const l of et){const m=g(l);t.fillText(l,S-m/2,tt),tt+=Ke}_=ze+Se+24;const F=_,le=Math.max(Ze,Math.min(280,1920-$-F));N(I,F,q,le,24),t.fillStyle="rgba(12,10,36,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(79,70,229,0.45)",t.stroke();const At=h!=null&&h.referral_code?h.referral_code:c!=null&&c.id?c.id.replace(/-/g,"").slice(0,8).toUpperCase():"",oe=Dt(At),Mt=`${"https://www.quizdangal.com".replace(/\/$/,"")}/?ref=${encodeURIComponent(oe)}`;if(oe)try{const l=Qt();(!l||l!==oe)&&Et(oe)}catch(l){}const de=Math.min(220,le-72),st=de+32,at=de+40,Ie=I+q-st-36,nt=F+Math.max(24,Math.round((le-at)/2));N(Ie,nt,st,at,18),t.fillStyle="#ffffff",t.fill();try{const{default:l}=await Lt(async()=>{const{default:f}=await import("./browser-AiupN7X5.js").then(p=>p.b);return{default:f}},__vite__mapDeps([0,1])),m=document.createElement("canvas");await l.toCanvas(m,Mt,{width:de,margin:1,color:{dark:"#000000",light:"#ffffff"}}),t.drawImage(m,Ie+16,nt+16,de,de)}catch(l){}const O=I+36,ee=Ie-24-O;t.fillStyle="rgba(255,255,255,0.96)",r("900",48),t.fillText(P("ðŸ§  Play & Win",ee),O,F+36),t.fillStyle="rgba(203,213,225,0.98)",r("800",36),t.fillText(P("ðŸŒ www.quizdangal.com",ee),O,F+36+54),r("900",44),t.fillStyle="rgba(255,255,255,0.96)";const rt="ðŸ”— Referral: ",it=g(rt);return t.fillText(P(rt,ee),O,F+36+54+62),t.fillStyle="rgba(0,255,198,1)",t.fillText(P(oe,Math.max(0,ee-it-8)),O+it,F+36+54+62),r("700",26),t.fillStyle="rgba(226,232,240,0.92)",t.fillText(P("Your turn to flex your brain ðŸ’¯",ee),O,F+le-80),r("700",24),t.fillStyle="rgba(203,213,225,0.92)",t.fillText(P("#QuizDangal  #ChallengeAccepted  #PlayToWin",ee),O,F+le-44),await new Promise(l=>i.toBlob(l,"image/jpeg",.92))}catch(s){try{const a=document.createElement("canvas");a.width=8,a.height=8;const i=a.getContext("2d"),t=i.createLinearGradient(0,0,8,8);return t.addColorStop(0,"#130531"),t.addColorStop(1,"#1e0b4b"),i.fillStyle=t,i.fillRect(0,0,8,8),await new Promise(r=>a.toBlob(r,"image/jpeg",.9))}catch(a){return null}}},[c==null?void 0:c.id,h==null?void 0:h.full_name,h==null?void 0:h.username,h==null?void 0:h.referral_code,o==null?void 0:o.rank,o==null?void 0:o.score,ne,we]);w.useEffect(()=>{let s=!1;return(async()=>{try{if(A.length===0){Me(null);return}const i=await ve();s||Me(i)}catch(i){s||Me(null)}})(),()=>{s=!0}},[A.length,ve,v,o==null?void 0:o.rank,o==null?void 0:o.score,h==null?void 0:h.full_name,h==null?void 0:h.username,c==null?void 0:c.id,h==null?void 0:h.referral_code,we]),w.useEffect(()=>{if(!(n!=null&&n.end_time)||A.length>0){be(null);return}const s=new Date(n.end_time).getTime(),a=()=>{const t=s-Date.now();t>0?be(t):(be(0),Fe||(gt(!0),Z()))};a();const i=setInterval(a,1e3);return()=>clearInterval(i)},[n==null?void 0:n.end_time,A.length,Fe,Z]);const jt=(()=>{var s;try{const i=(s=(typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{}).VITE_ENABLE_REALTIME)!=null?s:"1",t=String(i).toLowerCase();return t==="1"||t==="true"||t==="yes"}catch(a){return!1}})(),Nt=(()=>{try{if(!jt||!ct||!D||!v||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();$t({enabled:A.length===0&&Nt,channelName:`quiz-results-${v}`,table:"quiz_results",filter:`quiz_id=eq.${v}`,onChange:Z,joinTimeoutMs:5e3});const _t=async()=>{try{let s=Ye;if(s||(s=await ve()),s&&navigator.canShare&&window.File){const a=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[a]})){await navigator.share({files:[a],title:"Quiz Dangal Result"}),ae({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="quiz-dangal-result.jpg",i.rel="noopener",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(a),1500),ae({title:"Poster saved",description:"Share the image from your gallery."});return}ae({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){ae({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},St=async()=>{try{let s=Ye;if(s||(s=await ve()),s&&navigator.canShare&&window.File){const y=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[y]})){await navigator.share({files:[y],title:"Quiz Dangal Result"});return}}if(s)try{const y=URL.createObjectURL(s),j=document.createElement("a");j.href=y,j.download="quiz-dangal-result.jpg",j.rel="noopener",document.body.appendChild(j),j.click(),document.body.removeChild(j),setTimeout(()=>URL.revokeObjectURL(y),1500)}catch(y){}const a=navigator.userAgent||"",i=/Android/i.test(a),t=/iPhone|iPad|iPod/i.test(a),T="whatsapp://send",r="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",g="https://wa.me/",x=y=>{const j=window.open(y,"_blank","noopener,noreferrer");return j&&(j.opener=null),!!j};if(i){if(x(T))return;window.location.href=r,setTimeout(()=>{document.hidden||(window.location.href=g)},700);return}if(t){window.location.href=T,setTimeout(()=>{document.hidden||(window.location.href=g)},700);return}x(g)}catch(s){ae({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};if(he)return e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24",children:[e.jsx(me,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-slate-700/60 via-slate-600/50 to-slate-700/60 animate-pulse",children:e.jsx("div",{className:"rounded-xl bg-slate-900/95 p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 w-24 bg-slate-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-40 bg-slate-800 rounded"})]}),e.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-700"})]})})}),e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-slate-700/50 via-slate-600/40 to-slate-700/50 animate-pulse",children:e.jsx("div",{className:"rounded-xl bg-slate-900/95 p-3",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-14 bg-slate-800 rounded-lg"},s))})})}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3 animate-pulse",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-700 rounded mb-3"}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-slate-800/50",children:[e.jsx("div",{className:"w-7 h-7 rounded-md bg-slate-700"}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-700"}),e.jsx("div",{className:"flex-1 h-3 bg-slate-700 rounded"}),e.jsx("div",{className:"w-10 h-3 bg-slate-700 rounded"})]},s))})]})]})]});if(!he&&Ae)return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Error | Quiz Dangal",description:Ae||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),e.jsx("p",{className:"text-slate-300 mb-4",children:Ae}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(fe,{variant:"brand",onClick:Ge,children:"Retry"}),e.jsx(fe,{variant:"white",onClick:()=>ue("/my-quizzes/"),children:"Back"})]})]})]});if(!he&&(Y!=null?Y:0)>0&&A.length===0){const s=g=>{const x=Math.max(0,Math.floor(g/1e3)),y=Math.floor(x/86400),j=Math.floor(x%86400/3600),P=Math.floor(x%3600/60),b=x%60;return{days:y,hours:j,minutes:P,seconds:b}},{days:a,hours:i,minutes:t,seconds:T}=s(Y),r=(g,x)=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:g.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:x})]});return e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Results will be published soon."}),e.jsx("p",{className:"text-slate-300 mb-4",children:"Quiz ends in"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a>0&&r(a,"Days"),r(i,"Hours"),r(t,"Minutes"),r(T,"Seconds")]}),(n==null?void 0:n.end_time)&&e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Expected publish time: ",new Date(n.end_time).toLocaleString()]}),e.jsx(fe,{variant:"brand",className:"w-full",onClick:()=>ue("/"),children:"Back to Home"})]})]})}return!he&&(Y!=null?Y:0)===0&&A.length===0&&(He||n!=null&&n.end_time)?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(me,{title:"Results â€“ Finalizing | Quiz Dangal",description:"Finalizing quiz results.",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"Finalizing resultsâ€¦"}),e.jsx("p",{className:"text-slate-300 mb-4",children:He?"Please wait a moment.":"Results are being prepared."}),e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-b"})}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(fe,{variant:"brand",onClick:Ge,children:"Refresh"}),e.jsx(fe,{variant:"white",onClick:()=>ue("/my-quizzes/"),children:"Back"})]})]})]}):e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(me,{title:`${n!=null&&n.title?`${n.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:A.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(mt,{className:"w-5 h-5 text-amber-400"}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:n==null?void 0:n.title}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[e.jsx(Yt,{className:"w-3 h-3"}),e.jsxs("span",{children:[bt||(A==null?void 0:A.length)||0," participants"]})]})]}),(o==null?void 0:o.rank)&&e.jsxs("div",{className:"shrink-0 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:e.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",o.rank]})}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(n==null?void 0:n.prizes)&&n.prizes.length>0&&e.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:n.prizes.slice(0,5).map((s,a)=>{const i=Te(ne,s,{fallback:0}),t=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":`#${a+1}`;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("span",{children:i.formatted})]},a)})})]})}),c&&(o||xt)&&e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold text-white",children:o?"Your Result":"You Participated"}),o&&e.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",A.length]})]}),((V==null?void 0:V.length)||0)>0&&e.jsxs("button",{type:"button",onClick:()=>Ve(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${Le?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":Le,children:[e.jsx(Vt,{className:"w-3 h-3"}),"Q&A"]})]}),o?e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),e.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",o.rank]})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),e.jsx("p",{className:"text-base font-bold text-emerald-400",children:o.score})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),e.jsx("p",{className:"text-base font-bold text-purple-400",children:yt.formatted})]})]}):e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),Le&&((V==null?void 0:V.length)||0)>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[e.jsx(Ot,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),e.jsx("button",{type:"button",onClick:()=>Ve(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),e.jsx("div",{className:"space-y-2",children:V.map((s,a)=>e.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[e.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[e.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",a+1,"."]}),s.question_text]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(i=>{const t=!!i.is_correct,T=!!i.isSelected,r=t?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":T?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return e.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${r}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsx("span",{children:"âœ“"}),T&&!t&&e.jsx("span",{children:"âœ—"}),e.jsx("span",{className:"truncate",children:i.option_text})]})},i.id)})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[e.jsx(mt,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),e.jsxs("div",{className:"space-y-1.5",children:[A.length===0&&e.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),A.map((s,a)=>{var x,y,j,P,b;const i=s.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[s.rank-1]?n.prizes[s.rank-1]:0,t=Te(ne,i,{fallback:0}),T=s.user_id===(c==null?void 0:c.id),r=a<3,g=a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":null;return e.jsxs(Ht.div,{custom:a,variants:vt,initial:"hidden",animate:"show",whileHover:{scale:1.01,transition:{duration:.15}},className:`flex items-center justify-between gap-2 p-2 rounded-lg border transition-colors duration-200 ${T?"bg-indigo-950/40 border-indigo-600/40":r?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${r?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:g||`#${s.rank||a+1}`}),e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(x=s.profiles)!=null&&x.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:"Player avatar",className:"w-full h-full object-cover",width:24,height:24,loading:"lazy",decoding:"async"}):e.jsx("span",{children:(((y=s.profiles)==null?void 0:y.full_name)||((j=s.profiles)==null?void 0:j.username)||"U").charAt(0).toUpperCase()})}),e.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((P=s.profiles)==null?void 0:P.username)||((b=s.profiles)==null?void 0:b.full_name)||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),e.jsx("div",{className:"text-right min-w-[50px]",children:e.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:t.formatted})})]})]},`${s.id}-${a}`)})]})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:e.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ue("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Back"]}),e.jsxs("button",{type:"button",onClick:St,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),e.jsxs("button",{type:"button",onClick:_t,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[e.jsx(Xt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{is as default};
