import{j as e,w as Be,e as me,u as De,s as b,l as Ne,S as Ce,h as Te,B as q,x as ue}from"./index-Bvf66Ja4.js";import{R as M,r as v,h as Ie,L as $e}from"./router-D53U3OCX.js";import{AnimatePresence as ke,m as de}from"./motion-lite-CITOPWQs.js";import{L as Z,I as G}from"./label-CAWr3Tsz.js";import{L as H,ad as je,ae as Me,m as Re,v as Ee,af as Le,ag as Pe}from"./icons-r1jlw6dZ.js";import"./supabase-BMIB7Fuo.js";import"./react-DQQtrPfG.js";const _e=M.forwardRef(({className:o,...g},z)=>e.jsx("textarea",{ref:z,className:Be("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",o),...g}));_e.displayName="Textarea";const ae=["opinion","gk","sports","movies"],Fe=[121,71,51],Se=5,Ue=10,F=144,ye=10;function Ze(){const o=[];let g=0,z=0;for(;g<24;)o.push(String(g).padStart(2,"0")+":"+String(z).padStart(2,"0")),z+=Ue,z>=60&&(g++,z=z-60);return o}const ne={opinion:{bg:"bg-pink-600/20",border:"border-pink-500",text:"text-pink-400",badge:"bg-pink-600"},gk:{bg:"bg-emerald-600/20",border:"border-emerald-500",text:"text-emerald-400",badge:"bg-emerald-600"},sports:{bg:"bg-blue-600/20",border:"border-blue-500",text:"text-blue-400",badge:"bg-blue-600"},movies:{bg:"bg-amber-600/20",border:"border-amber-500",text:"text-amber-400",badge:"bg-amber-600"}},we=({category:o,className:g="w-4 h-4"})=>({opinion:e.jsx("svg",{className:g,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),gk:e.jsx("svg",{className:g,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),sports:e.jsx("svg",{className:g,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),movies:e.jsx("svg",{className:g,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})})[o]||null;function Ve(){var te;const{toast:o}=me(),{userProfile:g}=De(),z=String((g==null?void 0:g.role)||"").toLowerCase()==="admin",[T,E]=v.useState(!1),[O,R]=v.useState(null),[D,Q]=v.useState(!1),[_,$]=v.useState("gk"),[I,S]=v.useState(()=>new Date().toISOString().slice(0,10)),[x,j]=v.useState(""),[u,w]=v.useState(!1),[y,n]=v.useState([]),[l,A]=v.useState(null),U=v.useMemo(()=>new Date().toISOString().slice(0,10),[]),W=v.useMemo(()=>{const i=new Date;return i.setDate(i.getDate()+2),i.toISOString().slice(0,10)},[]),Y=v.useCallback(async()=>{E(!0);try{const{data:i,error:a}=await b.rpc("get_scheduler_status");if(!a&&i){R(i);return}Ne.warn("get_scheduler_status RPC failed, using fallback:",a==null?void 0:a.message);const{data:m}=await b.from("category_runtime_overrides").select("category, is_auto").in("category",ae),{data:h}=await b.from("quiz_slots").select("category, status, target_date").gte("target_date",new Date().toISOString().slice(0,10)),f=new Date().toISOString().slice(0,10),C=ae.map(t=>{var d;const s=m==null?void 0:m.find(r=>r.category===t),c=(h==null?void 0:h.filter(r=>{var p;return r.category===t&&((p=r.target_date)==null?void 0:p.slice(0,10))===f}))||[];return{category:t,is_auto:(d=s==null?void 0:s.is_auto)!=null?d:!0,today:{total:c.length,active:c.filter(r=>r.status==="active").length,finished:c.filter(r=>r.status==="finished").length,scheduled:c.filter(r=>r.status==="scheduled").length,skipped:c.filter(r=>r.status==="skipped").length}}});R({ok:!0,today:f,current_time:new Date().toISOString(),categories:C})}catch(i){Ne.error("loadStatus error:",i),R({ok:!1,today:new Date().toISOString().slice(0,10),current_time:new Date().toISOString(),categories:ae.map(a=>({category:a,is_auto:!0,today:{total:0,active:0,finished:0,scheduled:0,skipped:0}}))})}finally{E(!1)}},[]);v.useEffect(()=>{Y();const i=setInterval(Y,3e4);return()=>clearInterval(i)},[Y]);const le=async(i,a)=>{if(z)try{const{error:m}=await b.rpc("toggle_category_auto",{p_category:i,p_enabled:!a});if(m)throw m;o({title:a?"â¸ï¸ Paused":"â–¶ï¸ Resumed",description:`${i} quiz scheduling ${a?"paused":"enabled"}.`}),Y()}catch(m){o({title:"Toggle failed",description:m==null?void 0:m.message,variant:"destructive"})}},ce=v.useCallback(()=>Array.from({length:F}).map((i,a)=>({index:a+1,title:"",questions:Array.from({length:ye}).map(()=>({question_text:"",options:Array.from({length:4}).map(()=>({option_text:"",is_correct:!1}))}))})),[]),xe=(i="gk")=>{$(i),S(U),j(""),n(ce()),A(null),Q(!0)},J=v.useCallback(i=>{var C,t;const a=[],m=[],h=String(i||"").trim();if(!h)return{slots:a,errors:m};if(h.startsWith("[")||h.startsWith("{"))try{const s=JSON.parse(h),c=Array.isArray(s)?s:[s];for(const d of c){const r=d.title||"Untitled",N=(Array.isArray(d.questions)?d.questions:[]).slice(0,10).map(k=>({question_text:k.question_text||k.text||"",options:(k.options||[]).slice(0,4).map((B,P)=>({option_text:B.option_text||B.text||String(B).trim(),is_correct:_==="opinion"?!1:!!(B.is_correct||B.correct||k.correctIndex===P)}))}));a.push({title:r,questions:N})}return{slots:a,errors:m}}catch(s){return m.push("JSON parse failed: "+s.message),{slots:a,errors:m}}const f=h.split(/\n(?=Category:|Title:)/i);for(const s of f){const c=s.split(/\r?\n/).map(k=>k.trim()).filter(Boolean);if(!c.length)continue;let d="Untitled";const r=[];let p=null;for(const k of c){if(/^Category:/i.test(k))continue;if(/^Title:/i.test(k)){d=k.split(/:/).slice(1).join(":").trim();continue}if(/^Prizes?:/i.test(k))continue;const B=k.match(/^Q\d+\.\s*(.+)$/i);if(B){p&&r.push(p),p={question_text:B[1].trim(),options:[],correctIndex:-1};continue}const P=k.match(/^(?:[-*â€¢]|[A-D]\)|[A-D][.:])\s*(.+)$/);if(P&&p){p.options.push({option_text:P[1].trim(),is_correct:!1});continue}const se=k.match(/^Ans(wer)?[:\s]+(.+)$/i);if(se&&p){const ie=(t=(C=se[2].trim().match(/^[A-D]/i))==null?void 0:C[0])==null?void 0:t.toUpperCase();ie&&(p.correctIndex={A:0,B:1,C:2,D:3}[ie])}}p&&r.push(p);const N=r.slice(0,10).map(k=>({question_text:k.question_text,options:k.options.slice(0,4).map((B,P)=>({option_text:B.option_text,is_correct:_==="opinion"?!1:k.correctIndex===P}))}));N.length>0&&a.push({title:d,questions:N})}return{slots:a,errors:m}},[_]),ze=()=>{const{slots:i,errors:a}=J(x);if(a.length){o({title:"Parse errors",description:a[0],variant:"destructive"});return}if(i.length===0){o({title:"No quizzes found",description:"Could not parse any quizzes from the text.",variant:"destructive"});return}if(i.length!==F){o({title:"Quiz count mismatch",description:`Found ${i.length} quizzes, need exactly ${F}.`,variant:"destructive"});return}const m=i.map((h,f)=>{const C={index:f+1,title:h.title||`Quiz ${f+1}`,questions:h.questions.slice(0,ye).map(t=>({question_text:t.question_text||"",options:t.options.slice(0,4).map(s=>({option_text:s.option_text||"",is_correct:_==="opinion"?!1:!!s.is_correct}))}))};for(;C.questions.length<ye;)C.questions.push({question_text:"",options:Array.from({length:4}).map(()=>({option_text:"",is_correct:!1}))});for(const t of C.questions)for(;t.options.length<4;)t.options.push({option_text:"",is_correct:!1});return C});n(m),o({title:"âœ… Form populated",description:`${i.length} quizzes loaded into form.`})},L=(i,a)=>{n(m=>m.map((h,f)=>f===i?{...h,title:a}:h))},K=(i,a,m)=>{n(h=>h.map((f,C)=>{if(C!==i)return f;const t=f.questions.map((s,c)=>c===a?{...s,question_text:m}:s);return{...f,questions:t}}))},he=(i,a,m,h)=>{n(f=>f.map((C,t)=>{if(t!==i)return C;const s=C.questions.map((c,d)=>{if(d!==a)return c;const r=c.options.map((p,N)=>N===m?{...p,option_text:h}:p);return{...c,options:r}});return{...C,questions:s}}))},ge=(i,a,m)=>{_!=="opinion"&&n(h=>h.map((f,C)=>{if(C!==i)return f;const t=f.questions.map((s,c)=>{if(c!==a)return s;const d=s.options.map((r,p)=>({...r,is_correct:p===m}));return{...s,options:d}});return{...f,questions:t}}))},fe=async()=>{if(z){w(!0);try{if(y.length!==F)throw new Error(`Need exactly ${F} quizzes, found ${y.length}`);for(const f of y){if(!f.title.trim())throw new Error(`Quiz #${f.index}: Title is empty`);for(let C=0;C<f.questions.length;C++){const t=f.questions[C];if(!t.question_text.trim())throw new Error(`Quiz #${f.index}, Q${C+1}: Question is empty`);for(let s=0;s<t.options.length;s++)if(!t.options[s].option_text.trim())throw new Error(`Quiz #${f.index}, Q${C+1}, Option ${s+1}: Option is empty`);if(_!=="opinion"&&!t.options.some(s=>s.is_correct))throw new Error(`Quiz #${f.index}, Q${C+1}: No correct answer selected`)}}const i=Ze(),a=y.map((f,C)=>({time:i[C],title:f.title.trim(),prizes:Fe,questions:f.questions.map(t=>({question_text:t.question_text.trim(),options:t.options.map(s=>({option_text:s.option_text.trim(),is_correct:_==="opinion"?!1:s.is_correct}))}))})),m={target_date:I,categories:{[_]:a}},{error:h}=await b.rpc("admin_seed_quiz_day_multi",{p_payload:m});if(h)throw h;o({title:"ðŸŽ‰ Deployed!",description:`${F} quizzes deployed for ${_} on ${I}.`}),Q(!1),Y()}catch(i){o({title:"Deploy failed",description:i==null?void 0:i.message,variant:"destructive"})}finally{w(!1)}}},X=v.useCallback(i=>{if(!i.title.trim())return{valid:!1,error:"No title"};for(let a=0;a<i.questions.length;a++){const m=i.questions[a];if(!m.question_text.trim())return{valid:!1,error:`Q${a+1} empty`};for(let h=0;h<m.options.length;h++)if(!m.options[h].option_text.trim())return{valid:!1,error:`Q${a+1} opt ${h+1} empty`};if(_!=="opinion"&&!m.options.some(h=>h.is_correct))return{valid:!1,error:`Q${a+1} no answer`}}return{valid:!0}},[_]),ee=v.useMemo(()=>y.filter(i=>X(i).valid).length,[y,X]);return e.jsxs("div",{className:"relative min-h-[600px] rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900"}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiM2MzY2ZjEiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyek0zNiAyNHYySDI0di0yaDEyeiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-indigo-600/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-80 h-80 bg-purple-600/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Quiz Scheduler"]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[F," quizzes/day Ã— 4 categories â€¢ 00:00 - 23:50 IST (24hr) â€¢ ",Se," min quiz + ",Se," min gap"]})]}),T&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),"Loading..."]})]}),O&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-300",children:"Today's Status"}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[O.today," â€¢ ",new Date(O.current_time).toLocaleTimeString("en-IN",{timeZone:"Asia/Kolkata"})," IST"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:(te=O.categories)==null?void 0:te.map(i=>{const a=ne[i.category]||ne.gk,m=i.today.total>0?(i.today.finished/i.today.total*100).toFixed(0):0;return e.jsxs("div",{className:`rounded-lg border ${a.border} ${a.bg} p-3`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(we,{category:i.category,className:`w-4 h-4 ${a.text}`}),e.jsx("span",{className:`text-xs font-semibold uppercase ${a.text}`,children:i.category})]}),e.jsx("button",{onClick:()=>le(i.category,i.is_auto),disabled:!z,className:`px-2 py-0.5 rounded text-[10px] font-medium transition-all ${i.is_auto?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-rose-600/80 text-white hover:bg-rose-600"} disabled:opacity-50`,children:i.is_auto?"â–¶ ON":"â¸ OFF"})]}),i.today.total>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500",style:{width:`${m}%`}})}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400",children:[e.jsxs("span",{children:["âœ“ ",i.today.finished,"/",i.today.total]}),e.jsx("span",{className:"text-emerald-400",children:i.today.active>0?`â— Live: ${i.today.active}`:""})]})]}):e.jsx("div",{className:"text-[10px] text-slate-500 mt-1",children:"No quizzes deployed"})]},i.category)})})]}),z&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/30 to-purple-900/20 rounded-xl border border-indigo-600/30 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-indigo-300 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Bulk Deploy Quizzes"]}),e.jsxs("p",{className:"text-[11px] text-slate-400 mb-4",children:["Deploy ",F," quizzes for any category. You can deploy up to 3 days in advance."]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map(i=>{const a=ne[i];return e.jsxs("button",{onClick:()=>xe(i),className:`flex items-center gap-2 px-4 py-2 rounded-lg border ${a.border} ${a.bg} hover:opacity-90 transition-all`,children:[e.jsx(we,{category:i,className:`w-4 h-4 ${a.text}`}),e.jsx("span",{className:`text-sm font-medium ${a.text} capitalize`,children:i})]},i)})})]}),D&&e.jsx("div",{className:"fixed inset-0 z-[200] flex items-start justify-center bg-black/70 backdrop-blur-sm overflow-y-auto p-4",children:e.jsxs("div",{className:"w-full max-w-4xl my-8 bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl",children:[e.jsx("div",{className:`p-4 rounded-t-2xl border-b border-slate-700 ${ne[_].bg}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{category:_,className:`w-6 h-6 ${ne[_].text}`}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:["Bulk Deploy - ",_.toUpperCase()]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[F," quizzes Ã— 10 questions Ã— 4 options"]})]})]}),e.jsx("button",{onClick:()=>Q(!1),className:"p-2 rounded-lg hover:bg-slate-700/50 text-slate-400 hover:text-white transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bulk-category-select",className:"block text-[10px] text-slate-500 mb-1",children:"CATEGORY"}),e.jsx("select",{id:"bulk-category-select",value:_,onChange:i=>$(i.target.value),className:"bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm text-slate-200",children:ae.map(i=>e.jsx("option",{value:i,children:i.toUpperCase()},i))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bulk-date-input",className:"block text-[10px] text-slate-500 mb-1",children:"DATE (Max 3 days)"}),e.jsx("input",{id:"bulk-date-input",type:"date",value:I,min:U,max:W,onChange:i=>S(i.target.value),className:"bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm text-slate-200"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:"VALID QUIZZES"}),e.jsxs("div",{className:`text-2xl font-bold ${ee===F?"text-emerald-400":"text-amber-400"}`,children:[ee,"/",F]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300",children:"Paste Quiz Data"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const i=_==="opinion"?`Quiz 1
Title: Quiz Title Here
Q1. Question text here?
A) Option A
B) Option B
C) Option C
D) Option D

Q2. Second question?
A) Option A
B) Option B
C) Option C
D) Option D

Q3. Third question?
A) Option A
B) Option B
C) Option C
D) Option D

Q4. Fourth question?
A) Option A
B) Option B
C) Option C
D) Option D

Q5. Fifth question?
A) Option A
B) Option B
C) Option C
D) Option D

Q6. Sixth question?
A) Option A
B) Option B
C) Option C
D) Option D

Q7. Seventh question?
A) Option A
B) Option B
C) Option C
D) Option D

Q8. Eighth question?
A) Option A
B) Option B
C) Option C
D) Option D

Q9. Ninth question?
A) Option A
B) Option B
C) Option C
D) Option D

Q10. Tenth question?
A) Option A
B) Option B
C) Option C
D) Option D

Quiz 2
Title: Next Quiz Title
...`:`Quiz 1
Title: Quiz Title Here
Q1. Question text here?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: A

Q2. Second question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: B

Q3. Third question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: C

Q4. Fourth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: D

Q5. Fifth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: A

Q6. Sixth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: B

Q7. Seventh question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: C

Q8. Eighth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: D

Q9. Ninth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: A

Q10. Tenth question?
A) Option A
B) Option B
C) Option C
D) Option D
Answer: B

Quiz 2
Title: Next Quiz Title
...`;navigator.clipboard.writeText(i),o({title:"ðŸ“‹ Format Copied!",description:"Paste in Notepad, fill data, then paste here."})},className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-emerald-600 text-white hover:bg-emerald-700 transition",children:"ðŸ“‹ Copy Format"}),e.jsx("button",{onClick:ze,disabled:!x.trim(),className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-40 transition",children:"Fill Form â†’"}),e.jsx("button",{onClick:()=>j(""),className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 transition",children:"Clear"})]})]}),e.jsx("textarea",{value:x,onChange:i=>j(i.target.value),className:"w-full h-28 rounded-lg border border-slate-600 bg-slate-900 text-slate-200 text-xs p-3 font-mono resize-none",placeholder:_==="opinion"?`Paste ${F} quiz blocks (No Answer needed for Opinion):

Quiz 1
Title: Aaj Ka Sawaal
Q1. Aapko kaunsa color pasand hai?
A) Red  B) Blue  C) Green  D) Yellow
...10 questions...

Quiz 2
Title: Evening Poll
...`:`Paste ${F} quiz blocks:

Quiz 1
Title: GK Morning Quiz
Q1. Bharat ki rajdhani?
A) Mumbai  B) Delhi  C) Kolkata  D) Chennai
Answer: B
...10 questions with answers...

Quiz 2
Title: Sports Quiz
...`})]}),e.jsxs("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto pr-2",children:[e.jsx("div",{className:"sticky top-0 bg-slate-900 py-2 z-10",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-300",children:"Quiz Editor"})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2",children:y.map((i,a)=>{const m=X(i),h=l===a;return e.jsxs("button",{onClick:()=>A(h?null:a),className:`p-2 rounded-lg border text-left transition-all ${m.valid?"border-emerald-600/50 bg-emerald-900/20 hover:bg-emerald-900/30":"border-slate-600 bg-slate-800/50 hover:bg-slate-800"} ${h?"ring-2 ring-indigo-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-[10px] font-medium text-slate-400",children:["#",i.index]}),m.valid?e.jsx("svg",{className:"w-3 h-3 text-emerald-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-3 h-3 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})]}),e.jsx("div",{className:"text-[9px] text-slate-300 truncate",children:i.title||"Untitled"})]},a)})}),l!==null&&y[l]&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl border border-indigo-600/50 bg-indigo-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-indigo-300",children:["Quiz #",l+1]}),e.jsx("button",{onClick:()=>A(null),className:"text-xs text-slate-400 hover:text-white",children:"Close"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expanded-quiz-title",className:"block text-[10px] text-slate-500 mb-1",children:"TITLE"}),e.jsx("input",{id:"expanded-quiz-title",value:y[l].title,onChange:i=>L(l,i.target.value),placeholder:"Enter quiz title...",className:"w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-600 text-sm text-slate-200"})]}),y[l].questions.map((i,a)=>e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800/50 border border-slate-700",children:[e.jsxs("span",{className:"block text-[10px] text-slate-500 mb-1",children:["Q",a+1]}),e.jsx("input",{value:i.question_text,onChange:m=>K(l,a,m.target.value),placeholder:`Question ${a+1}...`,className:"w-full px-2 py-1.5 rounded border border-slate-600 bg-slate-900 text-xs text-slate-200 mb-2"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.options.map((m,h)=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded border border-slate-600 bg-slate-900/50",children:[_!=="opinion"&&e.jsx("input",{type:"radio",name:`q-${l}-${a}`,checked:m.is_correct,onChange:()=>ge(l,a,h),className:"w-3 h-3"}),e.jsx("input",{value:m.option_text,onChange:f=>he(l,a,h,f.target.value),placeholder:`Option ${h+1}`,className:"flex-1 bg-transparent outline-none text-xs text-slate-200"})]},h))})]},a))]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:_==="opinion"&&e.jsx("span",{className:"text-pink-400",children:"âš  Opinion: No correct answers needed"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{n(ce()),A(null)},className:"px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 text-slate-300 hover:bg-slate-600 transition",children:"Reset All"}),e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 rounded-lg text-sm font-medium bg-slate-600 text-slate-200 hover:bg-slate-500 transition",children:"Cancel"}),e.jsx("button",{onClick:fe,disabled:u||ee!==F,className:"px-6 py-2 rounded-lg text-sm font-semibold bg-gradient-to-r from-emerald-600 to-emerald-500 text-white hover:from-emerald-500 hover:to-emerald-400 disabled:opacity-40 disabled:cursor-not-allowed transition-all",children:u?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Deploying..."]}):`ðŸš€ Deploy ${F} Quizzes`})]})]})]})})]})]})}const Oe=[{value:"opinion",label:"Opinion"},{value:"gk",label:"General Knowledge"},{value:"sports",label:"Sports"},{value:"movies",label:"Movies"}],Ae=o=>{var g;return((g=Oe.find(z=>z.value===o))==null?void 0:g.label)||o},oe=()=>({text:"",options:["","",""],correctIndex:0});function pe(o,g,{fallback:z=0}={}){return g==null&&(g=z),o==="coins"?`${g} coins`:o==="others"?`${g}`:`â‚¹${g}`}function We(o,{allowZeroCorrect:g=!1}={}){var D,Q;const z=String(o||"").trim().split(/\n\s*\n+/),T=[],E=[],O=[];let R=0;for(const _ of z){const $=_.split(/\r?\n/).map(u=>u.trim()).filter(Boolean);if(!$.length)continue;R+=1;const I=$[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:-]\s*/i,""),S=[];let x="";for(let u=1;u<$.length;u++){const w=$[u];if(/^ans(wer)?\s*[:-]/i.test(w)){x=w;continue}const y=w.match(/^[-*â€¢]?\s*\[(x|X| )\]\s*(.+)$/);if(y){S.push({option_text:y[2].trim(),is_correct:/x/i.test(y[1])});continue}const n=w.match(/^(?:[-*â€¢]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/),l=n?n[1].trim():w.replace(/^[*]\s*/,"").trim();l&&S.push({option_text:l,is_correct:/^\*/.test(w)})}if(x){const u=x.split(/[:-]/).slice(1).join(":").trim(),w=(Q=(D=u.match(/^[A-D]/i))==null?void 0:D[0])==null?void 0:Q.toUpperCase(),y=w?{A:0,B:1,C:2,D:3}[w]:NaN,n=parseInt(u,10);if(!Number.isNaN(y)&&S[y])S.forEach((l,A)=>l.is_correct=A===y);else if(!Number.isNaN(n)&&S[n-1])S.forEach((l,A)=>l.is_correct=A===n-1);else{const l=u.toLowerCase(),A=S.findIndex(U=>U.option_text.toLowerCase()===l||U.option_text.toLowerCase().includes(l));A>=0&&S.forEach((U,W)=>U.is_correct=W===A)}}let j=S.filter(u=>u.option_text);if(j.length>4){const u=j.findIndex(w=>w.is_correct);if(u>=0){const w=j[u],y=j.filter((n,l)=>l!==u);j=[w,...y.slice(0,3)]}else j=j.slice(0,4);O.push(`Q${R}: Trimmed to 4 options.`)}if(!I){E.push(`Q${R}: Missing question text.`);continue}if(j.length<2){E.push(`Q${R}: Need at least 2 options.`);continue}if(g)j=j.map(u=>({...u,is_correct:!1}));else{const u=j.filter(w=>w.is_correct).length;if(u===0)j[0].is_correct=!0;else if(u>1){let w=!1;j=j.map(y=>y.is_correct&&!w?(w=!0,y):{...y,is_correct:!1})}}T.push({question_text:I,options:j})}return{items:T,errors:E,warnings:O}}function it(){const{toast:o}=me(),{userProfile:g,loading:z}=De(),[T,E]=Ie(),O=T.get("tab")||"overview",R=t=>{T.set("tab",t),E(T,{replace:!0})},[D,Q]=v.useState([]),[_,$]=v.useState(!1),[I,S]=v.useState(!1),[x,j]=v.useState({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),[u,w]=v.useState("form"),[y,n]=v.useState([oe()]),[l,A]=v.useState(null),[U,W]=v.useState([]),[Y,le]=v.useState(null),[ce,xe]=v.useState(!1),J=x.category==="opinion",L=String((g==null?void 0:g.role)||"").trim().toLowerCase()==="admin",K=v.useCallback(async()=>{if(!L){$(!1),Q([]);return}if($(!0),!b){Q([]),$(!1);return}const{data:t,error:s}=await b.from("quizzes").select("id,title,category,prizes,prize_pool,prize_type,start_time,end_time").order("start_time",{ascending:!1});s?o({title:"Fetch failed",description:s.message,variant:"destructive"}):Q(t||[]),$(!1)},[o,L]),he=v.useCallback(async t=>{if(!L){W([]);return}if(!b){W([]);return}const{data:s,error:c}=await b.from("questions").select("id,question_text,options(id,option_text,is_correct)").eq("quiz_id",t);c?o({title:"Questions failed",description:c.message,variant:"destructive"}):W(s||[])},[o,L]);v.useEffect(()=>{z||K()},[K,z]);const ge=async t=>{t.preventDefault();try{if(!L){o({title:"Access denied",description:"Only admins can create quizzes.",variant:"destructive"});return}const s=[];x.category||s.push("Select category"),x.title.trim()||s.push("Title required"),(!x.start_time||!x.end_time)&&s.push("Start & End time required");const c=new Date(x.start_time);new Date(x.end_time)<=c&&s.push("End after start");const r=parseInt(x.prizes[0]||"",10);if((Number.isNaN(r)||r<=0)&&s.push("1st prize invalid"),s.length){o({title:"Fix form",description:s[0],variant:"destructive"});return}const p=y.map(V=>{const re=(V.options||[]).map(ve=>ve.trim()).filter(Boolean).slice(0,4);if(!V.text.trim()||re.length<2)return null;const Qe=Math.min(Math.max(V.correctIndex||0,0),re.length-1);return{question_text:V.text.trim(),options:re.map((ve,qe)=>({option_text:ve,is_correct:J?!1:qe===Qe}))}}).filter(Boolean);if(!p.length){o({title:"Add questions",variant:"destructive"});return}const N=x.prizes.filter(V=>V).map(V=>parseInt(V,10)),k=N.reduce((V,re)=>V+re,0),B=x.prize_type==="money"&&k>0?"coins":x.prize_type,P={title:x.title.trim(),category:x.category,start_time:new Date(x.start_time).toISOString(),end_time:new Date(x.end_time).toISOString(),prizes:N,prize_pool:k,prize_type:B};if(!b)throw new Error("Supabase config missing");const{data:se,error:be}=await b.from("quizzes").insert([P]).select().single();if(be)throw be;o({title:"Quiz created",description:se.title});const ie=await fe(se.id,p,"replace");ie.ok?o({title:"Questions added",description:`${p.length} questions`}):o({title:"Question insert fallback",description:ie.message||"Failed",variant:"destructive"}),S(!1),j({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),n([oe()]),K()}catch(s){o({title:"Create failed",description:s.message,variant:"destructive"})}},fe=async(t,s,c="append")=>{var d;if(!L)return{ok:!1,message:"Admin access required"};if(!b)return{ok:!1,message:"No Supabase client"};try{const{data:r}=await b.auth.getSession(),p=(d=r==null?void 0:r.session)==null?void 0:d.access_token,N="https://gcheopiqayyptfxowulv.supabase.co",k=N?`${N}/functions/v1/admin-upsert-questions`:"/functions/v1/admin-upsert-questions",B=await fetch(k,{method:"POST",headers:{"Content-Type":"application/json",...p?{Authorization:`Bearer ${p}`}:{}},body:JSON.stringify({quizId:t,items:s,mode:c})});if(B.ok)return{ok:!0};if(B.status!==404){const P=await B.json().catch(()=>({}));throw new Error((P==null?void 0:P.error)||`HTTP ${B.status}`)}}catch(r){}try{const{error:r}=await b.rpc("admin_bulk_upsert_questions",{p_quiz_id:t,p_payload:s,p_mode:c});if(!r)return{ok:!0};Ne.warn("admin_bulk_upsert_questions RPC returned error, using manual inserts",r==null?void 0:r.message)}catch(r){}c==="replace"&&await b.from("questions").delete().eq("quiz_id",t);for(const r of s){const{data:p,error:N}=await b.from("questions").insert({quiz_id:t,question_text:r.question_text}).select("id").single();if(N)return{ok:!1,message:N.message};const k=r.options.map(P=>({question_id:p.id,option_text:P.option_text,is_correct:!!P.is_correct})),{error:B}=await b.from("options").insert(k);if(B)return{ok:!1,message:B.message}}return{ok:!0}},X=async t=>{if(!window.confirm("Delete this quiz?"))return;if(!L){o({title:"Access denied",description:"Only admins can delete quizzes.",variant:"destructive"});return}if(!b)return;const{error:s}=await b.from("quizzes").delete().eq("id",t);s?o({title:"Delete failed",description:s.message,variant:"destructive"}):(o({title:"Deleted"}),K())},ee=async t=>{if(!L){o({title:"Access denied",description:"Only admins can recompute results.",variant:"destructive"});return}if(b)try{le(t);const{error:s}=await b.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;try{await b.rpc("compute_results_if_due",{p_quiz_id:t})}catch(c){}o({title:"Recomputed"})}catch(s){o({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{le(null)}},te=v.useMemo(()=>{const t=Date.now(),s=[],c=[];for(const d of D){const r=d.end_time?new Date(d.end_time).getTime():null;r!==null&&t>r?c.push(d):s.push(d)}return c.sort((d,r)=>{const p=d.end_time?new Date(d.end_time).getTime():0;return(r.end_time?new Date(r.end_time).getTime():0)-p}),{active:s,finished:c.slice(0,10)}},[D]),[i,a]=v.useState([]),[m,h]=v.useState(!1),f=v.useCallback(async()=>{if(!L){a([]);return}if(!b){a([]);return}h(!0);try{const{data:t,error:s}=await b.from("redemptions").select("id,user_id,reward_value,reward_type,coins_required,payout_identifier,payout_channel,requested_at, profiles(username,full_name)").eq("status","pending").order("requested_at",{ascending:!1});if(s)throw s;a(t||[])}catch(t){a([])}finally{h(!1)}},[L]),C=v.useCallback(async t=>{if(L&&b){a(s=>s.filter(c=>c.id!==t));try{const{error:s}=await b.rpc("admin_approve_redemption",{p_redemption_id:t});if(s)throw s;o({title:"Approved",description:"Redemption approved."})}catch(s){o({title:"Approve failed",description:s.message,variant:"destructive"}),f()}}},[L,f,o]);return v.useEffect(()=>{f();const t=setInterval(f,3e4);return()=>clearInterval(t)},[f]),z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):L?e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl bg-white text-gray-900 rounded-2xl shadow-sm",children:[e.jsx(Ce,{title:"Admin Dashboard â€“ Quiz Dangal",description:"Quiz Dangal admin panel for managing quizzes, rewards, and notifications.",canonical:"https://quizdangal.com/admin/",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Admin Dashboard"}),!Te&&e.jsx("div",{className:"mb-6 text-sm text-amber-600",children:"Supabase env keys missing. Read-only UI only."}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["overview","rewards","approvals","notifications","scheduler"].map(t=>e.jsx("button",{onClick:()=>R(t),className:`px-3 py-1.5 rounded border text-sm transition-colors ${t===O?"bg-indigo-600 text-white border-indigo-600":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}`,children:t},t))}),O==="scheduler"&&e.jsx("div",{className:"mb-10",children:e.jsx(Ve,{})}),O==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsxs(q,{onClick:()=>S(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"New Quiz"]})}),e.jsx(ke,{children:I&&e.jsxs(de.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Create Quiz"}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Z,{className:"mb-1 block",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Oe.map(({value:t,label:s})=>e.jsx("button",{type:"button",onClick:()=>j(c=>({...c,category:t})),className:`px-3 py-1 rounded-full text-xs border ${x.category===t?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},t))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quiz-title",children:"Title"}),e.jsx(G,{id:"quiz-title",value:x.title,onChange:t=>j(s=>({...s,title:t.target.value})),placeholder:"Daily Quiz",required:!0})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"Prize Type"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["money","coins","others"].map(t=>e.jsx("button",{type:"button",onClick:()=>j(s=>({...s,prize_type:t})),className:`px-2 py-1 rounded text-xs border ${x.prize_type===t?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},t))})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-2",children:x.prizes.map((t,s)=>e.jsx(G,{value:t,placeholder:`${s+1}${["st","nd","rd"][s]||"th"} Prize`,onChange:c=>j(d=>{const r=[...d.prizes];return r[s]=c.target.value,{...d,prizes:r}})},s))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quiz-start-time",children:"Start Time"}),e.jsx(G,{id:"quiz-start-time",type:"datetime-local",value:x.start_time,onChange:t=>j(s=>({...s,start_time:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quiz-end-time",children:"End Time"}),e.jsx(G,{id:"quiz-end-time",type:"datetime-local",value:x.end_time,onChange:t=>j(s=>({...s,end_time:t.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"Questions Mode"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["form","paste"].map(t=>e.jsx("button",{type:"button",onClick:()=>w(t),className:`px-3 py-1 rounded text-xs border ${u===t?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},t))})]}),u==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:J?"Opinion: no correct option stored.":"Mark one correct option with radio."}),y.map((t,s)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["Q",s+1]}),e.jsx(G,{value:t.text,onChange:c=>n(d=>{const r=[...d];return r[s]={...r[s],text:c.target.value},r}),placeholder:"Question text",className:"flex-1"}),e.jsx(q,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-500",onClick:()=>n(c=>c.length===1?[oe()]:c.filter((d,r)=>r!==s)),children:"Del"})]}),(t.options||[]).slice(0,4).map((c,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!J&&e.jsx("input",{type:"radio",name:`q-${s}`,checked:(t.correctIndex||0)===d,onChange:()=>n(r=>{const p=[...r];return p[s]={...p[s],correctIndex:d},p})}),e.jsx(G,{value:c,onChange:r=>n(p=>{const N=[...p],k=[...N[s].options];return k[d]=r.target.value,N[s]={...N[s],options:k},N}),placeholder:`Option ${d+1}`,className:"flex-1"}),(t.options||[]).length>2&&e.jsx(q,{type:"button",size:"sm",variant:"outline",className:"border-red-300 text-red-500",onClick:()=>n(r=>{const p=[...r],N=[...p[s].options];return N.splice(d,1),p[s]={...p[s],options:N},p}),children:"X"})]},d)),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(q,{type:"button",size:"sm",disabled:(t.options||[]).length>=4,onClick:()=>n(c=>{const d=[...c],r=[...d[s].options];return r.length<4&&r.push(""),d[s]={...d[s],options:r},d}),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Option"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Max 4 options"})]})]},s)),e.jsxs(q,{type:"button",onClick:()=>n(t=>[...t,oe()]),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Question"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Paste Questions"}),e.jsx(_e,{className:"h-40",value:x.bulk,onChange:t=>j(s=>({...s,bulk:t.target.value})),placeholder:`Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. ...`}),(()=>{const{items:t,errors:s,warnings:c}=We(x.bulk,{allowZeroCorrect:J});return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[t.length," parsed"]}),c[0]&&e.jsx("div",{className:"text-amber-500",children:c[0]}),s[0]&&e.jsx("div",{className:"text-red-500",children:s[0]}),e.jsx(q,{type:"button",size:"sm",disabled:!!s.length||!t.length,onClick:()=>{if(s.length||!t.length)return;const d=t.map(r=>({text:r.question_text,options:r.options.map(p=>p.option_text),correctIndex:J?0:r.options.findIndex(p=>p.is_correct)>=0?r.options.findIndex(p=>p.is_correct):0}));n(d.length?d:[oe()]),w("form"),o({title:"Loaded",description:`${d.length} questions moved to form.`})},children:"Load into form"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create"}),e.jsx(q,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancel"})]})]})]})}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-3",children:[e.jsx(Me,{className:"w-5 h-5"}),"All Quizzes"]}),_?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(H,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4",children:te.active.map(t=>{const s=t.prize_type||"money",c=pe(s,t.prize_pool,{fallback:0}),d=Array.isArray(t.prizes)?t.prizes.map(r=>pe(s,r,{fallback:0})).join(", "):"";return e.jsxs(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[240px]",children:[e.jsx("h4",{className:"font-semibold",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",Ae(t.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",s]}),e.jsxs("span",{children:["Pool: ",c]}),e.jsxs("span",{children:["Prizes: ",d]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Start: ",t.start_time?ue(t.start_time):"â€”"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?ue(t.end_time):"â€”"]})]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(q,{size:"sm",variant:"outline",onClick:()=>ee(t.id),disabled:Y===t.id,children:Y===t.id?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-1 animate-spin"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),"Recompute"]})}),e.jsxs($e,{to:`/results/${t.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-100 text-indigo-600",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Results"]}),e.jsxs(q,{size:"sm",variant:"outline",onClick:()=>{A(t),he(t.id),xe(!0)},className:"text-blue-400",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),"Questions"]}),e.jsx(q,{size:"sm",variant:"outline",onClick:()=>X(t.id),className:"text-red-500",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]}),e.jsx(ke,{children:ce&&(l==null?void 0:l.id)===t.id&&e.jsxs(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:["Questions for ",t.title]}),U.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No questions."}),U.map((r,p)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Q",p+1,": ",r.question_text]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(r.options||[]).map(N=>e.jsxs("div",{className:`px-2 py-0.5 text-xs rounded-full ${N.is_correct?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:[N.option_text,N.is_correct&&e.jsx("span",{className:"ml-1",children:"âœ“"})]},N.id))})]},r.id))]})})]},t.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Finished"}),e.jsx("div",{className:"space-y-4",children:te.finished.map(t=>{const s=t.prize_type||"money",c=pe(s,t.prize_pool,{fallback:0}),d=Array.isArray(t.prizes)?t.prizes.map(r=>pe(s,r,{fallback:0})).join(", "):"";return e.jsxs(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold",children:t.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",Ae(t.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",s]}),e.jsxs("span",{children:["Pool: ",c]}),e.jsxs("span",{children:["Prizes: ",d]})]})]},t.id)})})]})]})]})]}),O==="approvals"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Redemptions"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Approve user reward payouts after verifying their UPI ID / phone number."}),m&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(H,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading pending requests..."]}),!m&&i.length===0&&e.jsx("div",{className:"py-6 text-center text-gray-500 border border-gray-200 rounded-xl bg-gray-50",children:"No pending redemptions."}),i.length>0&&e.jsx("div",{className:"space-y-4",children:i.map(t=>{var s;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-yellow-500 flex items-center justify-center text-white font-semibold shadow",children:e.jsx("span",{className:"text-sm",children:"â‚¹"})}),(()=>{var p,N;const c=t.reward_value,d=c&&String(c).trim().length?c:`${t.reward_type||""}`.trim()||"Reward",r=((p=t.profiles)==null?void 0:p.username)||((N=t.profiles)==null?void 0:N.full_name)||"Anonymous";return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:d}),e.jsxs("div",{className:"text-[11px] text-gray-600",children:["@",r]})]})})()]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["Type: ",t.reward_type||"â€”"]}),e.jsxs("span",{children:["Coins: ",(s=t.coins_required)!=null?s:0]}),e.jsxs("span",{children:["Requested: ",t.requested_at?ue(t.requested_at):"â€”"]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Payout:"," ",t.payout_identifier?`${t.payout_identifier} (${t.payout_channel||"upi"})`:"â€”"]})]}),e.jsx("div",{className:"flex items-center gap-2 self-start md:self-center",children:e.jsx(q,{size:"sm",onClick:()=>C(t.id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Approve"})})]},t.id)})})]}),O==="notifications"&&e.jsx(He,{}),O==="rewards"&&e.jsx(Ge,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"Admin Access Required â€“ Quiz Dangal",description:"Admin panel access requires appropriate permissions.",canonical:"https://quizdangal.com/admin/",robots:"noindex, nofollow",author:"Quiz Dangal"}),e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 max-w-md w-full text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-500 mb-2",children:"Admin access required"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Supabase "}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" table mein aapke record ka "}),e.jsx("strong",{children:"role"}),e.jsx("span",{children:" field admin hona chahiye."})]}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 mt-4 space-y-2 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Supabase dashboard"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("span",{children:"Table editor"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:"Â me role update karein."})]}),e.jsx("li",{children:"Update ke baad login session refresh karein."}),e.jsxs("li",{children:["Dev bypass (",e.jsx("code",{children:"VITE_BYPASS_AUTH=1"}),") mein mock admin auto-enable hota hai."]})]})]})})]})}function Ge(){const{toast:o}=me(),[g,z]=M.useState([]),[T,E]=M.useState(!1),[O,R]=M.useState(!1),[D,Q]=M.useState({reward_type:"coins",reward_value:"",coins_required:"",is_active:!0}),[_,$]=M.useState(!1),[I,S]=M.useState(null),x=M.useCallback(async()=>{if(!b)return;E(!0);const{data:n,error:l}=await b.from("reward_catalog").select("id,reward_type,reward_value,coins_required,is_active").order("id",{ascending:!1}).limit(200);l?o({title:"Rewards load failed",description:l.message,variant:"destructive"}):z(n||[]),E(!1)},[o]);M.useEffect(()=>{x()},[x]);const j=()=>Q({reward_type:"cash",reward_value:"",coins_required:"",is_active:!0}),u=async n=>{if(n.preventDefault(),!!b){$(!0);try{const l={reward_type:String(D.reward_type||"").trim()||"cash",reward_value:String(D.reward_value||"").trim(),coins_required:D.coins_required!==""&&D.coins_required!==null?parseInt(D.coins_required,10):null,is_active:!!D.is_active};if(!l.reward_value)throw new Error("Value required");if(l.coins_required===null||Number.isNaN(l.coins_required))throw new Error("Coins required");let A;if(I?A=await b.from("reward_catalog").update(l).eq("id",I).select().single():A=await b.from("reward_catalog").insert([l]).select().single(),A.error)throw A.error;o({title:I?"Reward updated":"Reward created"}),j(),R(!1),S(null),x()}catch(l){o({title:"Save failed",description:l.message,variant:"destructive"})}finally{$(!1)}}},w=async n=>{if(!b)return;const{error:l}=await b.from("reward_catalog").update({is_active:!n.is_active}).eq("id",n.id);l?o({title:"Toggle failed",description:l.message,variant:"destructive"}):(o({title:n.is_active?"Deactivated":"Activated"}),x())},y=n=>{var l;S(n.id),R(!0),Q({reward_type:n.reward_type||"cash",reward_value:n.reward_value||"",coins_required:((l=n.coins_required)!=null?l:"").toString(),is_active:!!n.is_active})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Redemptions auto-approved hain. Neeche sirf Rewards Catalog manage karna hai."}),e.jsxs("div",{className:"pt-10 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rewards Catalog"}),e.jsx(q,{size:"sm",onClick:()=>{R(n=>!n),O||(j(),S(null))},children:O?"Close":"New Reward"}),e.jsx(q,{size:"sm",variant:"outline",onClick:x,disabled:T,children:T?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),O&&e.jsxs("form",{onSubmit:u,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"Type"}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:["cash","voucher"].map(n=>e.jsx("button",{type:"button",onClick:()=>Q(l=>({...l,reward_type:n})),className:`px-2 py-1 rounded text-xs border ${D.reward_type===n?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:n==="cash"?"ðŸ’µ Cash (UPI/Phone)":"ðŸŽŸï¸ Voucher (WhatsApp)"},n))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:D.reward_type==="cash"?"User will provide UPI ID or Phone number":"User will provide WhatsApp number"})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"Value"}),e.jsx(G,{value:D.reward_value,onChange:n=>Q(l=>({...l,reward_value:n.target.value})),placeholder:"e.g. 100 / AMAZON100 / â‚¹100"})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"Coins Required"}),e.jsx(G,{type:"number",value:D.coins_required,onChange:n=>Q(l=>({...l,coins_required:n.target.value})),placeholder:"coins needed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:!!D.is_active,onChange:n=>Q(l=>({...l,is_active:n.target.checked}))}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{type:"submit",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving"]}):I?"Update":"Create"}),e.jsx(q,{type:"button",variant:"outline",onClick:()=>{j(),S(null)},children:I?"Cancel Edit":"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Value"}),e.jsx("th",{className:"p-2 text-left",children:"Coins Required"}),e.jsx("th",{className:"p-2 text-left",children:"Active"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[g.map(n=>{var l;return e.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"p-2 capitalize",children:n.reward_type}),e.jsx("td",{className:"p-2 max-w-[260px] truncate",title:n.reward_value,children:n.reward_value}),e.jsx("td",{className:"p-2",children:(l=n.coins_required)!=null?l:"â€”"}),e.jsx("td",{className:"p-2",children:n.is_active?e.jsx("span",{className:"text-green-500",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(q,{size:"sm",variant:"outline",onClick:()=>y(n),children:"Edit"}),e.jsx(q,{size:"sm",variant:"outline",onClick:()=>w(n),children:n.is_active?"Deactivate":"Activate"})]})})]},n.id)}),!g.length&&!T&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-gray-500",children:"No rewards."})}),T&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:[e.jsx(H,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading rewards..."]})})]})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Catalog: inactive rewards are hidden from users."})]})]})}function He(){const{toast:o}=me(),[g,z]=M.useState(""),[T,E]=M.useState(""),[O,R]=M.useState("all"),[D,Q]=M.useState(!1),[_,$]=M.useState([]),[I,S]=M.useState(!1),x=M.useCallback(async()=>{if(!b)return;S(!0);const{data:u,error:w}=await b.from("notifications").select("id,title,message,type,segment,created_at").order("created_at",{ascending:!1}).limit(100);w?o({title:"Fetch failed",description:w.message,variant:"destructive"}):$(u||[]),S(!1)},[o]);M.useEffect(()=>{x()},[x]);const j=async u=>{var w;if(u.preventDefault(),!g.trim()||!T.trim()){o({title:"Missing fields",variant:"destructive"});return}if(!b){o({title:"No backend client",variant:"destructive"});return}Q(!0);try{const y={title:g.trim(),message:T.trim(),segment:O},{data:n}=await b.auth.getSession(),l=(w=n==null?void 0:n.session)==null?void 0:w.access_token,{data:A,error:U}=await b.functions.invoke("send-notifications",{body:y,headers:l?{Authorization:`Bearer ${l}`}:void 0});if(U)throw new Error(U.message||U.error||"Failed to send notification");const W=typeof A=="object"&&(A!=null&&A.message)?A.message:g.trim();o({title:"Sent",description:W}),z(""),E(""),x()}catch(y){o({title:"Send failed",description:y.message,variant:"destructive"})}finally{Q(!1)}};return e.jsxs("div",{className:"space-y-8 max-w-3xl",children:[e.jsxs("form",{onSubmit:j,className:"space-y-4 bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Send Notification"}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"notification-title",children:"Title"}),e.jsx(G,{id:"notification-title",name:"notificationTitle",value:g,onChange:u=>z(u.target.value),maxLength:80,placeholder:"Short title"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 80 chars â€¢ ",g.length,"/80"]})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"notification-message",children:"Message"}),e.jsx(_e,{id:"notification-message",name:"notificationMessage",value:T,onChange:u=>E(u.target.value),className:"h-28",maxLength:280,placeholder:"Body shown in push notification"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 280 chars â€¢ ",T.length,"/280"]})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"Segment"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["all"].map(u=>e.jsx("button",{type:"button",onClick:()=>R(u),className:`px-3 py-1 rounded text-xs border ${O===u?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:u},u))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{type:"submit",disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending"]}):"Send"}),e.jsx(q,{type:"button",variant:"outline",onClick:()=>{z(""),E("")},children:"Reset"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Recent Notifications"}),e.jsx(q,{size:"sm",variant:"outline",onClick:x,disabled:I,children:I?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[_.map(u=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:u.title}),e.jsx("div",{className:"text-xs text-gray-600 whitespace-pre-wrap max-w-xl break-words",children:u.message})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:ue(u.created_at)})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Segment: ",u.segment||"â€”",u.type?` â€¢ ${u.type}`:""]})]},u.id)),!_.length&&!I&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notifications yet."})]})]})]})}export{it as default};
