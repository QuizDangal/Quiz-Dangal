import{_ as St}from"./supabase-07ebd5d8.js";import{a as Ct,u as zt,h as Ze,s as k,b as Tt,c as At,g as oe,n as kt,r as Mt,i as Lt,d as Rt,j as e,B as Je,m as Et}from"./index-e5d81da9.js";import{r as C}from"./react-63c462fe.js";import{g as qt}from"./avatar-44534497.js";import{S as ce}from"./SEO-16cc2069.js";import{c as $t,b as Ut}from"./router-d6d570a4.js";import{T as Ke,c as Dt,Y as It,O as Pt,Z as Wt,d as Bt}from"./icons-1e9e0bae.js";const es=()=>{const{id:_}=$t(),Ce=Ut(),{toast:V}=Ct(),{user:o,userProfile:m,refreshUserProfile:ze}=zt(),[r,et]=C.useState(null),[T,Te]=C.useState([]),[l,tt]=C.useState(null),[de,me]=C.useState(!0),[fe,te]=C.useState(""),[st,Ae]=C.useState(!1),[Y,se]=C.useState(null),[ke,at]=C.useState(!1),[Me,ue]=C.useState(null),[nt,rt]=C.useState(0),[D,he]=C.useState([]),[pe,Le]=C.useState(!1),Re=(m==null?void 0:m.role)==="admin",it={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}},W=C.useCallback(async()=>{var s,n;if(!Ze||!k){te("Results are unavailable right now."),me(!1);return}try{te("");const{data:a,error:t}=await k.from("quizzes").select("*").eq("id",_).single();if(t)throw t;et(a||null);let h=!1;if(o!=null&&o.id)try{const{data:p}=await k.from("quiz_participants").select("id, status").eq("quiz_id",_).eq("user_id",o.id).maybeSingle();if(p)h=!0;else{const{data:c}=await k.from("questions").select("id").eq("quiz_id",_).limit(1);if(c!=null&&c.length){const{data:j}=await k.from("user_answers").select("id").eq("question_id",c[0].id).eq("user_id",o.id).maybeSingle();j&&(h=!0)}}Ae(h)}catch(p){console.error("[Results] Participation check error:",p),h=!1,Ae(!1)}const f=Re||h||Tt({defaultValue:!0}),{data:w,error:A}=await k.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle();if(A)throw A;let N=Array.isArray(w==null?void 0:w.leaderboard)?w.leaderboard:[];if((!w||N.length===0)&&(a!=null&&a.end_time)){const c=new Date(a.end_time).getTime()-Date.now();if(se(c>0?c:0),c<=0&&f)try{await At(k,_,{throttleMs:200});const{data:j}=await k.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle(),z=Array.isArray(j==null?void 0:j.leaderboard)?j.leaderboard:[];z.length&&(N=z)}catch(j){}}const S=Array.isArray(N)?N.map((p,c)=>{var j;return{...p,rank:(j=p.rank)!=null?j:c+1}}):[];Te(S);try{const{data:p}=await k.rpc("get_engagement_counts",{p_quiz_id:_}),c=Array.isArray(p)?p[0]:p,j=Number((s=c==null?void 0:c.joined)!=null?s:0),z=Number((n=c==null?void 0:c.pre_joined)!=null?n:0);rt(j+z)}catch(p){}try{if(((a==null?void 0:a.category)||"").toLowerCase()!=="opinion"&&_&&(h||S.length)){const{data:c}=await k.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",_).order("id");let j=new Map;if(o!=null&&o.id&&Array.isArray(c)&&c.length){const x=c.map(v=>v.id),{data:g}=await k.from("user_answers").select("question_id, selected_option_id").in("question_id",x).eq("user_id",o.id);Array.isArray(g)&&(j=new Map(g.map(v=>[v.question_id,v.selected_option_id])))}const z=(c||[]).map(x=>({id:x.id,question_text:x.question_text,options:(x.options||[]).map(g=>({id:g.id,option_text:g.option_text,is_correct:!!g.is_correct,isSelected:j.get(x.id)===g.id}))}));he(z)}else he([])}catch(p){he([])}try{const p=S.slice(0,10).map(c=>c.user_id);if(p.length){const{data:c}=await k.rpc("profiles_public_by_ids",{p_ids:p});if(Array.isArray(c)&&c.length){const j=new Map(c.map(x=>[x.id,x])),z=await qt(c.map(x=>x.avatar_url).filter(Boolean));Te(x=>x.map(g=>{const v=j.get(g.user_id);if(!v)return g;const q=v.avatar_url&&z.get(v.avatar_url)||"";return{...g,profiles:{username:v.username,full_name:v.full_name,avatar_url:q}}}))}}}catch(p){}const M=S.find(p=>(p.user_id||p.userId)===(o==null?void 0:o.id));M&&tt(M)}catch(a){console.error("Error fetching results:",a),te((a==null?void 0:a.message)||"Failed to load results.")}finally{me(!1)}},[_,o==null?void 0:o.id,Re]);C.useEffect(()=>{W()},[W]);const lt=()=>{me(!0),te(""),W()},F=(r==null?void 0:r.prize_type)||"coins",ae=l!=null&&l.rank&&Array.isArray(r==null?void 0:r.prizes)&&r.prizes[l.rank-1]?r.prizes[l.rank-1]:0,ot=oe(F,ae,{fallback:0});C.useEffect(()=>{let s=!1;return(async()=>{try{if(T.length===0){ue(null);return}const a=await xe();s||ue(a)}catch(a){s||ue(null)}})(),()=>{s=!0}},[T.length,_,l==null?void 0:l.rank,l==null?void 0:l.score,m==null?void 0:m.full_name,m==null?void 0:m.username,o==null?void 0:o.id,m==null?void 0:m.referral_code,ae]),C.useEffect(()=>{try{if(!(o!=null&&o.id)||!Array.isArray(r==null?void 0:r.prizes)||!(l!=null&&l.rank))return;(r.prizes[l.rank-1]||0)>0&&ze(o)}catch(s){}},[o,l==null?void 0:l.rank,r==null?void 0:r.prizes,ze]);const xe=C.useCallback(async()=>{try{const a=document.createElement("canvas");a.width=1080,a.height=1920;const t=a.getContext("2d");t.textBaseline="top";const h="Inter, system-ui, -apple-system, Segoe UI, Roboto",f=(i,d)=>{t.font=`${i} ${d}px ${h}`},w=i=>t.measureText(i).width,A=(i,d,u,b,y)=>{let L=b;for(f(u,L);L>y&&w(i)>d;)L-=2,f(u,L);return L},N=(i,d,u,b)=>{f(u,b);const y=String(i).split(/\s+/),L=[];let E="";for(const H of y){const le=E?E+" "+H:H;w(le)<=d?E=le:(E&&L.push(E),E=H)}return E&&L.push(E),L},S=(i,d,u,b,y,L,E,H,le)=>{let P=L,ee=N(i,b,y,P);for(;(ee.length>H||ee.some(O=>w(O)>b))&&P>E;)P-=1,ee=N(i,b,y,P);f(y,P),t.fillStyle=le;const Fe=Math.round(P*1.25),Ge=Math.min(H,ee.length);for(let O=0;O<Ge;O++){const Xe=ee[O],_t=w(Xe);t.fillText(Xe,d-_t/2,u+O*Fe)}return{height:Ge*Fe,size:P}},M=(i,d)=>{let u=String(i);for(;u&&w(u)>d;)u=u.slice(0,-1);return u.length<String(i).length?u.slice(0,Math.max(0,u.length-1))+"â€¦":u},p=i=>new Promise((d,u)=>{const b=new Image;b.crossOrigin="anonymous",b.onload=()=>d(b),b.onerror=u,b.src=i}),c=(i,d,u,b,y)=>{t.beginPath(),t.moveTo(i+y,d),t.lineTo(i+u-y,d),t.quadraticCurveTo(i+u,d,i+u,d+y),t.lineTo(i+u,d+b-y),t.quadraticCurveTo(i+u,d+b,i+u-y,d+b),t.lineTo(i+y,d+b),t.quadraticCurveTo(i,d+b,i,d+b-y),t.lineTo(i,d+y),t.quadraticCurveTo(i,d,i+y,d),t.closePath()},j=t.createLinearGradient(0,0,1080,1920);j.addColorStop(0,"#150a36"),j.addColorStop(1,"#0f0926"),t.fillStyle=j,t.fillRect(0,0,1080,1920);const z=64,x=1080/2;let g=z+12;const v=140,q=g+v;t.save(),t.beginPath(),t.arc(x,q,v,0,Math.PI*2),t.closePath();const ge=t.createLinearGradient(x-v,q-v,x+v,q+v);ge.addColorStop(0,"#1cc5ff"),ge.addColorStop(1,"#ef47ff"),t.fillStyle=ge,t.fill();try{const d=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let u;try{u=await p(d)}catch(L){u=await p("/android-chrome-192x192.png")}const b=16,y=v*2-b;t.save(),t.beginPath(),t.arc(x,q,v-b/2,0,Math.PI*2),t.clip(),t.drawImage(u,Math.round(x-y/2),Math.round(q-y/2),Math.round(y),Math.round(y)),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.7)",t.beginPath(),t.arc(x,q,v-b/2,0,Math.PI*2),t.stroke()}catch(i){}t.restore(),g=q+v+18;const ht=`ðŸ… ${((m==null?void 0:m.full_name)||(m==null?void 0:m.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,pt=S(ht,x,g,1080-z*2,"900",56,34,2,"#ffd54a");g+=pt.height+16;const xt=S("âœ¨ Brains = Fame âœ¨",x,g,1080-z*2,"700",36,22,1,"rgba(255,255,255,0.9)");g+=xt.height+28;const U=z,R=1080-z*2,be=U+56,Ee=48,gt=40,qe=l!=null&&l.rank?`#${l.rank} Rank!`:"Results Live!",$e=`ðŸ‘‘ Prize: ${oe(F,ae,{fallback:0}).formatted}`,G=typeof(l==null?void 0:l.score)=="number"?`â˜‘ï¸ Score: ${l.score}`:"",we=A(qe,R-100,"900",112,80),ye=A($e,R-100,"900",48,32),je=G?A(G,R-100,"900",44,28):0,bt=Math.round(we*1)+24+Math.round(ye*1.15)+12+(G?Math.round(je*1.15)+12:0),Ue=Ee+bt+gt,X=g,ve=t.createLinearGradient(U,X,U+R,X);ve.addColorStop(0,"rgba(34,211,238,0.9)"),ve.addColorStop(1,"rgba(236,72,153,0.9)"),t.save(),c(U,X,R,Ue,36),t.fillStyle="rgba(15,23,42,0.72)",t.fill(),t.lineWidth=4,t.strokeStyle=ve,t.stroke(),t.restore();let B=X+Ee;f("900",we),t.fillStyle="#ffffff",t.fillText(qe,be,B),B+=Math.round(we*1)+24,f("900",ye),t.fillStyle="#ffd54a",t.fillText($e,be,B),B+=Math.round(ye*1.15)+12,G&&(f("900",je),t.fillStyle="rgba(168,255,230,0.95)",t.fillText(G,be,B),B+=Math.round(je*1.15)+12),g=X+Ue+28;const De=230,Ie=Math.max(120,1920-z-De-g),Ne="âš¡ My Result is Live!",_e=A(Ne,R-120,"900",48,26),wt="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",ne=26,Pe=Math.round(ne*1.25);f("700",ne);const We=N(wt,R-120,"700",ne).slice(0,2),yt=We.length*Pe;let re=28+Math.round(_e)+12+yt+28;re>Ie&&(re=Ie);const ie=g;c(U,ie,R,re,28),t.fillStyle="rgba(8,11,30,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(56,189,248,0.5)",t.stroke(),f("900",_e),t.fillStyle="#facc15";const jt=w(Ne);t.fillText(Ne,x-jt/2,ie+28),f("700",ne),t.fillStyle="rgba(226,232,240,0.92)";let Be=ie+28+Math.round(_e)+12;for(const i of We){const d=w(i);t.fillText(i,x-d/2,Be),Be+=Pe}g=ie+re+24;const $=g,Z=Math.max(De,Math.min(280,1920-z-$));c(U,$,R,Z,24),t.fillStyle="rgba(12,10,36,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(79,70,229,0.45)",t.stroke();const vt=m!=null&&m.referral_code?m.referral_code:o!=null&&o.id?o.id.replace(/-/g,"").slice(0,8).toUpperCase():"",J=kt(vt),Nt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(J)}`;if(J)try{const i=Mt();(!i||i!==J)&&Lt(J)}catch(i){}const K=Math.min(220,Z-72),Qe=K+32,He=K+40,Se=U+R-Qe-36,Oe=$+Math.max(24,Math.round((Z-He)/2));c(Se,Oe,Qe,He,18),t.fillStyle="#ffffff",t.fill();try{const{default:i}=await St(()=>import("./browser-864b0b18.js").then(u=>u.b),[]),d=document.createElement("canvas");await i.toCanvas(d,Nt,{width:K,margin:1,color:{dark:"#000000",light:"#ffffff"}}),t.drawImage(d,Se+16,Oe+16,K,K)}catch(i){}const I=U+36,Q=Se-24-I;t.fillStyle="rgba(255,255,255,0.96)",f("900",48),t.fillText(M("ðŸ§  Play & Win",Q),I,$+36),t.fillStyle="rgba(203,213,225,0.98)",f("800",36),t.fillText(M("ðŸŒ www.quizdangal.com",Q),I,$+36+54),f("900",44),t.fillStyle="rgba(255,255,255,0.96)";const Ve="ðŸ”— Referral: ",Ye=w(Ve);return t.fillText(M(Ve,Q),I,$+36+54+62),t.fillStyle="rgba(0,255,198,1)",t.fillText(M(J,Math.max(0,Q-Ye-8)),I+Ye,$+36+54+62),f("700",26),t.fillStyle="rgba(226,232,240,0.92)",t.fillText(M("Your turn to flex your brain ðŸ’¯",Q),I,$+Z-80),f("700",24),t.fillStyle="rgba(203,213,225,0.92)",t.fillText(M("#QuizDangal  #ChallengeAccepted  #PlayToWin",Q),I,$+Z-44),await new Promise(i=>a.toBlob(i,"image/jpeg",.92))}catch(s){try{const n=document.createElement("canvas");n.width=8,n.height=8;const a=n.getContext("2d"),t=a.createLinearGradient(0,0,8,8);return t.addColorStop(0,"#130531"),t.addColorStop(1,"#1e0b4b"),a.fillStyle=t,a.fillRect(0,0,8,8),await new Promise(f=>n.toBlob(f,"image/jpeg",.9))}catch(n){return null}}},[o==null?void 0:o.id,m==null?void 0:m.full_name,m==null?void 0:m.username,m==null?void 0:m.referral_code,l==null?void 0:l.rank,l==null?void 0:l.score,F,ae]);C.useEffect(()=>{if(!(r!=null&&r.end_time)||T.length>0){se(null);return}const s=new Date(r.end_time).getTime(),n=()=>{const t=s-Date.now();t>0?se(t):(se(0),ke||(at(!0),W()))};n();const a=setInterval(n,1e3);return()=>clearInterval(a)},[r==null?void 0:r.end_time,T.length,ke,W]);const ct=(()=>{var s,n;try{const a=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},t=(n=(s={}.VITE_ENABLE_REALTIME)!=null?s:a.VITE_ENABLE_REALTIME)!=null?n:"1",h=String(t).toLowerCase();return h==="1"||h==="true"||h==="yes"}catch(a){return!1}})(),dt=(()=>{try{if(!ct||!Ze||!k||!_||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const s=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(s&&(s.saveData||typeof s.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(s.effectiveType)))}catch(s){return!0}})();Rt({enabled:T.length===0&&dt,channelName:`quiz-results-${_}`,table:"quiz_results",filter:`quiz_id=eq.${_}`,onChange:W,joinTimeoutMs:5e3});const mt=s=>{const n=Math.max(0,Math.floor((s!=null?s:0)/1e3)),a=Math.floor(n/86400),t=Math.floor(n%86400/3600),h=Math.floor(n%3600/60),f=n%60;return{days:a,hours:t,minutes:h,seconds:f}},ft=async()=>{try{let s=Me;if(s||(s=await xe()),s&&navigator.canShare&&window.File){const n=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[n]})){await navigator.share({files:[n],title:"Quiz Dangal Result"}),V({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download="quiz-dangal-result.jpg",a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(n),1500),V({title:"Poster saved",description:"Share the image from your gallery."});return}V({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){V({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},ut=async()=>{try{let s=Me;if(s||(s=await xe()),s&&navigator.canShare&&window.File){const N=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[N]})){await navigator.share({files:[N],title:"Quiz Dangal Result"});return}}if(s)try{const N=URL.createObjectURL(s),S=document.createElement("a");S.href=N,S.download="quiz-dangal-result.jpg",S.rel="noopener",document.body.appendChild(S),S.click(),document.body.removeChild(S),setTimeout(()=>URL.revokeObjectURL(N),1500)}catch(N){}const n=navigator.userAgent||"",a=/Android/i.test(n),t=/iPhone|iPad|iPod/i.test(n),h="whatsapp://send",f="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",w="https://wa.me/",A=N=>!!window.open(N,"_blank");if(a){if(A(h))return;window.location.href=f,setTimeout(()=>{document.hidden||(window.location.href=w)},700);return}if(t){window.location.href=h,setTimeout(()=>{document.hidden||(window.location.href=w)},700);return}A(w)}catch(s){V({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};return de?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(ce,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]}):!de&&fe?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(ce,{title:"Results â€“ Error | Quiz Dangal",description:fe||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),e.jsx("p",{className:"text-slate-300 mb-4",children:fe}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(Je,{variant:"brand",onClick:lt,children:"Retry"}),e.jsx(Je,{variant:"white",onClick:()=>Ce("/my-quizzes/"),children:"Back"})]})]})]}):!de&&(Y!=null?Y:0)>0&&T.length===0?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(ce,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Results not published yet"}),r!=null&&r.end_time?e.jsx("div",{className:"mb-4",children:Y>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 mb-3",children:"Quiz ends in"}),(()=>{const{days:s,hours:n,minutes:a,seconds:t}=mt(Y),h=(f,w)=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:f.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:w})]});return e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s>0&&h(s,"Days"),h(n,"Hours"),h(a,"Minutes"),h(t,"Seconds")]})})(),e.jsxs("p",{className:"text-xs text-slate-400 mt-3",children:["End time: ",new Date(r.end_time).toLocaleString()]})]}):e.jsx("p",{className:"text-slate-300 mb-4",children:"Finalizing resultsâ€¦ please stay on this page."})}):e.jsx("p",{className:"text-slate-300 mb-4",children:"Please check back after the quiz end time."})]})]}):e.jsxs("div",{className:"min-h-screen px-3 pt-16 sm:pt-20 pb-24 relative",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(ce,{title:`${r!=null&&r.title?`${r.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:T.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-amber-500/60 via-fuchsia-500/50 to-indigo-500/60",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ke,{className:"w-5 h-5 text-amber-400"}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Results"})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:r==null?void 0:r.title}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 mt-1",children:[e.jsx(Dt,{className:"w-3 h-3"}),e.jsxs("span",{children:[nt||(T==null?void 0:T.length)||0," participants"]})]})]}),(l==null?void 0:l.rank)&&e.jsxs("div",{className:"shrink-0 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 flex items-center justify-center shadow-lg",children:e.jsxs("span",{className:"text-lg font-extrabold text-white",children:["#",l.rank]})}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"Your Rank"})]})]}),Array.isArray(r==null?void 0:r.prizes)&&r.prizes.length>0&&e.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto [-ms-overflow-style:none] [scrollbar-width:none]",children:r.prizes.slice(0,5).map((s,n)=>{const a=oe(F,s,{fallback:0}),t=n===0?"ðŸ¥‡":n===1?"ðŸ¥ˆ":n===2?"ðŸ¥‰":`#${n+1}`;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-800/80 border border-slate-700/50 text-[10px] font-medium text-slate-300 whitespace-nowrap",children:[e.jsx("span",{children:t}),e.jsx("span",{children:a.formatted})]},n)})})]})}),o&&(l||st)&&e.jsx("div",{className:"p-[1px] rounded-xl bg-gradient-to-r from-emerald-500/50 via-cyan-500/40 to-indigo-500/50",children:e.jsxs("div",{className:"rounded-xl bg-slate-900/95 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-xs font-semibold text-white",children:l?"Your Result":"You Participated"}),l&&e.jsxs("span",{className:"text-[10px] text-slate-400",children:["of ",T.length]})]}),((D==null?void 0:D.length)||0)>0&&e.jsxs("button",{type:"button",onClick:()=>Le(s=>!s),className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-semibold transition ${pe?"bg-emerald-600/20 border border-emerald-500/40 text-emerald-300":"bg-slate-800 border border-slate-700 text-slate-300 hover:bg-slate-700"}`,"aria-expanded":pe,children:[e.jsx(It,{className:"w-3 h-3"}),"Q&A"]})]}),l?e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Rank"}),e.jsxs("p",{className:"text-base font-bold text-amber-400",children:["#",l.rank]})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Score"}),e.jsx("p",{className:"text-base font-bold text-emerald-400",children:l.score})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-slate-800/60 border border-slate-700/50",children:[e.jsx("p",{className:"text-[10px] text-slate-400 mb-0.5",children:"Prize"}),e.jsx("p",{className:"text-base font-bold text-purple-400",children:ot.formatted})]})]}):e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Review your answers using the Q&A button above."})]})}),pe&&((D==null?void 0:D.length)||0)>0&&e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-xs font-semibold text-white flex items-center gap-1.5",children:[e.jsx(Pt,{className:"w-3.5 h-3.5 text-emerald-400"}),"Questions & Answers"]}),e.jsx("button",{type:"button",onClick:()=>Le(!1),className:"text-[10px] text-slate-400 hover:text-white",children:"Close"})]}),e.jsx("div",{className:"space-y-2",children:D.map((s,n)=>e.jsxs("div",{className:"rounded-lg bg-slate-800/50 border border-slate-700/40 p-2.5",children:[e.jsxs("div",{className:"text-[11px] font-medium text-white mb-1.5",children:[e.jsxs("span",{className:"text-slate-500 mr-1",children:["Q",n+1,"."]}),s.question_text]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.options.map(a=>{const t=!!a.is_correct,h=!!a.isSelected,f=t?"bg-emerald-600/15 border-emerald-500/30 text-emerald-300":h?"bg-rose-600/15 border-rose-500/30 text-rose-300":"bg-slate-900/40 border-slate-700/30 text-slate-400";return e.jsx("div",{className:`px-2 py-1.5 rounded-md border text-[10px] ${f}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsx("span",{children:"âœ“"}),h&&!t&&e.jsx("span",{children:"âœ—"}),e.jsx("span",{className:"truncate",children:a.option_text})]})},a.id)})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/80 p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-white mb-2 flex items-center gap-1.5",children:[e.jsx(Ke,{className:"w-3.5 h-3.5 text-amber-400"}),"Leaderboard"]}),e.jsxs("div",{className:"space-y-1.5",children:[T.length===0&&e.jsx("div",{className:"p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/40 text-slate-400 text-[11px]",children:"No participants or no valid answers. Results are finalized."}),T.map((s,n)=>{var A,N,S,M,p;const a=s.rank&&Array.isArray(r==null?void 0:r.prizes)&&r.prizes[s.rank-1]?r.prizes[s.rank-1]:0,t=oe(F,a,{fallback:0}),h=s.user_id===(o==null?void 0:o.id),f=n<3,w=n===0?"ðŸ¥‡":n===1?"ðŸ¥ˆ":n===2?"ðŸ¥‰":null;return e.jsxs(Et.div,{variants:it,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-2 p-2 rounded-lg border ${h?"bg-indigo-950/40 border-indigo-600/40":f?"bg-slate-800/50 border-slate-700/50":"bg-slate-800/30 border-slate-700/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center text-[11px] font-bold ${f?"bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-amber-400":"bg-slate-700/50 text-slate-400"}`,children:w||`#${s.rank||n+1}`}),e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center text-slate-300 text-[10px] font-bold",children:(A=s.profiles)!=null&&A.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:"",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{children:(((N=s.profiles)==null?void 0:N.full_name)||((S=s.profiles)==null?void 0:S.username)||"U").charAt(0).toUpperCase()})}),e.jsx("p",{className:"text-[11px] font-medium text-white truncate max-w-[100px]",children:((M=s.profiles)==null?void 0:M.username)||((p=s.profiles)==null?void 0:p.full_name)||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-[11px] font-bold text-emerald-400",children:s.score})}),e.jsx("div",{className:"text-right min-w-[50px]",children:e.jsx("p",{className:"text-[11px] font-bold text-purple-400",children:t.formatted})})]})]},`${s.id}-${n}`)})]})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/95 backdrop-blur",children:e.jsx("div",{className:"max-w-md mx-auto px-3",style:{paddingTop:8,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>Ce("/my-quizzes/"),className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-semibold bg-slate-800 text-white border border-slate-700 hover:bg-slate-700 transition",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Back"]}),e.jsxs("button",{onClick:ut,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-green-600 to-emerald-500 border border-green-500/50 hover:opacity-90 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),"WhatsApp"]}),e.jsxs("button",{onClick:ft,className:"inline-flex items-center justify-center gap-1.5 h-10 rounded-lg text-[11px] font-bold text-white bg-gradient-to-r from-violet-600 to-fuchsia-500 border border-violet-500/50 hover:opacity-90 transition",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Share"]})]})})})]})};export{es as default};
